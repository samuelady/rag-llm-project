{
  "text": "single case and introducearandomfactor. Thistechniqueisvulnerabletodeobfuscation,butdependingonthecomplexityanddepthof thesubstitutions,applyingitcanstillbetimeconsuming. Control Flow Flattening Controlflowflatteningreplacesoriginalcodewithamorecomplexrepresentation. Thetransformationbreaksthebodyof afunctionintobasicblocksandputsthemallinsideasingleinfiniteloopwithaswitchstatementthatcontrolstheprogram flow. This makes the program flow significantly harder to follow because it removes the natural conditional constructs thatusuallymakethecodeeasiertoread. Theimageshowshowcontrolflowflatteningalterscode. See“ObfuscatingC++programsviacontrolflowflattening”for moreinformation. 515\\nDead Code Injection Thistechniquemakestheprogram’scontrolflowmorecomplexbyinjectingdeadcodeintotheprogram. Deadcodeisa stubofcodethatdoesn’taffecttheoriginalprogram’sbehaviourbutincreasestheoverheadforthereverseengineering process. String Encryption Applications are often compiled with hardcoded keys, licences, tokens and endpoint URLs. By default, all of them are storedinplaintextinthedatasectionofanapplication’sbinary. Thistechniqueencryptsthesevaluesandinjectsstubs ofcodeintotheprogramthatwilldecryptthatdatabeforeitisusedbytheprogram. Recommended Tools • SwiftShieldcanbeusedtoperformnameobfuscation. ItreadsthesourcecodeoftheXcodeprojectandreplaces allnamesofclasses,methodsandfieldswithrandomvaluesbeforethecompilerisused. • obfuscator-llvm operates on the Intermediate Representation (IR) instead of the source code. It can be used for symbolobfuscation,stringencryptionandcontrolflowflattening. Sinceit’sbasedonIR,itcanhideoutsignificantly moreinformationabouttheapplicationascomparedtoSwiftShield. LearnmoreaboutiOSobfuscationtechniquesinthepaper“ProtectingMillion-UseriOSAppswithObfuscation: Motivations, Pitfalls,andExperience”. Device Binding The purpose of device binding is to impede an attackerwho tries to copy an app and its state fromdevice A to device B and continue the execution of the app on device B. After device A has been determined trusted, it may have more privilegesthandeviceB.Thissituationshouldn’tchangewhenanappiscopiedfromdeviceAtodeviceB. SinceiOS7.0,hardwareidentifiers(suchasMACaddresses)areoff-limitsbutthereareothermethodsforimplementing devicebindinginiOS: • identifierForVendor: You can use [[UIDevice currentDevice] identifierForVendor] (in Objective- C), UIDevice.current.identifierForVendor?.uuidString (in Swift3), or UIDevice.currentDevice(). identifierForVendor?.UUIDString(inSwift2). ThevalueofidentifierForVendormaynotbethesameifyou reinstall the app after other apps from the same vendor are installed and it may change when you update your appbundle’sname. ThereforeitisbesttocombineitwithsomethingintheKeychain. • UsingtheKeychain: YoucanstoresomethingintheKeychaintoidentifytheapplication’sinstance. Tomakesure thatthisdataisnotbackedup,usekSecAttrAccessibleWhenPasscodeSetThisDeviceOnly(ifyouwanttosecure thedataandproperlyenforceapasscodeorTouchIDrequirement),kSecAttrAccessibleAfterFirstUnlockThis- DeviceOnly,orkSecAttrAccessibleWhenUnlockedThisDeviceOnly. • UsingGoogleInstanceID:seetheimplementationforiOShere. Anyschemebasedonthesemethodswillbemoresecurethemomentapasscodeand/orTouchIDisenabled,themate- rials stored in the Keychain or filesystem are protected with protection classes (such as kSecAttrAccessibleAfter- FirstUnlockThisDeviceOnly and kSecAttrAccessibleWhenUnlockedThisDeviceOnly), and the SecAccessControl- CreateFlagsisseteitherwithkSecAccessControlDevicePasscode(forpasscodes),kSecAccessControlUserPresence (passcode, Face ID or Touch ID), kSecAccessControlBiometryAny (Face ID or Touch ID) or kSecAccessControlBiome- tryCurrentSet(FaceID/TouchID:butcurrentenrolledbiometricsonly). Testing for Debugging Code and Verbose Error Logging Platform: ios MASVSV1: MSTG-CODE-4 MASVSV2: MASVS-RESILIENCE-3 516\\nOverview Static Analysis Youcantakethefollowingstaticanalysisapproachfortheloggingstatements: 1. Importtheapplication’scodeintoXcode. 2. Searchthecodeforthefollowingprintingfunctions: NSLog,println,print,dump,debugPrint. 3. Whenyoufindoneofthem,determinewhetherthedevelopersusedawrappingfunctionaroundtheloggingfunction forbettermarkupofthestatementstobelogged;ifso,addthatfunctiontoyoursearch. 4. Foreveryresultofsteps2and3,determinewhethermacrosordebug-staterelatedguardshavebeensettoturn theloggingoffinthereleasebuild. PleasenotethechangeinhowObjective-Ccanusepreprocessormacros: ##ifdefDEBUG //Debug-onlycode ##endif The procedure for enabling this behavior in Swift has changed: you need to either set environment variables in your schemeorsetthemascustomflagsinthetarget’sbuildsettings. Pleasenotethatthefollowingfunctions(whichallow youtodeterminewhethertheappwasbuiltintheSwift2.1. release-configuration)aren’trecommended,asXcode8and Swift3don’tsupportthesefunctions: • _isDebugAssertConfiguration • _isReleaseAssertConfiguration • _isFastAssertConfiguration. Dependingontheapplication’ssetup,theremaybemoreloggingfunctions. Forexample,whenCocoaLumberjackisused, staticanalysisisabitdifferent. Forthe“debug-management”code(whichisbuilt-in): inspectthestoryboardstoseewhetherthereareanyflowsand/or view-controllersthatprovidefunctionalitydifferentfromthefunctionalitytheapplicationshouldsupport. Thisfunctionality canbeanythingfromdebugviewstoprintederrormessages,fromcustomstub-responseconfigurationstologswritten tofilesontheapplication’sfilesystemoraremoteserver. Asadeveloper,incorporatingdebugstatementsintoyourapplication’sdebugversionshouldnotbeaproblemaslongas youmakesurethatthedebugstatementsareneverpresentintheapplication’sreleaseversion. InObjective-C,developerscanusepreprocessormacrostofilteroutdebugcode: ##ifdefDEBUG //Debug-onlycode ##endif InSwift2(withXcode7), youhavetosetcustomcompilerflagsforeverytarget, andcompilerflagshavetostartwith “-D”.SoyoucanusethefollowingannotationswhenthedebugflagDMSTG-DEBUGisset: ##ifMSTG-DEBUG //Debug-onlycode ##endif InSwift3(withXcode8),youcansetActiveCompilationConditionsinBuildsettings/Swiftcompiler-Customflags. Instead ofapreprocessor,Swift3usesconditionalcompilationblocksbasedonthedefinedconditions: ##ifDEBUG_LOGGING //Debug-onlycode ##endif Dynamic Analysis Dynamicanalysisshouldbeexecutedonbothasimulatorandadevicebecausedeveloperssometimesusetarget-based functions(insteadoffunctionsbasedonarelease/debug-mode)toexecutethedebuggingcode. 517\\n1. Runtheapplicationonasimulatorandcheckforoutputintheconsoleduringtheapp’sexecution. 2. AttachadevicetoyourMac,runtheapplicationonthedeviceviaXcode,andcheckforoutputintheconsoleduring theapp’sexecution. Fortheother“manager-based”debugcode: clickthroughtheapplicationonbothasimulatorandadevicetoseeifyou can find any functionality that allows an app’s profiles to be pre-set, allows the actual server to be selected or allows responsesfromtheAPItobeselected. Testing Anti-Debugging Detection Platform: ios MASVSV1: MSTG-RESILIENCE-2 MASVSV2: MASVS-RESILIENCE-4 Overview Inordertotestforanti-debuggingdetectionyoucantrytoattachadebuggertotheappandseewhathappens. Theappshouldrespondinsomeway. Forexampleby: • Alertingtheuserandaskingforacceptingliability. • Preventingexecutionbygracefullyterminating. • Securelywipinganysensitivedatastoredonthedevice. • Reportingtoabackendserver,e.g,forfrauddetection. Trytohookorreverseengineertheappusingthemethodsfromsection“Anti-DebuggingDetection”. Next,workonbypassingthedetectionandanswerthefollowingquestions: • Canthemechanismsbebypassedtrivially(e.g.,byhookingasingleAPIfunction)? • Howdifficultisidentifyingthedetectioncodeviastaticanddynamicanalysis? • Didyouneedtowritecustomcodetodisablethedefenses? Howmuchtimedidyouneed? • Whatisyourassessmentofthedifficultyofbypassingthemechanisms? Testing Jailbreak Detection Platform: ios MASVSV1: MSTG-RESILIENCE-1 MASVSV2: MASVS-RESILIENCE-1 Overview Totestforjailbreakdetectioninstalltheapponajailbrokendevice. Launchtheappandseewhathappens: Ifitimplementsjailbreakdetection,youmightnoticeoneofthefollowingthings: • Theappcrashesandclosesimmediately,withoutanynotification. • Apop-upwindowindicatesthattheappwon’trunonajailbrokendevice. Notethatcrashesmightbeanindicatorofjailbreakdetectionbuttheappmaybecrashingforanyotherreasons,e.g.itmay haveabug. Werecommendtotesttheapponnon-jailbrokendevicefirst,especiallywhenyou’retestingpreproduction versions. LaunchtheappandtrytobypassJailbreakDetectionusinganautomatedtool: 518\\nIf it implements jailbreak detection, you might be able to see indicators of that in the output of the tool. See section “AutomatedJailbreakDetectionBypass”. ReverseEngineertheapp: Theappmightbeusingtechniquesthatarenotimplementedintheautomatedtoolsthatyou’veused. Ifthat’sthecase youmustreverseengineertheapptofindproofs. Seesection“ManualJailbreakDetectionBypass”. Testing whether the App is Debuggable Platform: ios MASVSV1: MSTG-CODE-2 MASVSV2: MASVS-RESILIENCE-4 Overview Static Analysis Inspecttheappentitlementsandcheckthevalueofget-task-allowkey. Ifitissettotrue,theappisdebuggable. Usingcodesign: $codesign -d--entitlements -iGoat-Swift.app Executable=/Users/owasp/iGoat-Swift/Payload/iGoat-Swift.app/iGoat-Swift [Dict] [Key]application-identifier [Value] [String]TNAJ496RHB.OWASP.iGoat-Swift [Key]com.apple.developer.team-identifier [Value] [String]TNAJ496RHB [Key]get-task-allow [Value] [Bool]true [Key]keychain-access-groups [Value] [Array] [String]TNAJ496RHB.OWASP.iGoat-Swift Usingldid: $ldid-eiGoat-Swift.app/iGoat-Swift <?xml version=\"1.0\" encoding=\"UTF-8\"?> <!DOCTYPE plist PUBLIC\"-//Apple//DTDPLIST1.0//EN\"\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"> <plist version=\"1.0\"> <dict> <key>application-identifier</key> <string>TNAJ496RHB.OWASP.iGoat-Swift</string> <key>com.apple.developer.team-identifier</key> <string>TNAJ496RHB</string> <key>get-task-allow</key> <true/> <key>keychain-access-groups</key> <array> <string>TNAJ496RHB.OWASP.iGoat-Swift</string> </array> </dict> </plist> Dynamic Analysis Checkwhetheryoucanattachadebuggerdirectly, usingXcode. Next, checkifyoucandebugtheapponajailbroken",
  "metadata": {
    "doc_id": "OWASP_MASTG",
    "chunk_id": 166
  },
  "embedding": [
    -0.0959375649690628,
    -0.01884191483259201,
    -0.02811141312122345,
    -0.0696481466293335,
    -0.014281708747148514,
    -0.018986552953720093,
    0.020510956645011902,
    0.029606472700834274,
    -0.036829523742198944,
    -0.015144839882850647,
    0.004243208095431328,
    -0.021527504548430443,
    0.03704513609409332,
    -0.06662141531705856,
    0.019328121095895767,
    -0.03526448830962181,
    -0.007677306886762381,
    0.011042057536542416,
    -0.08250906318426132,
    -0.0066796657629311085,
    0.08924660086631775,
    -0.06921324878931046,
    -0.0393085852265358,
    0.021608268842101097,
    -0.003139305394142866,
    0.07847847789525986,
    -0.03890259563922882,
    -0.039905235171318054,
    0.026596512645483017,
    -0.02604868821799755,
    -0.015371539629995823,
    0.004465361125767231,
    0.02449444681406021,
    0.04401024058461189,
    0.01351798977702856,
    0.037379417568445206,
    0.010272829793393612,
    -0.0055852169170975685,
    -0.03592068329453468,
    -0.04673587903380394,
    -0.07693539559841156,
    -0.007822011597454548,
    -0.08322710543870926,
    0.08765799552202225,
    -0.042791206389665604,
    -0.021302690729498863,
    0.011521713808178902,
    -0.0249845739454031,
    -0.06958198547363281,
    -0.03070245310664177,
    -0.023884352296590805,
    0.013759012334048748,
    0.011196266859769821,
    0.10122351348400116,
    -0.06346558779478073,
    -0.047634758055210114,
    -0.009765367954969406,
    0.058204226195812225,
    0.00983527209609747,
    0.0658450648188591,
    -0.042573653161525726,
    0.10052616149187088,
    -0.0041099111549556255,
    0.05086479336023331,
    0.011703298427164555,
    0.05771313235163689,
    0.0024153476115316153,
    -0.03587491810321808,
    0.07611177861690521,
    -0.07804611325263977,
    -0.0749734565615654,
    -0.015824127942323685,
    -0.07136362046003342,
    0.08666269481182098,
    -0.04120283201336861,
    0.006873097736388445,
    -0.03070574253797531,
    -0.013556699268519878,
    -0.02698088437318802,
    -0.08924341946840286,
    0.09579126536846161,
    -0.017954779788851738,
    0.030985133722424507,
    0.05794805660843849,
    -0.0013456003507599235,
    0.05939708277583122,
    -0.036571990698575974,
    -0.04624089598655701,
    0.0496075414121151,
    0.09245442599058151,
    0.023183004930615425,
    -0.07311078161001205,
    0.03873375803232193,
    -0.025873087346553802,
    0.11179772019386292,
    -0.05869588628411293,
    -0.03791223466396332,
    -0.04080571234226227,
    -0.05591995641589165,
    -0.009308258071541786,
    -0.057666413486003876,
    -0.08491148054599762,
    0.03785987198352814,
    -0.08828586339950562,
    0.08783998340368271,
    0.004056091420352459,
    0.023502953350543976,
    -0.035927075892686844,
    0.03177540749311447,
    -0.0261403676122427,
    -0.010447225533425808,
    0.015715619549155235,
    0.015385107137262821,
    -0.08871018886566162,
    0.006727437023073435,
    0.07221981883049011,
    -0.10106103122234344,
    0.04133564978837967,
    0.025208493694663048,
    0.09590324759483337,
    0.028934916481375694,
    0.03857311233878136,
    0.025508079677820206,
    -0.04446057602763176,
    -0.01770731434226036,
    0.0016530246939510107,
    -0.03538574278354645,
    1.815419369477731e-32,
    -0.03326326608657837,
    -0.0544438473880291,
    -0.08814726024866104,
    0.05482716113328934,
    -0.019633732736110687,
    0.00858891848474741,
    0.0511980801820755,
    0.09424354135990143,
    -0.022810528054833412,
    0.009866198524832726,
    -0.001310712075792253,
    -0.045266132801771164,
    -0.024368371814489365,
    0.01150890439748764,
    0.029375333338975906,
    -0.04952361807227135,
    -0.012827582657337189,
    0.0251444261521101,
    -0.054023753851652145,
    -0.007568170316517353,
    0.05608050152659416,
    0.03287908434867859,
    0.013432503677904606,
    -0.04192373529076576,
    -0.041576240211725235,
    0.007071801461279392,
    0.0109467264264822,
    0.01402613241225481,
    0.07942626625299454,
    0.06351618468761444,
    -0.03350993990898132,
    -0.04120488837361336,
    -0.055285051465034485,
    0.044705938547849655,
    0.059318941086530685,
    -0.024519437924027443,
    0.053956177085638046,
    -0.05549079179763794,
    0.0719742476940155,
    -0.017021602019667625,
    -0.01403470616787672,
    -0.05553101748228073,
    -0.0436616986989975,
    -0.07566874474287033,
    0.06467656791210175,
    -0.054613929241895676,
    -0.06851129233837128,
    0.00741593586280942,
    -0.021127527579665184,
    0.06652455776929855,
    0.09946553409099579,
    0.07516627758741379,
    0.015587687492370605,
    -0.06514730304479599,
    -0.1077025756239891,
    -0.04939877614378929,
    0.024072134867310524,
    -0.02522517554461956,
    0.017773516476154327,
    0.11629046499729156,
    -0.10752728581428528,
    0.04546157643198967,
    -0.03161754086613655,
    -0.030223499983549118,
    0.025054944679141045,
    -0.013450291007757187,
    0.04048781096935272,
    -0.10811465233564377,
    -0.003719378961250186,
    0.0021514748223125935,
    -0.13773034512996674,
    -0.03042258508503437,
    -0.011968503706157207,
    0.03067806549370289,
    0.009970366954803467,
    -0.024242207407951355,
    0.013730384409427643,
    0.04428122565150261,
    -0.022031506523489952,
    -0.10225262492895126,
    -0.056176602840423584,
    0.06713801622390747,
    0.07360154390335083,
    0.007508419919759035,
    -0.05438676476478577,
    0.015977879986166954,
    -0.03534068912267685,
    -0.10052318125963211,
    -0.049449846148490906,
    -0.01376632321625948,
    0.06110166758298874,
    -0.07888594269752502,
    -0.01683705486357212,
    0.0010969276772812009,
    0.047962795943021774,
    -1.8166255736184685e-32,
    0.025148767977952957,
    -0.039605721831321716,
    -0.10459885746240616,
    0.0491425059735775,
    0.0029263750184327364,
    -0.002542406553402543,
    0.011430268175899982,
    0.030105935409665108,
    0.020693833008408546,
    -0.06295140087604523,
    -0.0346233956515789,
    0.0464235357940197,
    0.017869172617793083,
    -0.018556570634245872,
    0.0734475776553154,
    -0.027616189792752266,
    0.0010053811129182577,
    0.031412962824106216,
    0.004398567136377096,
    0.07657679915428162,
    0.020683657377958298,
    0.07806181907653809,
    -0.08697134256362915,
    0.038603972643613815,
    0.053714703768491745,
    -0.008820129558444023,
    -0.04422974959015846,
    0.10318826884031296,
    0.15985719859600067,
    0.0069859265349805355,
    -0.01977531798183918,
    0.03898775205016136,
    -0.08993585407733917,
    -0.023156972602009773,
    -0.12500756978988647,
    -0.06067981943488121,
    0.045805368572473526,
    0.011230947449803352,
    -0.04918067529797554,
    -0.020132746547460556,
    0.08357960730791092,
    -0.04259619489312172,
    -0.043804511427879333,
    0.03480794280767441,
    0.002448508283123374,
    0.004592847544699907,
    -0.0636552944779396,
    -0.09208828210830688,
    0.05057891458272934,
    0.0038943770341575146,
    0.03774549067020416,
    -0.060559146106243134,
    0.008493045344948769,
    0.06185310706496239,
    0.02156136929988861,
    0.036869753152132034,
    0.0745268389582634,
    0.0014303689822554588,
    -0.06246542930603027,
    0.005103011149913073,
    0.0383065901696682,
    0.018825588747859,
    0.12168882042169571,
    -0.03509226068854332,
    0.09588245302438736,
    0.041575074195861816,
    -0.04378054291009903,
    0.0012043194146826863,
    -0.044636428356170654,
    -0.0074243308044970036,
    0.08478029072284698,
    -0.057045139372348785,
    -0.026709645986557007,
    0.0002530566416680813,
    -0.00980856828391552,
    -0.012916582636535168,
    0.04913531616330147,
    -0.0653987005352974,
    -0.08112647384405136,
    0.049579378217458725,
    0.014121229760348797,
    -0.010019255802035332,
    -0.01187374722212553,
    0.09373332560062408,
    0.042381927371025085,
    -0.02559458464384079,
    -0.016065550968050957,
    -0.02888023853302002,
    -0.017720481380820274,
    -0.007924630306661129,
    -0.12406320124864578,
    0.012463757768273354,
    -0.034357279539108276,
    0.04503576457500458,
    0.021370599046349525,
    -6.723347212300723e-08,
    0.015273324213922024,
    -0.026897523552179337,
    -0.0612473264336586,
    0.015554471872746944,
    0.07428158819675446,
    0.05410637706518173,
    -0.048476796597242355,
    0.016476737335324287,
    -0.01835518330335617,
    -0.0982043519616127,
    0.012013000436127186,
    -0.0047734505496919155,
    -0.03431195765733719,
    -0.05988650023937225,
    0.05093783140182495,
    0.003329533152282238,
    -0.06833086162805557,
    0.00840717926621437,
    -0.033136457204818726,
    -0.03257432579994202,
    -0.00923767127096653,
    -0.03342380002140999,
    -0.08002331852912903,
    0.017354251816868782,
    0.035411614924669266,
    0.016499869525432587,
    0.048570021986961365,
    0.05947532877326012,
    0.03565308079123497,
    0.08308140188455582,
    -0.022140340879559517,
    0.008035696111619473,
    0.09281986206769943,
    -0.015574195422232151,
    -0.0675266683101654,
    0.09388009458780289,
    -0.028855634853243828,
    0.008793612010776997,
    0.022556761279702187,
    -0.016271883621811867,
    0.04307699576020241,
    0.033255890011787415,
    -0.031385451555252075,
    -0.007682665716856718,
    0.02346118539571762,
    -0.02305976301431656,
    0.07003266364336014,
    0.006349365226924419,
    -0.02012552134692669,
    0.03143537417054176,
    -0.05830591544508934,
    0.039083242416381836,
    -0.08245844393968582,
    0.05874157324433327,
    -0.0022400091402232647,
    0.06403153389692307,
    0.0062026698142290115,
    -0.09356372058391571,
    0.01371333934366703,
    0.0752495601773262,
    0.0017673486145213246,
    -0.011616182513535023,
    0.11723330616950989,
    -0.037469565868377686
  ]
}