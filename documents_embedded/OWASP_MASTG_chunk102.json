{
  "text": "to the notifications creation, e.g.setContentTitleorsetContentTextfromNotificationCompat.Builder. Observethetraceintheendandevalu- ateifitcontainsanysensitiveinformation. Finding Sensitive Information in Auto-Generated Screenshots 265\\nPlatform: android MASVSV1: MSTG-STORAGE-9 MASVSV2: MASVS-PLATFORM-3 Overview Static Analysis A screenshot of the current activity is taken when an Android app goes into background and displayed for aesthetic purposeswhentheappreturnstotheforeground. However,thismayleaksensitiveinformation. Todeterminewhethertheapplicationmayexposesensitiveinformationviatheappswitcher,findoutwhethertheFLAG_- SECUREoptionhasbeenset. Youshouldfindsomethingsimilartothefollowingcodesnippet: ExampleinJava: getWindow().setFlags(WindowManager.LayoutParams.FLAG_SECURE, WindowManager.LayoutParams.FLAG_SECURE); setContentView(R.layout.activity_main); ExampleinKotlin: window.setFlags(WindowManager.LayoutParams.FLAG_SECURE, WindowManager.LayoutParams.FLAG_SECURE) setContentView(R.layout.activity_main) Iftheoptionhasnotbeenset,theapplicationisvulnerabletoscreencapturing. Dynamic Analysis While black-box testing the app, navigate to any screen that contains sensitive information and click the home button tosendtheapptothebackground,thenpresstheappswitcherbuttontoseethesnapshot. Asshownbelow,ifFLAG_- SECUREisset(leftimage),thesnapshotwillbeempty;iftheflaghasnotbeenset(rightimage),activityinformationwill beshown: 266\\nOndevicessupportingfile-basedencryption(FBE),snapshotsarestoredinthe/data/system_ce/<USER_ID>/<IMAGE_- FOLDER_NAME>folder. <IMAGE_FOLDER_NAME>dependsonthevendorbutmostcommonnamesaresnapshotsandre- cent_images. Ifthedevicedoesn’tsupportFBE,the/data/system/<IMAGE_FOLDER_NAME>folderisused. Accessingthesefoldersandthesnapshotsrequiresroot. Testing for Vulnerable Implementation of PendingIntent Platform: android MASVSV1: MSTG-PLATFORM-4 MASVSV2: MASVS-PLATFORM-1 Overview When testing Pending Intents you must ensure that they are immutable and that the app explicitly specifies the exact package,action,andcomponentthatwillreceivethebaseintent. Static Analysis To identify vulnerable implementations, static analysis can be performed by looking for API calls used for obtaining a PendingIntent. SuchAPIsarelistedbelow: PendingIntent getActivity(Context,int,Intent,int) PendingIntent getActivity(Context,int,Intent,int,Bundle) PendingIntent getActivities(Context,int,Intent,int,Bundle) PendingIntent getActivities(Context,int,Intent,int) PendingIntent getForegroundService(Context,int,Intent,int) PendingIntent getService(Context,int,Intent,int) Onceanyoftheabovefunctionisspotted,checktheimplementationofthebaseintentandthePendingIntentforthe securitypitfallslistedinthePendingIntentssection. 267\\nForexample,inA-156959408(CVE-2020-0389),thebaseintentisimplicitandalsothePendingIntentismutable,thus makingitexploitable. private Notification createSaveNotification(Uriuri){ IntentviewIntent =newIntent(Intent.ACTION_VIEW) .setFlags(Intent.FLAG_ACTIVITY_NEW_TASK |Intent.FLAG_GRANT_READ_URI_PERMISSION) .setDataAndType(uri,\"video/mp4\");//ImplicitIntent //...skip... Notification.Builder builder =newNotification.Builder(this,CHANNEL_ID) .setSmallIcon(R.drawable.ic_android) .setContentTitle(getResources().getString(R.string.screenrecord_name)) .setContentText(getResources().getString(R.string.screenrecord_save_message)) .setContentIntent(PendingIntent.getActivity( this, REQUEST_CODE, viewIntent, Intent.FLAG_GRANT_READ_URI_PERMISSION)) //MutablePendingIntent. .addAction(shareAction) .addAction(deleteAction) .setAutoCancel(true); Dynamic Analysis FridacanbeusedtohooktheAPIsusedtogetaPendingIntent. Thisinformationcanbeusedtodeterminethecode locationofthecall,whichcanbefurtherusedtoperformstaticanalysisasdescribedabove. Here’sanexampleofsuchaFridascriptthatcanbeusedtohookthePendingIntent.getActivityfunction: varpendingIntent =Java.use('android.app.PendingIntent'); vargetActivity_1 =pendingIntent.getActivity.overload(\"android.content.Context\",\"int\",\"android.content.Intent\",\"int\"); getActivity_1.implementation =function(context,requestCode,intent,flags){ console.log(\"[*]CallingPendingIntent.getActivity(\"+intent.getAction()+\")\"); console.log(\"\\t[-]BaseIntenttoString:\" +intent.toString()); console.log(\"\\t[-]BaseIntentgetExtras:\" +intent.getExtras()); console.log(\"\\t[-]BaseIntentgetFlags:\" +intent.getFlags()); return this.getActivity(context,requestCode,intent,flags); } Thisapproachcanbehelpfulwhendealingwithapplicationswithlargecodebases,wheredeterminingthecontrolflow cansometimesbetricky. Testing JavaScript Execution in WebViews Platform: android MASVSV1: MSTG-PLATFORM-5 MASVSV2: MASVS-PLATFORM-2 Overview TotestforJavaScriptexecutioninWebViewschecktheappforWebViewusageandevaluatewhetherornoteachWebView shouldallowJavaScriptexecution. IfJavaScriptexecutionisrequiredfortheapptofunctionnormally,thenyouneedto ensurethattheappfollowstheallbestpractices. Static Analysis TocreateanduseaWebView,anappmustcreateaninstanceoftheWebViewclass. 268\\nWebViewwebview =newWebView(this); setContentView(webview); webview.loadUrl(\"https://www.owasp.org/\"); Various settings can be applied to the WebView (activating/deactivating JavaScript is one example). JavaScript is dis- abledbydefaultforWebViewsandmustbeexplicitlyenabled. LookforthemethodsetJavaScriptEnabledtocheckfor JavaScriptactivation. webview.getSettings().setJavaScriptEnabled(true); ThisallowstheWebViewtointerpretJavaScript. Itshouldbeenabledonlyifnecessarytoreducetheattacksurfacetothe app. IfJavaScriptisnecessary,youshouldmakesurethat • The communication to the endpoints consistently relies on HTTPS (or other protocols that allow encryption) to protectHTMLandJavaScriptfromtamperingduringtransmission. • JavaScriptandHTMLareloadedlocally,fromwithintheappdatadirectoryorfromtrustedwebserversonly. • The user cannot define which sources to load by means of loading different resources based on a user provided input. ToremoveallJavaScriptsourcecodeandlocallystoreddata,cleartheWebView’scachewithclearCachewhentheapp closes. DevicesrunningplatformsolderthanAndroid4.4(APIlevel19)useaversionofWebKitthathasseveralsecurityissues. As aworkaround,theappmustconfirmthatWebViewobjectsdisplayonlytrustedcontentiftheapprunsonthesedevices. Dynamic Analysis DynamicAnalysisdependsonoperatingconditions. ThereareseveralwaystoinjectJavaScriptintoanapp’sWebView: • StoredCross-SiteScriptingvulnerabilitiesinanendpoint;theexploitwillbesenttothemobileapp’sWebViewwhen theusernavigatestothevulnerablefunction. • Attackertakesaman-in-the-middle(MITM)positionandtamperswiththeresponsebyinjectingJavaScript. • MalwaretamperingwithlocalfilesthatareloadedbytheWebView. Toaddresstheseattackvectors,checkthefollowing: • AllfunctionsofferedbytheendpointshouldbefreeofstoredXSS. • OnlyfilesthatareintheappdatadirectoryshouldberenderedinaWebView(seetestcase“TestingforLocalFile InclusioninWebViews”). • TheHTTPScommunicationmustbeimplementedaccordingtobestpracticestoavoidMITMattacks. Thismeans: – allcommunicationisencryptedviaTLS, – thecertificateischeckedproperly,and/or – thecertificateshouldbepinned. Testing for Sensitive Functionality Exposure Through IPC Platform: android MASVSV1: MSTG-PLATFORM-4 MASVSV2: MASVS-PLATFORM-1 Overview TotestforsensitivefunctionalityexposurethroughIPCmechanismsyoushouldfirstenumeratealltheIPCmechanisms theappusesandthentrytoidentifywhethersensitivedataisleakedwhenthemechanismsareused. 269\\nStatic Analysis WestartbylookingattheAndroidManifest.xml,whereallactivities,services,andcontentprovidersincludedintheapp mustbedeclared(otherwisethesystemwon’trecognizethemandtheywon’trun). • <intent-filter> • <service> • <provider> • <receiver> An “exported” activity, service, or content can be accessed by other apps. There are two common ways to designate a component as exported. The obvious one is setting the export tag to true android:exported=\"true\". The second wayinvolvesdefiningan<intent-filter>withinthecomponentelement(<activity>,<service>,<receiver>). When this is done, the export tag is automatically set to “true”. To prevent all other Android apps from interacting with the IPC component element, be sure that the android:exported=\"true\" value and an <intent-filter> aren’t in their AndroidManifest.xmlfilesunlessthisisnecessary. Rememberthatusingthepermissiontag(android:permission)willalsolimitotherapplications’accesstoacomponent. If your IPC is intended to be accessible to other applications, you can apply a security policy with the <permission> elementandsetaproperandroid:protectionLevel. Whenandroid:permissionisusedinaservicedeclaration,other applications must declare a corresponding<uses-permission> element in their own manifest to start, stop, or bind to theservice. Formoreinformationaboutthecontentproviders,pleaserefertothetestcase“TestingWhetherStoredSensitiveDataIs ExposedviaIPCMechanisms”inchapter“TestingDataStorage”. Once you identify a list of IPC mechanisms, review the source code to see whether sensitive data is leaked when the mechanismsareused. Forexample,contentproviderscanbeusedtoaccessdatabaseinformation,andservicescanbe probedtoseeiftheyreturndata. Broadcastreceiverscanleaksensitiveinformationifprobedorsniffed. Inthefollowing,weusetwoexampleappsandgiveexamplesofidentifyingvulnerableIPCcomponents: • “Sieve” • “AndroidInsecureBank” Activities Inspect",
  "metadata": {
    "doc_id": "OWASP_MASTG",
    "chunk_id": 102
  },
  "embedding": [
    -0.015286857262253761,
    0.01079776044934988,
    0.010372454300522804,
    -0.02751772478222847,
    0.08708949387073517,
    -0.009583843871951103,
    0.07821188122034073,
    0.012152264825999737,
    0.022413238883018494,
    -0.0368194617331028,
    -0.03843805193901062,
    -0.11371085047721863,
    0.10097720474004745,
    0.021456267684698105,
    -0.060318976640701294,
    -0.030270973220467567,
    0.08310578018426895,
    -0.01809748075902462,
    -0.09767407923936844,
    0.011749064549803734,
    0.060815561562776566,
    -0.015106167644262314,
    0.08285317569971085,
    0.028219051659107208,
    0.09411442279815674,
    -0.011934354901313782,
    0.021136781200766563,
    -0.028978826478123665,
    0.0733833760023117,
    -0.02469712868332863,
    0.03393332660198212,
    -0.006571296602487564,
    0.07788483798503876,
    0.014952392317354679,
    -0.0019308297196403146,
    -0.006774225737899542,
    -0.015857338905334473,
    -0.003967467229813337,
    0.041723769158124924,
    -0.04962856322526932,
    -0.0468619167804718,
    -0.031552258878946304,
    0.0009520270978100598,
    0.0499265156686306,
    -0.058269500732421875,
    0.0016980088548734784,
    0.05618607997894287,
    -0.09604096412658691,
    -0.027337219566106796,
    0.005248232278972864,
    0.0019000251777470112,
    -0.025786766782402992,
    0.022087961435317993,
    -0.041968051344156265,
    -0.07330121845006943,
    0.012104600667953491,
    -0.0026804087683558464,
    0.058965153992176056,
    -0.0022060887422412634,
    0.09171849489212036,
    0.013413649052381516,
    -0.005305248312652111,
    -0.022656653076410294,
    -0.034218039363622665,
    -0.02364891953766346,
    0.1274501085281372,
    0.051887545734643936,
    -0.032169926911592484,
    0.05027387663722038,
    -0.07471441477537155,
    -0.009609969332814217,
    0.04464934766292572,
    0.039714254438877106,
    -0.07784584909677505,
    -0.017893441021442413,
    -0.0010641861008480191,
    -0.018652306869626045,
    -0.014542237855494022,
    -0.08312927931547165,
    -0.1309816688299179,
    0.055483266711235046,
    -0.01119909342378378,
    0.005800760351121426,
    0.06086798384785652,
    0.04661548510193825,
    -0.016773106530308723,
    -0.0038128220476210117,
    -0.006094847805798054,
    -0.002963127801194787,
    0.10895619541406631,
    -0.018653733655810356,
    -0.056409258395433426,
    -0.0735509842634201,
    0.01394228357821703,
    -0.022759323939681053,
    -0.020148364827036858,
    -0.1420104056596756,
    -0.035247255116701126,
    0.015215810388326645,
    0.05155090615153313,
    0.03078724443912506,
    0.022081375122070312,
    0.007758216466754675,
    0.06733085215091705,
    0.09733222424983978,
    -0.023310204967856407,
    -0.03618228808045387,
    -0.04807610064744949,
    -0.00461122440174222,
    0.06069274619221687,
    0.014883414842188358,
    -0.01312029268592596,
    -0.018010225147008896,
    -0.030844829976558685,
    0.04476456716656685,
    0.015654534101486206,
    0.010638262145221233,
    0.008407729677855968,
    0.06604410707950592,
    0.0036395785864442587,
    0.10402461886405945,
    -0.03570016846060753,
    -0.05168244242668152,
    -0.05702867731451988,
    0.028192251920700073,
    -0.04440799728035927,
    -0.03894985467195511,
    1.7202641303362238e-32,
    0.026423050090670586,
    0.029749495908617973,
    0.011677799746394157,
    0.04695139825344086,
    -0.0341169573366642,
    -0.009732554666697979,
    -0.049811363220214844,
    0.0007316283881664276,
    0.06960660219192505,
    -0.08840174973011017,
    0.027288850396871567,
    0.0499783530831337,
    0.03096276894211769,
    0.013318752869963646,
    -0.01274371612817049,
    -0.04006781056523323,
    -0.03412346541881561,
    0.05511101707816124,
    -0.038423120975494385,
    -0.01591249741613865,
    -0.030038094148039818,
    -0.015393431298434734,
    -0.04153567552566528,
    -0.004252672661095858,
    -0.021786071360111237,
    0.012646101415157318,
    0.07100096344947815,
    0.03513167425990105,
    -0.05145898088812828,
    0.016130195930600166,
    -0.0694577768445015,
    -0.03882814198732376,
    0.05446319282054901,
    0.016398845240473747,
    -0.0035599858965724707,
    -0.02049417234957218,
    -0.040227409452199936,
    -0.024491602554917336,
    0.07770101726055145,
    -0.08304077386856079,
    0.0070123812183737755,
    -0.0022282337304204702,
    -0.0364297479391098,
    0.010066109709441662,
    -0.014539163559675217,
    -0.0419452004134655,
    -0.046652764081954956,
    0.03041616640985012,
    0.015382971614599228,
    0.004103894345462322,
    0.06394225358963013,
    -0.001275026355870068,
    0.04103418067097664,
    -0.12232024222612381,
    -0.12989729642868042,
    -0.0349721759557724,
    -0.0420323945581913,
    -0.06808457523584366,
    0.009760597720742226,
    0.014046533033251762,
    -0.06641491502523422,
    0.01744096726179123,
    -0.004740975331515074,
    -0.053061697632074356,
    -0.03844095766544342,
    0.07132154703140259,
    0.019425177946686745,
    -0.026439648121595383,
    -0.05931242182850838,
    -0.041414063423871994,
    -0.06003737822175026,
    0.015975777059793472,
    0.005304040852934122,
    0.009673618711531162,
    -0.00290090823546052,
    -0.016719769686460495,
    0.042609356343746185,
    0.04201018065214157,
    -0.025845956057310104,
    -0.05432453379034996,
    0.05153076350688934,
    0.004371181596070528,
    0.07491599023342133,
    -0.031015507876873016,
    -0.04838888347148895,
    -0.03281231224536896,
    0.006937024649232626,
    -0.07665890455245972,
    -0.12315487116575241,
    0.14712895452976227,
    -0.02087755687534809,
    0.03245069459080696,
    -0.00571591779589653,
    0.06324974447488785,
    -0.0759284570813179,
    -1.5615040673660734e-32,
    -0.013224960304796696,
    0.04566260799765587,
    -0.13676629960536957,
    -0.06710623949766159,
    0.016761742532253265,
    0.008842561393976212,
    -0.014095603488385677,
    0.08283854275941849,
    0.049599383026361465,
    0.014541623182594776,
    0.003549126908183098,
    0.009103715419769287,
    -0.08354869484901428,
    -0.027317918837070465,
    -0.08338963240385056,
    -0.0024620802141726017,
    0.06741193681955338,
    0.06205735355615616,
    -0.10305940359830856,
    0.022836633026599884,
    -0.05571351200342178,
    0.07639501243829727,
    -0.04048020392656326,
    0.010777703486382961,
    0.06605129688978195,
    0.004546584561467171,
    0.010478208772838116,
    0.01076602190732956,
    0.06637085974216461,
    -0.04616950824856758,
    -0.00012234052701387554,
    0.051652055233716965,
    -0.06018631532788277,
    -0.019994843751192093,
    0.035776421427726746,
    -0.08171498775482178,
    -0.03020613081753254,
    -0.05275497958064079,
    -0.03683999553322792,
    0.06436798721551895,
    0.061016663908958435,
    0.06932339817285538,
    -0.001501396531239152,
    0.05780992656946182,
    0.004512762650847435,
    0.040228165686130524,
    0.014014994725584984,
    -0.06203022971749306,
    -0.0065162694081664085,
    0.059346240013837814,
    0.1115138828754425,
    -0.04660496115684509,
    0.016873985528945923,
    0.013076416216790676,
    0.03607160598039627,
    0.07948170602321625,
    0.013930385001003742,
    0.04086439684033394,
    -0.009974407032132149,
    -0.042483001947402954,
    0.05296667292714119,
    -0.03701134771108627,
    -0.10305408388376236,
    -0.047848984599113464,
    0.056570637971162796,
    0.05713217332959175,
    0.004337665159255266,
    0.02995738387107849,
    0.0009281839011237025,
    0.039239585399627686,
    0.03388115391135216,
    -0.1168418750166893,
    -0.06821243464946747,
    -0.07729116082191467,
    -0.017066240310668945,
    -0.030013810843229294,
    0.05909661948680878,
    -0.06800239533185959,
    -0.10191024094820023,
    -0.05815361067652702,
    0.011775445193052292,
    0.001110382960177958,
    0.01641121134161949,
    -0.06862068921327591,
    0.005984775256365538,
    -0.052745744585990906,
    -0.0931219831109047,
    0.045509420335292816,
    -0.03821056708693504,
    0.03234943374991417,
    -0.06364428997039795,
    0.08645521104335785,
    0.012442678213119507,
    0.03471389412879944,
    -0.0026658540591597557,
    -6.901520777091719e-08,
    0.03151752054691315,
    -0.0007819599122740328,
    -0.007356252986937761,
    -0.04057326912879944,
    0.0567711666226387,
    -0.0038834132719784975,
    0.024967387318611145,
    -0.00270221964456141,
    -0.003652112791314721,
    -0.09687241911888123,
    -0.050877030938863754,
    -0.10024093836545944,
    -0.07387293130159378,
    -0.04805673658847809,
    0.01666591316461563,
    -0.00023013651662040502,
    -0.012884197756648064,
    -0.005929631646722555,
    -0.05840791016817093,
    -0.0280947033315897,
    -0.008882442489266396,
    -0.004256370477378368,
    -0.048808176070451736,
    0.0038126581348478794,
    0.02078579179942608,
    0.02128089778125286,
    0.02103692665696144,
    0.04044187813997269,
    0.04527149349451065,
    0.06626513600349426,
    0.06590833514928818,
    0.020994924008846283,
    0.019146455451846123,
    -0.10349921137094498,
    -0.06490100920200348,
    0.15852823853492737,
    0.03282894939184189,
    -0.06980697810649872,
    0.09037221223115921,
    0.05887169390916824,
    -0.010408074595034122,
    0.018476033583283424,
    0.00592939043417573,
    0.07490511238574982,
    -0.04766368120908737,
    0.0005423346301540732,
    0.09835074841976166,
    -0.02696409448981285,
    0.01553118135780096,
    0.04476957023143768,
    -0.053643807768821716,
    -0.03457209840416908,
    -0.01653541810810566,
    0.07909630239009857,
    -0.055919062346220016,
    0.0013198275119066238,
    0.05775408819317818,
    -0.05092911049723625,
    0.10828614234924316,
    0.0366232730448246,
    0.1107034683227539,
    0.01833817921578884,
    0.021283840760588646,
    0.05955083295702934
  ]
}