{
  "text": "Hookortracethefollowing: • generalPasteboardforthesystem-widegeneralpasteboard. • pasteboardWithName:create: andpasteboardWithUniqueNameforcustompasteboards. Detect Persistent Pasteboard Usage HookortracethedeprecatedsetPersistent: methodandverifyifit’sbeingcalled. Monitoring and Inspecting Pasteboard Items Whenmonitoringthepasteboards,thereisseveraldetailsthatmaybedynamicallyretrieved: • ObtainpasteboardnamebyhookingpasteboardWithName:create: andinspectingitsinputparametersorpaste- boardWithUniqueNameandinspectingitsreturnvalue. • Getthefirstavailablepasteboarditem: e.g.forstringsusestringmethod. Oruseanyoftheothermethodsfor thestandarddatatypes. • GetthenumberofitemswithnumberOfItems. • Checkforexistenceofstandarddatatypeswiththeconveniencemethods,e.g.hasImages,hasStrings,hasURLs (startinginiOS10). • Check for other data types (typically UTIs) with containsPasteboardTypes: inItemSet:. You may inspect for moreconcretedatatypeslike,forexampleanpictureaspublic.pngandpublic.tiff(UTIs)orforcustomdatasuch ascom.mycompany.myapp.mytype. Rememberthat,inthiscase,onlythoseappsthatdeclareknowledgeofthe typeareabletounderstandthedatawrittentothepasteboard. Thisisthesameaswehaveseeninthe“UIActivity Sharing”section. RetrievethemusingitemSetWithPasteboardTypes: andsettingthecorrespondingUTIs. • CheckforexcludedorexpiringitemsbyhookingsetItems:options: andinspectingitsoptionsforUIPasteboar- dOptionLocalOnlyorUIPasteboardOptionExpirationDate. Ifonlylookingforstringsyoumaywanttouseobjection’scommandios pasteboard monitor: Hooks into the iOS UIPasteboard class and polls the generalPasteboard every 5 seconds for data. If new data is found,differentfromthepreviouspoll,thatdatawillbedumpedtoscreen. 479\\nYoumayalsobuildyourownpasteboardmonitorthatmonitorsspecificinformationasseenabove. Forexample,thisscript(inspiredfromthescriptbehindobjection’spasteboardmonitor)readsthepasteboarditemsevery 5seconds,ifthere’ssomethingnewitwillprintit: const UIPasteboard =ObjC.classes.UIPasteboard; const Pasteboard =UIPasteboard.generalPasteboard(); varitems =\"\"; varcount =Pasteboard.changeCount().toString(); setInterval(function (){ const currentCount =Pasteboard.changeCount().toString(); const currentItems =Pasteboard.items().toString(); if(currentCount ===count){ return;} items =currentItems; count =currentCount; console.log('[*Pasteboardchanged]count:' +count + 'hasStrings:' +Pasteboard.hasStrings().toString()+ 'hasURLs:' +Pasteboard.hasURLs().toString()+ 'hasImages:' +Pasteboard.hasImages().toString()); console.log(items); },1000 *5); Intheoutputwecanseethefollowing: [*Pasteboardchanged]count:64hasStrings:truehasURLs:falsehasImages:false ( { \"public.utf8-plain-text\" =hola; } ) [*Pasteboardchanged]count:65hasStrings:truehasURLs:truehasImages:false ( { \"public.url\" =\"https://codeshare.frida.re/\"; \"public.utf8-plain-text\" =\"https://codeshare.frida.re/\"; } ) [*Pasteboardchanged]count:66hasStrings:falsehasURLs:falsehasImages:true ( { \"com.apple.uikit.image\" =\"<UIImage:0x1c42b23c0>size{571,264}orientation0scale1.000000\"; \"public.jpeg\" =\"<UIImage:0x1c44a1260>size{571,264}orientation0scale1.000000\"; \"public.png\" =\"<UIImage:0x1c04aaaa0>size{571,264}orientation0scale1.000000\"; } ) Youseethatfirstatextwascopiedincludingthestring“hola”,afterthataURLwascopiedandfinallyapicturewascopied. SomeofthemareavailableviadifferentUTIs. OtherappswillconsidertheseUTIstoallowpastingofthisdataornot. Testing for Sensitive Functionality Exposure Through IPC Platform: ios MASVSV1: MSTG-PLATFORM-4 MASVSV2: MASVS-PLATFORM-1 Testing Auto-Generated Screenshots for Sensitive Information Platform: ios MASVSV1: MSTG-STORAGE-9 MASVSV2: MASVS-PLATFORM-3 480\\nOverview Static Analysis Ifyouhavethesourcecode,searchfortheapplicationDidEnterBackgroundmethodtodeterminewhethertheapplica- tionsanitizesthescreenbeforebeingbackgrounded. Thefollowingisasampleimplementationusingadefaultbackgroundimage(overlayImage.png)whenevertheapplica- tionisbackgrounded,overridingthecurrentview: Swift: private varbackgroundImage:UIImageView? func applicationDidEnterBackground(_application:UIApplication){ letmyBanner =UIImageView(image:#imageLiteral(resourceName:\"overlayImage\")) myBanner.frame =UIScreen.main.bounds backgroundImage =myBanner window?.addSubview(myBanner) } func applicationWillEnterForeground(_application:UIApplication){ backgroundImage?.removeFromSuperview() } Objective-C: @property (UIImageView *)backgroundImage; -(void)applicationDidEnterBackground:(UIApplication *)application { UIImageView *myBanner =[[UIImageViewalloc]initWithImage:@\"overlayImage.png\"]; self.backgroundImage =myBanner; self.backgroundImage.bounds =UIScreen.mainScreen.bounds; [self.windowaddSubview:myBanner]; } -(void)applicationWillEnterForeground:(UIApplication *)application { [self.backgroundImageremoveFromSuperview]; } ThissetsthebackgroundimagetooverlayImage.pngwhenevertheapplicationisbackgrounded. Itpreventssensitive dataleaksbecauseoverlayImage.pngwillalwaysoverridethecurrentview. Dynamic Analysis YoucanuseavisualapproachtoquicklyvalidatethistestcaseusinganyiOSdevice(jailbrokenornot): 1. Navigate to an application screen that displays sensitive information, such as a username, an email address, or accountdetails. 2. BackgroundtheapplicationbyhittingtheHomebuttononyouriOSdevice. 3. Verifythatadefaultimageisshownasthetopviewelementinsteadoftheviewcontainingthesensitiveinformation. If required, you may also collect evidence by performing steps 1 to 3 on a jailbroken device or a non-jailbroken device afterrepackagingtheappwiththeFridaGadget. Afterthat, connecttotheiOSdeviceperSSHorbyothermeansand navigatetotheSnapshotsdirectory. ThelocationmaydifferoneachiOSversionbutit’susuallyinsidetheapp’sLibrary directory. Forinstance,oniOS14.5theSnapshotsdirectoryislocatedat: /var/mobile/Containers/Data/Application/$APP_ID/Library/SplashBoard/Snapshots/sceneID:$APP_NAME-default/ Thescreenshotsinsidethatfoldershouldnotcontainanysensitiveinformation. Testing UIActivity Sharing 481\\nPlatform: ios MASVSV1: MSTG-PLATFORM-4 MASVSV2: MASVS-PLATFORM-1 Overview Static Analysis Sending Items WhentestingUIActivitySharingyoushouldpayspecialattentionto: • thedata(items)beingshared, • thecustomactivities, • theexcludedactivitytypes. Data sharing via UIActivity works by creating a UIActivityViewController and passing it the desired items (URLs, text,apicture)oninit(activityItems: applicationActivities:). Aswementionedbefore,itispossibletoexcludesomeofthesharingmechanismsviathecontroller’sexcludedActiv- ityTypesproperty. ItishighlyrecommendedtodothetestsusingthelatestversionsofiOSasthenumberofactivity typesthatcanbeexcludedcanincrease. Thedevelopershavetobeawareofthisandexplicitlyexcludetheonesthat arenotappropriatefortheappdata. Someactivitytypesmightnotbeevendocumentedlike“CreateWatchFace”. Ifhavingthesourcecode,youshouldtakealookattheUIActivityViewController: • Inspecttheactivitiespassedtotheinit(activityItems:applicationActivities:) method. • Checkifitdefinescustomactivities(alsobeingpassedtothepreviousmethod). • VerifytheexcludedActivityTypes,ifany. Ifyouonlyhavethecompiled/installedapp,trysearchingforthepreviousmethodandproperty,forexample: $rabin2 -zqTelegram\\X.app/Telegram\\X |grep -iactivityItems 0x1000df0344544initWithActivityItems:applicationActivities: Receiving Items Whenreceivingitems,youshouldcheck: • iftheappdeclarescustomdocumenttypesbylookingintoExported/ImportedUTIs(“Info”taboftheXcodeproject). ThelistofallsystemdeclaredUTIs(UniformTypeIdentifiers)canbefoundinthearchivedAppleDeveloperDocu- mentation. • iftheappspecifiesanydocumenttypesthatitcanopenbylookingintoDocumentTypes(“Info”taboftheXcode project). Ifpresent,theyconsistofnameandoneormoreUTIsthatrepresentthedatatype(e.g.“public.png”for PNGfiles). iOSusesthistodetermineiftheappiseligibletoopenagivendocument(specifyingExported/Imported UTIsisnotenough). • iftheappproperlyverifiesthereceiveddatabylookingintotheimplementationofapplication:openURL:options: (oritsdeprecatedversionUIApplicationDelegate application:openURL:sourceApplication:annotation:) in theappdelegate. IfnothavingthesourcecodeyoucanstilltakealookintotheInfo.plistfileandsearchfor: • UTExportedTypeDeclarations/UTImportedTypeDeclarationsiftheappdeclaresexported/importedcustomdoc- umenttypes. • CFBundleDocumentTypestoseeiftheappspecifiesanydocumenttypesthatitcanopen. AverycompleteexplanationabouttheuseofthesekeyscanbefoundonStackoverflow. Let’sseeareal-worldexample. WewilltakeaFileManagerappandtakealookatthesekeys. Weusedobjectionhereto readtheInfo.plistfile. 482\\nobjection --gadget SomeFileManagerruniosplistcatInfo.plist NotethatthisisthesameasifwewouldretrievetheIPAfromthephoneoraccessedviae.g.SSHandnavigated tothecorrespondingfolderintheIPA/appsandbox. However,withobjectionwearejustonecommandawayfrom ourgoalandthiscanbestillconsideredstaticanalysis. Thefirstthingwenoticedisthatappdoesnotdeclareanyimportedcustomdocumenttypesbutwecouldfindacouple ofexportedones: UTExportedTypeDeclarations= ( { UTTypeConformsTo= ( \"public.data\" ); UTTypeDescription=\"SomeFileManagerFiles\"; UTTypeIdentifier=\"com.some.filemanager.custom\"; UTTypeTagSpecification= { \"public.filename-extension\"= ( ipa, deb, zip, rar, tar, gz, ... key, pem, p12, cer ); }; } ); TheappalsodeclaresthedocumenttypesitopensaswecanfindthekeyCFBundleDocumentTypes: CFBundleDocumentTypes= ( { ... CFBundleTypeName=\"SomeFileManagerFiles\"; LSItemContentTypes= ( \"public.content\", \"public.data\", \"public.archive\", \"public.item\", \"public.database\", \"public.calendar-event\", ... ); } ); We can see that this File Manager will try to open anything that conforms to any of the UTIs listed in LSItemContent- Typesandit’sreadytoopenfileswiththeextensionslistedinUTTypeTagSpecification/\"public.filename-extension\". Pleasetakeanoteofthisbecauseitwillbeusefulifyouwanttosearchforvulnerabilitieswhendealingwiththedifferent typesoffileswhenperformingdynamicanalysis. Dynamic Analysis Sending Items Therearethreemainthingsyoucaneasilyinspectbyperformingdynamicinstrumentation: • TheactivityItems: anarrayoftheitemsbeingshared. Theymightbeofdifferenttypes,e.g.onestringandone picturetobesharedviaamessagingapp. • TheapplicationActivities: anarrayofUIActivityobjectsrepresentingtheapp’scustomservices. • TheexcludedActivityTypes: anarrayoftheActivityTypesthatarenotsupported,e.g.postToFacebook. Toachievethisyoucandotwothings: 483\\n• Hookthemethodwehaveseeninthestaticanalysis(init(activityItems: applicationActivities:)) toget theactivityItemsandapplicationActivities. • FindouttheexcludedactivitiesbyhookingexcludedActivityTypesproperty. Let’sseeanexampleusingTelegramtoshareapictureandatextfile. Firstpreparethehooks,wewillusetheFridaREPL andwriteascriptforthis: Interceptor.attach( ObjC.classes. UIActivityViewController['-initWithActivityItems:applicationActivities:'].implementation,{ onEnter:function (args){ printHeader(args) this.initWithActivityItems =ObjC.Object(args[2]); this.applicationActivities =ObjC.Object(args[3]); console.log(\"initWithActivityItems:\" +this.initWithActivityItems); console.log(\"applicationActivities:\" +this.applicationActivities); }, onLeave:function (retval){ printRet(retval); } });",
  "metadata": {
    "doc_id": "OWASP_MASTG",
    "chunk_id": 158
  },
  "embedding": [
    -0.005276247393339872,
    -0.17957426607608795,
    -0.048163384199142456,
    -0.008947153575718403,
    -0.03297290578484535,
    0.03425397351384163,
    0.04995615407824516,
    -0.04801604524254799,
    0.0022587934508919716,
    -0.05112564191222191,
    0.028422635048627853,
    -0.03221118822693825,
    -0.02367301471531391,
    -0.0625685453414917,
    -0.10481241345405579,
    -0.013251190073788166,
    0.06385155022144318,
    -0.008290501311421394,
    0.024712232872843742,
    -0.025025347247719765,
    0.024709977209568024,
    -0.009259991347789764,
    0.011136380024254322,
    -0.01070141326636076,
    0.019514624029397964,
    0.05767078325152397,
    -0.047316476702690125,
    -0.1038602963089943,
    0.019169380888342857,
    0.002902217907831073,
    0.017618460580706596,
    -0.03759394586086273,
    0.10091923922300339,
    -0.018393229693174362,
    0.057407770305871964,
    0.022938312962651253,
    -0.014498855918645859,
    -0.007881416007876396,
    0.026755210012197495,
    -0.10536111891269684,
    -0.02947562001645565,
    -0.08345623314380646,
    -0.003468442475423217,
    0.08130835741758347,
    -0.01918083056807518,
    0.06753524392843246,
    -0.03339559584856033,
    -0.08071146160364151,
    -0.0496973916888237,
    0.08198884129524231,
    0.019309697672724724,
    -0.06281445175409317,
    0.025512006133794785,
    -0.029597410932183266,
    -0.05582780763506889,
    -0.05651096999645233,
    0.04429575800895691,
    0.026426997035741806,
    0.07778676599264145,
    0.05002469941973686,
    -0.019143300130963326,
    0.020297124981880188,
    -0.0014569921186193824,
    0.027847105637192726,
    -0.02347678318619728,
    0.12606322765350342,
    -0.013310138136148453,
    -0.032838623970746994,
    -0.01272144541144371,
    -0.03100421093404293,
    -0.03558451682329178,
    0.06768964976072311,
    -0.08175329864025116,
    0.04327576607465744,
    0.03967314213514328,
    0.08631962537765503,
    0.002260444452986121,
    0.000881206535268575,
    -0.0562613308429718,
    -0.1471308022737503,
    0.05570261552929878,
    0.04500206187367439,
    0.06816266477108002,
    0.0798620879650116,
    0.06931310147047043,
    0.0650300458073616,
    -0.04994573816657066,
    -0.007885176688432693,
    0.02430015429854393,
    -0.05000230297446251,
    0.037661995738744736,
    0.005607155617326498,
    0.04736214131116867,
    -0.007690836675465107,
    -0.0006886923220008612,
    -0.010243997909128666,
    -0.12290932238101959,
    0.04941946268081665,
    -0.058888696134090424,
    0.01381920650601387,
    -0.051968660205602646,
    0.06657766550779343,
    -0.035612523555755615,
    -0.01406956184655428,
    0.04272789880633354,
    -0.025282420217990875,
    -0.02241879142820835,
    -0.05399920418858528,
    -0.04033607244491577,
    0.046147026121616364,
    0.017166806384921074,
    0.027589796110987663,
    0.011620513163506985,
    -0.03279207646846771,
    0.12141136080026627,
    -0.04942799732089043,
    0.0688706487417221,
    0.0020651870872825384,
    0.0377579964697361,
    0.01836881972849369,
    0.042518362402915955,
    0.014083867892622948,
    0.0019489749101921916,
    -0.041697077453136444,
    -0.019007019698619843,
    0.06564583629369736,
    0.024340173229575157,
    1.808733892294223e-32,
    0.05958303064107895,
    0.015988584607839584,
    0.010072414763271809,
    0.0085099833086133,
    -0.03752445429563522,
    -0.030597932636737823,
    0.087787926197052,
    0.08661523461341858,
    0.01796618290245533,
    -0.022613225504755974,
    0.033666037023067474,
    -0.015582817606627941,
    0.007467476185411215,
    0.05849888175725937,
    0.004337537568062544,
    0.05475234240293503,
    -0.022298336029052734,
    0.0225796140730381,
    -0.025647854432463646,
    0.046418990939855576,
    -0.0053588771261274815,
    -0.011233263649046421,
    0.037448700517416,
    0.06422287225723267,
    0.030802981927990913,
    -0.009572726674377918,
    -0.06275168806314468,
    0.04208211228251457,
    -0.016535507515072823,
    0.025593196973204613,
    -0.07020524889230728,
    -0.10242519527673721,
    -0.0853864848613739,
    -0.06183155998587608,
    -0.07439669221639633,
    -0.0526265874505043,
    0.03188969939947128,
    -0.010395393706858158,
    -0.0030327888671308756,
    0.021597648039460182,
    -0.036713309586048126,
    -0.037136249244213104,
    -0.08457169681787491,
    -0.0083398362621665,
    0.005733160302042961,
    -0.13861845433712006,
    -0.031138330698013306,
    0.11068461835384369,
    0.0034848530776798725,
    -0.03578685596585274,
    0.03598598763346672,
    0.016896652057766914,
    0.0383148267865181,
    -0.10824108123779297,
    -0.0659349113702774,
    -0.05170060694217682,
    -0.033614739775657654,
    0.04641424119472504,
    0.09002722054719925,
    0.03601015731692314,
    0.02014227770268917,
    0.06891701370477676,
    -0.02223382145166397,
    0.03543376177549362,
    -0.01432669349014759,
    0.06882486492395401,
    0.042523887008428574,
    -0.08201596140861511,
    -0.04402817785739899,
    -0.07459533214569092,
    0.023410417139530182,
    -0.06176864728331566,
    -0.08935972303152084,
    -0.01554363314062357,
    -0.07109492272138596,
    -0.10802733153104782,
    -0.036456599831581116,
    -0.06323966383934021,
    0.005482150707393885,
    -0.006890542805194855,
    0.03204547241330147,
    -0.039432864636182785,
    0.00563901336863637,
    -0.09199731796979904,
    0.014585626311600208,
    -0.030287250876426697,
    0.06084268540143967,
    -0.09968851506710052,
    -0.10524091124534607,
    0.03516750410199165,
    0.06399547308683395,
    0.0037212457973510027,
    -0.057665176689624786,
    0.02958361990749836,
    0.0046870531514286995,
    -1.7676272956563492e-32,
    0.024849124252796173,
    -0.0014660728629678488,
    -0.038907766342163086,
    0.05788913741707802,
    -0.06496088951826096,
    -0.04698577895760536,
    -0.06358709931373596,
    0.03911091014742851,
    -0.022567804902791977,
    -0.04859129711985588,
    0.006985317450016737,
    0.02766646072268486,
    -0.02697618305683136,
    -0.032508257776498795,
    0.02325424551963806,
    0.09056206047534943,
    -0.044604890048503876,
    0.055006738752126694,
    -0.03298666700720787,
    -0.051635630428791046,
    0.02953086420893669,
    0.027774173766374588,
    0.09615641087293625,
    0.08236338198184967,
    -0.05449066683650017,
    -0.001380498637445271,
    0.022348174825310707,
    -0.012582707218825817,
    0.0667266845703125,
    -0.004007935523986816,
    0.0010592634789645672,
    0.1054583191871643,
    -0.043787937611341476,
    -0.026331886649131775,
    -0.037197813391685486,
    -0.026783417910337448,
    -0.017921114340424538,
    0.028549157083034515,
    -0.035092566162347794,
    0.08782114088535309,
    0.04567741975188255,
    0.03038073144853115,
    -0.029862936586141586,
    0.01952805183827877,
    -0.028992755338549614,
    -0.01885354332625866,
    -0.07611382007598877,
    0.027582867071032524,
    0.015010696835815907,
    0.011607912369072437,
    -0.024736689403653145,
    -0.09997820109128952,
    -0.0023930214811116457,
    0.00203689094632864,
    -0.032249655574560165,
    0.13252411782741547,
    0.04605675861239433,
    0.01798572577536106,
    -0.026002781465649605,
    -0.04264681413769722,
    0.017150282859802246,
    -0.0475018247961998,
    -0.05056743323802948,
    -0.022438736632466316,
    0.1560772955417633,
    0.03067568689584732,
    0.07417959719896317,
    0.023322803899645805,
    -0.03901033103466034,
    0.022464636713266373,
    0.02293020486831665,
    -0.009129577316343784,
    -0.03509165346622467,
    -0.06797861307859421,
    -0.047847211360931396,
    0.06716722249984741,
    0.047872934490442276,
    -0.001638879650272429,
    -0.008291150443255901,
    -0.034097183495759964,
    -0.06025098264217377,
    0.04120578616857529,
    0.03976269066333771,
    -0.016064478084445,
    -0.01015463937073946,
    -0.005004729609936476,
    -0.06711103767156601,
    0.07927604019641876,
    -0.01574055850505829,
    -0.006121844984591007,
    -0.04751018062233925,
    -0.02469094656407833,
    -0.007770138792693615,
    -0.018162809312343597,
    -0.022050930187106133,
    -6.154607490316266e-08,
    0.018871977925300598,
    0.000241200570599176,
    0.016599087044596672,
    0.03909412771463394,
    0.03715259209275246,
    -0.010528124868869781,
    0.007290324196219444,
    0.007900635711848736,
    -0.01510993205010891,
    -0.018545731902122498,
    -0.01485118642449379,
    0.03538663312792778,
    -0.03264888375997543,
    -0.023013092577457428,
    0.0528813861310482,
    -0.030751295387744904,
    0.025857392698526382,
    -0.03056742064654827,
    -0.06840187311172485,
    -0.07109814882278442,
    0.08737725019454956,
    -0.05261116474866867,
    0.04908853396773338,
    -0.024175336584448814,
    -0.030155150219798088,
    -0.07857350260019302,
    0.03185674548149109,
    0.09742043167352676,
    0.040036145597696304,
    -0.00857932586222887,
    0.018288640305399895,
    -0.014678637497127056,
    0.02061268500983715,
    -0.130575492978096,
    0.0020085149444639683,
    0.06639578193426132,
    0.04777837172150612,
    -0.05501259118318558,
    0.022818777710199356,
    0.014074313454329967,
    -0.04219244420528412,
    -0.04612814262509346,
    -0.061438824981451035,
    -0.010056567378342152,
    -0.006874498911201954,
    0.029873941093683243,
    -0.011518233455717564,
    0.07596413791179657,
    -0.008764389902353287,
    -0.0896560400724411,
    -0.09332384169101715,
    -0.04359874874353409,
    0.015311374329030514,
    0.10290539264678955,
    -0.07321105897426605,
    -0.0022757824044674635,
    0.014940571039915085,
    0.06794626265764236,
    0.1409110426902771,
    0.01838066056370735,
    0.04153793677687645,
    0.03329882398247719,
    0.01956913061439991,
    -0.011733155697584152
  ]
}