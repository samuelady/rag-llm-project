{
  "text": "and library memory addresses hard to predict, thereby preventing attacks such as the return-to-libc attack, whichinvolvesthememoryaddressesofbasiclibcfunctions. TheXNmechanismallowsiOStomarkselectedmemorysegmentsofaprocessasnon-executable. OniOS,theprocess stackandheapofuser-modeprocessesismarkednon-executable. Pagesthatarewritablecannotbemarkedexecutable atthesametime. Thispreventsattackerstoexecutemachinecodeinjectedintothestackorheap. 330\\nSoftware Development on iOS Like other platforms, Apple provides a Software Development Kit (SDK) that helps developers to develop, install, run, andtestnativeiOSApps. XcodeisanIntegratedDevelopmentEnvironment(IDE)forApplesoftwaredevelopment. iOS applicationsaredevelopedinObjective-CorSwift. Objective-C is an object-oriented programming language that adds Smalltalk-style messaging to the C programming language. ItisusedonmacOStodevelopdesktopapplicationsandoniOStodevelopmobileapplications. Swiftisthe successorofObjective-CandallowsinteroperabilitywithObjective-C. SwiftwasintroducedwithXcode6in2014. Onanon-jailbrokendevice,therearetwowaystoinstallanapplicationoutoftheAppStore: 1. viaEnterpriseMobileDeviceManagement. Thisrequiresacompany-widecertificatesignedbyApple. 2. viasideloading, i.e., bysigninganappwithadeveloper’scertificateandinstallingitonthedeviceviaXcode(or CydiaImpactor). Alimitednumberofdevicescanbeinstalledtowiththesamecertificate. Apps on iOS iOSappsaredistributedinIPA(iOSAppStorePackage)archives. TheIPAfileisaZIP-compressedarchivethatcontains allthecodeandresourcesrequiredtoexecutetheapp. IPAfileshaveabuilt-indirectorystructure. Theexamplebelowshowsthisstructureatahighlevel: • /Payload/foldercontainsalltheapplicationdata. Wewillcomebacktothecontentsofthisfolderinmoredetail. • /Payload/Application.app contains the application data itself (ARM-compiled code) and associated static re- sources. • /iTunesArtworkisa512x512pixelPNGimageusedastheapplication’sicon. • /iTunesMetadata.plistcontainsvariousbitsofinformation,includingthedeveloper’snameandID,thebundle identifier,copyrightinformation,genre,thenameoftheapp,releasedate,purchasedate,etc. • /WatchKitSupport/WKisanexampleofanextensionbundle. Thisspecificbundlecontainstheextensiondelegate andthecontrollersformanagingtheinterfacesandrespondingtouserinteractionsonanAppleWatch. IPA Payloads - A Closer Look Let’stakeacloserlookatthedifferentfilesintheIPAcontainer. Appleusesarelativelyflatstructurewithfewextraneous directoriestosavediskspaceandsimplifyfileaccess. Thetop-levelbundledirectorycontainstheapplication’sexecutable fileandalltheresourcestheapplicationuses(forexample,theapplicationicon,otherimages,andlocalizedcontent. • MyApp: Theexecutablefilecontainingthecompiled(unreadable)applicationsourcecode. • Application: Applicationicons. • Info.plist: Configurationinformation,suchasbundleID,versionnumber,andapplicationdisplayname. • Launchimages: Imagesshowingtheinitialapplicationinterfaceinaspecificorientation. Thesystemusesoneof theprovidedlaunchimagesasatemporarybackgrounduntiltheapplicationisfullyloaded. • MainWindow.nib: Default interface objects that are loaded when the application is launched. Other interface objectsaretheneitherloadedfromothernibfilesorcreatedprogrammaticallybytheapplication. • Settings.bundle: Application-specificpreferencestobedisplayedintheSettingsapp. • Customresourcefiles: Non-localizedresourcesareplacedinthetop-leveldirectoryandlocalizedresourcesare placed in language-specific subdirectories of the application bundle. Resources include nib files, images, sound files,configurationfiles,stringsfiles,andanyothercustomdatafilestheapplicationuses. Alanguage.lprojfolderexistsforeachlanguagethattheapplicationsupports. Itcontainsastoryboardandstringsfile. • AstoryboardisavisualrepresentationoftheiOSapplication’suserinterface. Itshowsscreensandtheconnections betweenthosescreens. • Thestringsfileformatconsistsofoneormorekey-valuepairsandoptionalcomments. 331\\nOn a jailbroken device, you can recover the IPA for an installed iOS app using different tools that allow decrypting the mainappbinaryandreconstructtheIPAfile. Similarly,onajailbrokendeviceyoucaninstalltheIPAfilewithIPAInstaller. During mobile security assessments, developers often give you the IPA directly. They can send you the actual file or provideaccesstothedevelopment-specificdistributionplatformtheyuse,e.g.TestFlightorVisualStudioAppCenter. App Permissions IncontrasttoAndroidapps(beforeAndroid6.0(APIlevel23)), iOSappsdon’thavepre-assignedpermissions. Instead, theuserisaskedtograntpermissionduringruntime,whentheappattemptstouseasensitiveAPIforthefirsttime. Apps thathavebeengrantedpermissionsarelistedintheSettings>Privacymenu,allowingtheusertomodifytheapp-specific setting. Applecallsthispermissionconceptprivacycontrols. iOSdeveloperscan’tsetrequestedpermissionsdirectly,thesewillberequestedindirectlywhenaccessingsensitiveAPIs. Forexample,whenaccessingauser’scontacts,anycalltoCNContactStoreblockstheappwhiletheuserisbeingasked tograntordenyaccess. StartingwithiOS10.0,appsmustincludeusagedescriptionkeysforthetypesofpermissions theyrequestanddatatheyneedtoaccess(e.g.,NSContactsUsageDescription). ThefollowingAPIsrequireuserpermission: • Contacts • Microphone • Calendars • Camera • Reminders • HomeKit • Photos • Health • Motionactivityandfitness • Speechrecognition • LocationServices • Bluetoothsharing • MediaLibrary • Socialmediaaccounts DeviceCheck The DeviceCheck framework, including its components DeviceCheck and App Attest, helps you prevent fraudulent use of your services. It consists of a framework that you use from your app and an Apple server which is accessible only toyourownserver. DeviceCheckallowsyoutopersistentlystoreinformationonthedeviceandonAppleservers. The storedinformationremainsintactacrossappreinstallation,devicetransfers,orresets,withtheoptiontoresetthisdata periodically. DeviceCheckistypicallyusedtomitigatefraudbyrestrictingaccesstosensitiveresources. Forexample,limitingpromo- tions to once per device, identify and flag fraudulent devices, etc. However, it definitely cannot prevent all fraud. For example,itisnotmeanttodetectcompromisedoperatingsystems(aka. jailbreakdetection). 332\\nFormoreinformation,refertotheDeviceCheckdocumentation. App Attest App Attest, available under the DeviceCheck framework, helps you verify instances of the app running on a device by enablingappstoattachahardware-backedassertiontorequests,ensuringtheyoriginatefromthelegitimateappona genuineAppledevice. Thisfeatureaidsinpreventingmodifiedappsfromcommunicatingwithyourserver. Theprocessinvolvesgeneratingandvalidatingcryptographickeys, alongwithasetofverificationsperformedbyyour server,ensuringtheauthenticityoftherequest. ItisimportanttonotethatwhileAppAttestenhancessecurity,itdoes notguaranteecompleteprotectionagainstallformsoffraudulentactivities. Formoredetailedinformation,refertotheWWDC2021session,alongwiththeAppAttestdocumentationandAppAttest implementationguide. 333\\niOS Security Testing Inthischapter,we’lldiveintosettingupasecuritytestingenvironmentandintroduceyoutosomepracticalprocesses andtechniquesfortestingthesecurityofiOSapps. ThesearethebuildingblocksfortheMASTGtestcases. iOS Testing Setup AlthoughyoucanuseaLinuxorWindowshostcomputerfortesting,you’llfindthatmanytasksaredifficultorimpossible ontheseplatforms. Inaddition,theXcodedevelopmentenvironmentandtheiOSSDKareonlyavailableformacOS.This means that you’ll definitely want to work on macOS for source code analysis and debugging (it also makes black box testingeasier). Host Device ThefollowingisthemostbasiciOSapptestingsetup: • IdeallymacOShostcomputerwithadminrights • XcodeandXcodeCommandLineToolsinstalled. • Wi-Finetworkthatpermitsclient-to-clienttraffic. • AtleastonejailbrokeniOSdevice(ofthedesirediOSversion). • BurpSuiteorotherinterceptionproxytool. Obtaining the UDID of an iOS device TheUDIDisa40-digituniquesequenceoflettersandnumberstoidentifyaniOSdevice. YoucanfindtheUDIDofyour iOSdeviceonmacOSCatalinaonwardsintheFinderapp,asiTunesisnotavailableanymoreinCatalina. OpenFinderand selecttheconnectediOSdeviceinthesidebar. Clickonthetextcontainingthemodel, storagecapacity, andbatteryinformation, anditwilldisplaytheserialnumber, UDID,andmodelinstead: 334\\nYoucancopytheUDIDbyrightclickingonit. ItisalsopossibletogettheUDIDviavariouscommandlinetoolsonmacOSwhilethedeviceisattachedviaUSB: • ByusingtheI/ORegistryExplorertoolioreg: $ioreg -pIOUSB -l|grep \"USBSerial\" | \"USBSerial Number\" =\"9e8ada44246cee813e2f8c1407520bf2f84849ec\" • Byusingideviceinstaller(alsoavailableonLinux): $brew installideviceinstaller $idevice_id -l 316f01bd160932d2bf2f95f1f142bc29b1c62dbc • Byusingthesystem_profiler: $system_profiler SPUSBDataType |sed-n-e'/iPad/,/Serial/p;/iPhone/,/Serial/p;/iPod/,/Serial/p' |grep \"SerialNumber:\" 2019-09-0810:18:03.920 system_profiler[13251:1050356]SPUSBDevice:IOCreatePlugInInterfaceForServicefailed0xe00002be SerialNumber: 64655621de6ef5e56a874d63f1e1bdd14f7103b1 • Byusinginstruments: instruments -sdevices Testing on a real device (Jailbroken) You should have a jailbroken iPhone or iPad for running tests. These devices allow root access and tool installation, makingthesecuritytestingprocessmorestraightforward. Ifyoudon’thaveaccesstoajailbrokendevice,youcanapply theworkaroundsdescribedlaterinthischapter,butbepreparedforamoredifficultexperience. Testing on the iOS Simulator UnliketheAndroidemulator,whichfullyemulatesthehardwareofanactualAndroiddevice,theiOSSDKsimulatoroffers a higher-level simulation of",
  "metadata": {
    "doc_id": "OWASP_MASTG",
    "chunk_id": 121
  },
  "embedding": [
    -0.03654547035694122,
    -0.02166205830872059,
    -0.029946643859148026,
    -0.009152518585324287,
    0.00450925761833787,
    -0.011205777525901794,
    0.013795791193842888,
    0.04883485659956932,
    -0.0072777001187205315,
    -0.007452159188687801,
    0.014858932234346867,
    -0.06033789739012718,
    -0.019679894670844078,
    0.00019540505309123546,
    0.005077121313661337,
    0.054980434477329254,
    0.02618502452969551,
    -0.011496632359921932,
    -0.03267248347401619,
    0.006357649806886911,
    0.021069103851914406,
    0.02368151769042015,
    -0.02286793850362301,
    0.06907641887664795,
    0.01351869571954012,
    -0.016224496066570282,
    -0.03478848561644554,
    -0.09653813391923904,
    -0.005608693230897188,
    -0.007355521898716688,
    0.06641817837953568,
    -0.002841257257387042,
    0.045060619711875916,
    0.09172096103429794,
    0.040465082973241806,
    0.005453336518257856,
    0.03903976082801819,
    -0.06437214463949203,
    -0.039002906531095505,
    -0.1054333820939064,
    -0.09032545983791351,
    0.04343326389789581,
    -0.03602765500545502,
    0.17475156486034393,
    -0.05267702043056488,
    0.01632745936512947,
    0.01646961085498333,
    -0.013956435024738312,
    -0.05821174383163452,
    -0.009872539900243282,
    0.01913217455148697,
    0.0087270587682724,
    -0.017167462036013603,
    0.05763227865099907,
    0.08233524113893509,
    0.017989877611398697,
    -0.03896715119481087,
    0.0397045761346817,
    0.1123257726430893,
    0.15225382149219513,
    -0.0003940934839192778,
    0.028213249519467354,
    -0.003273166250437498,
    0.03501810505986214,
    -0.03000107780098915,
    0.01848340593278408,
    0.009567555040121078,
    -0.045048244297504425,
    0.07216385006904602,
    -0.08984395116567612,
    -0.01377169694751501,
    -0.02223176509141922,
    0.028146468102931976,
    0.059512827545404434,
    0.014944556169211864,
    0.009599698707461357,
    -0.01340171042829752,
    -0.028941938653588295,
    -0.04866940155625343,
    -0.14597953855991364,
    0.02553332969546318,
    0.07781952619552612,
    0.058610811829566956,
    0.07815269380807877,
    0.03157784789800644,
    0.037090279161930084,
    0.006204855628311634,
    0.008745488710701466,
    0.04705023393034935,
    0.10298527032136917,
    0.04847010225057602,
    -0.014145166613161564,
    0.0014615858672186732,
    -0.006329554133117199,
    0.07524687796831131,
    -0.02763885073363781,
    0.09136023372411728,
    -0.0806989073753357,
    -0.0659751445055008,
    0.020879089832305908,
    -0.003256491618230939,
    -0.034236371517181396,
    -0.02043016254901886,
    0.00857758428901434,
    0.017922833561897278,
    -0.06298407167196274,
    0.059994734823703766,
    -0.07540716975927353,
    -0.06301724165678024,
    0.07755426317453384,
    0.007585031911730766,
    0.007578878663480282,
    -0.008624507114291191,
    -0.07256106287240982,
    0.040637776255607605,
    0.00769834965467453,
    -0.01953987590968609,
    0.03463539481163025,
    0.06314399093389511,
    0.027244340628385544,
    -0.041876450181007385,
    0.07095832377672195,
    0.007314939517527819,
    -0.06423371285200119,
    -0.08486852049827576,
    -0.044666532427072525,
    -0.07422837615013123,
    1.4812101624916308e-32,
    -0.05242111533880234,
    -0.017587194219231606,
    -0.10275387018918991,
    0.00621808459982276,
    -0.017095835879445076,
    -0.14852270483970642,
    0.08343281596899033,
    0.10047032684087753,
    -0.005123937036842108,
    -0.006183303892612457,
    -0.000920022779610008,
    -0.01712247170507908,
    -7.280804857145995e-05,
    0.08929848670959473,
    0.10151436924934387,
    0.0011383240344002843,
    -0.04719651862978935,
    0.02999943308532238,
    -0.02752636931836605,
    0.03802924230694771,
    -0.03646909445524216,
    -0.03932849317789078,
    -0.019156930968165398,
    0.003002194222062826,
    0.08816909790039062,
    0.022606261074543,
    0.032761480659246445,
    -0.02303794026374817,
    0.06492087244987488,
    0.05214329808950424,
    -0.09246528148651123,
    0.02017905004322529,
    -0.07928938418626785,
    -0.03933620825409889,
    0.04993679001927376,
    -0.017087379470467567,
    0.0008054701029323041,
    -0.048037149012088776,
    -0.0020698392763733864,
    -0.014625516720116138,
    -0.0526278093457222,
    -0.00025412242393940687,
    -0.13048987090587616,
    -0.033660177141427994,
    0.07082605361938477,
    -0.05204208567738533,
    -0.040310800075531006,
    -0.044048093259334564,
    -0.047806516289711,
    -0.0341445691883564,
    0.028329182416200638,
    -0.022650854662060738,
    0.00036780646769329906,
    0.027441469952464104,
    -0.04798869043588638,
    0.0007257312536239624,
    -0.018953265622258186,
    -0.06263050436973572,
    0.04906890541315079,
    0.08607952296733856,
    -0.04891214519739151,
    0.02029680274426937,
    -0.020497631281614304,
    -0.02461443468928337,
    0.007863510400056839,
    0.031941186636686325,
    -0.02770848758518696,
    -0.09161712974309921,
    -0.03797551989555359,
    0.04061349108815193,
    -0.05783829465508461,
    -0.02180476114153862,
    0.02277268096804619,
    0.009144711308181286,
    -0.08548078685998917,
    0.040727000683546066,
    -0.01797870546579361,
    -0.0024640674237161875,
    -0.06513188779354095,
    -0.03334965929389,
    0.0037678699009120464,
    -0.001779791433364153,
    0.054054003208875656,
    -0.021689366549253464,
    -0.016449159011244774,
    -0.045535214245319366,
    -0.011810681782662868,
    -0.06776952743530273,
    -0.10089058429002762,
    0.10307428240776062,
    0.024020742624998093,
    -0.05933272838592529,
    -0.009153980761766434,
    0.0442289337515831,
    -0.10825895518064499,
    -1.4146059178900707e-32,
    0.026525497436523438,
    -0.05125413089990616,
    -0.07732422649860382,
    -0.02103634737432003,
    -0.09722888469696045,
    -0.01938668265938759,
    -0.06585174798965454,
    0.01089400053024292,
    -0.04958176612854004,
    -0.05861065536737442,
    -0.027983468025922775,
    0.04082107916474342,
    0.05852896720170975,
    0.013402211479842663,
    -0.02002824656665325,
    0.013544146902859211,
    -0.015369655564427376,
    -0.02405928634107113,
    -0.030625250190496445,
    0.055057186633348465,
    0.0077813658863306046,
    0.07021206617355347,
    0.0484326109290123,
    -0.058076731860637665,
    -0.010316730476915836,
    -0.012858724221587181,
    -0.041840214282274246,
    0.0695752426981926,
    0.08466195315122604,
    -0.019986920058727264,
    0.043574605137109756,
    0.005491232965141535,
    -0.07115716487169266,
    -0.09994705766439438,
    -0.019441423937678337,
    0.03465421125292778,
    -0.023790301755070686,
    -0.07321957498788834,
    -0.01979551836848259,
    -0.052430544048547745,
    0.1301477998495102,
    0.043828729540109634,
    -0.02725020982325077,
    0.0013564752880483866,
    0.03717352822422981,
    0.07978884130716324,
    -0.025261113420128822,
    0.03702203184366226,
    0.08226525038480759,
    -0.09343573451042175,
    0.09063355624675751,
    -0.029790937900543213,
    0.00037556744064204395,
    0.04995505139231682,
    -0.03417474776506424,
    0.038810499012470245,
    0.11552693694829941,
    -0.02785983681678772,
    0.013725189492106438,
    -0.01825372874736786,
    0.04923864081501961,
    -0.034031856805086136,
    0.03169114887714386,
    -0.07465672492980957,
    0.02062494121491909,
    0.005834608804434538,
    -0.04466758668422699,
    -0.04618728533387184,
    0.010946763679385185,
    0.027993006631731987,
    0.07081107050180435,
    -0.05109111964702606,
    -0.04720548912882805,
    -0.018622029572725296,
    -0.10283596068620682,
    0.051430631428956985,
    0.020983180031180382,
    -0.10428442060947418,
    -0.0736527144908905,
    0.0064726341515779495,
    0.010227437131106853,
    0.13340333104133606,
    0.05634650960564613,
    0.052237171679735184,
    0.06121081858873367,
    -0.0037033441476523876,
    -0.01589742861688137,
    0.016126619651913643,
    0.0018920463044196367,
    0.02770436927676201,
    -0.06439810991287231,
    0.030805613845586777,
    -0.03626268729567528,
    0.09542453289031982,
    -0.055936265736818314,
    -6.449135270258921e-08,
    -0.0017005889676511288,
    -0.02949809469282627,
    0.006075219251215458,
    -0.022395391017198563,
    0.025108227506279945,
    -0.007964948192238808,
    0.003149836091324687,
    0.04884004220366478,
    0.0727287009358406,
    -0.034416984766721725,
    0.03208232298493385,
    0.006456335075199604,
    -0.12151987850666046,
    0.04411059990525246,
    0.039274103939533234,
    0.033047616481781006,
    0.009481759741902351,
    -0.02642572671175003,
    -0.007776073180139065,
    -0.09457464516162872,
    0.000269478332484141,
    -0.02861114591360092,
    -0.0063166311010718346,
    0.002054491313174367,
    -0.0038738586008548737,
    -0.04603567346930504,
    0.1008310467004776,
    0.045022912323474884,
    0.003819584846496582,
    0.015187486074864864,
    -0.03965752199292183,
    0.025356225669384003,
    0.008249156177043915,
    -0.0018577827140688896,
    0.04366214573383331,
    0.12029467523097992,
    -0.001185207162052393,
    -0.04324249178171158,
    0.06586399674415588,
    -0.003462002845481038,
    -0.03531922772526741,
    0.011121513321995735,
    0.028391240164637566,
    0.010647619143128395,
    -0.00725850835442543,
    -0.049217935651540756,
    -0.055040281265974045,
    -0.009408394806087017,
    -0.002399661811068654,
    0.003642237978056073,
    -0.016234315931797028,
    0.029480425640940666,
    -0.05102480947971344,
    0.09230119735002518,
    -0.012827950529754162,
    0.058454155921936035,
    -0.03568428009748459,
    -0.12799695134162903,
    0.023384572938084602,
    0.031167445704340935,
    0.03306318446993828,
    -0.01995258778333664,
    0.06935572624206543,
    -0.0041567180305719376
  ]
}