{
  "text": "guarantees that the app cannot obtain the credentialsduringtheloginprocess(“credentialphishing”). • Almostnoauthenticationlogicmustbeaddedtotheappitself,preventingcodingerrors. Onthenegativeside,thereisnowaytocontrolthebehaviorofthebrowser(e.g.toactivatecertificatepinning). Embedded User Agent: Usinganembeddeduseragent isthemethodofchoiceforappsthatneedtooperatewithin a closed ecosystem, for example to interact with corporate accounts. For example, consider a banking app that uses OAuth2toretrieveanaccesstokenfromthebank’sauthenticationserver,whichisthenusedtoaccessanumberofmicro services. Inthatcase,credentialphishingisnotaviablescenario. Itislikelypreferabletokeeptheauthenticationprocess inthe(hopefully)carefullysecuredbankingapp,insteadofplacingtrustonexternalcomponents. Best Practices Foradditionalbestpracticesanddetailedinformationpleaserefertothefollowingsourcedocuments: • RFC6749-TheOAuth2.0AuthorizationFramework(October2012) • RFC8252-OAuth2.0forNativeApps(October2017) • RFC6819-OAuth2.0ThreatModelandSecurityConsiderations(January2013) Someofthebestpracticesincludebutarenotlimitedto: • Useragent: – Theusershouldhaveawaytovisuallyverifytrust(e.g.,TransportLayerSecurity(TLS)confirmation,website mechanisms). – Topreventman-in-the-middleattacks,theclientshouldvalidatetheserver’sfullyqualifieddomainnamewith thepublickeytheserverpresentedwhentheconnectionwasestablished. • Typeofgrant: – Onnativeapps,codegrantshouldbeusedinsteadofimplicitgrant. – Whenusingcodegrant,PKCE(ProofKeyforCodeExchange)shouldbeimplementedtoprotectthecodegrant. Makesurethattheserveralsoimplementsit. – Theauth“code”shouldbeshort-livedandusedimmediatelyafteritisreceived. Verifythatauthcodesonly resideontransientmemoryandaren’tstoredorlogged. • Clientsecrets: – Shared secrets should not be used to prove the client’s identity because the client could be impersonated (“client_id”alreadyservesasproof). Iftheydouseclientsecrets,besurethattheyarestoredinsecurelocal storage. • End-Usercredentials: – Securethetransmissionofend-usercredentialswithatransport-layermethod,suchasTLS. • Tokens: – Keepaccesstokensintransientmemory. – Accesstokensmustbetransmittedoveranencryptedconnection. – Reducethescopeanddurationofaccesstokenswhenend-to-endconfidentialitycan’tbeguaranteedorthe tokenprovidesaccesstosensitiveinformationortransactions. – Rememberthatanattackerwhohasstolentokenscanaccesstheirscopeandallresourcesassociatedwith themiftheappusesaccesstokensasbearertokenswithnootherwaytoidentifytheclient. – Storerefreshtokensinsecurelocalstorage;theyarelong-termcredentials. User Logout Failingtodestroytheserver-sidesessionisoneofthemostcommonlogoutfunctionalityimplementationerrors. Thiserror keepsthesessionortokenalive,evenaftertheuserlogsoutoftheapplication. Anattackerwhogetsvalidauthentication informationcancontinuetouseitandhijackauser’saccount. 55\\nManymobileappsdon’tautomaticallylogusersout. Therecanbevariousreasons,suchas: becauseitisinconvenient for customers, or because of decisions made when implementing stateless authentication. The application should still havealogoutfunction,anditshouldbeimplementedaccordingtobestpractices,destroyingalllocallystoredtokensor sessionidentifiers. Ifsessioninformationisstoredontheserver,itshouldbedestroyedbysendingalogoutrequesttothatserver. Incaseof ahigh-riskapplication,tokensshouldbeinvalidated. Notremovingtokensorsessionidentifierscanresultinunauthorized accesstotheapplicationincasethetokensareleaked. Notethatothersensitivetypesofinformationshouldberemoved aswell,asanyinformationthatisnotproperlyclearedmaybeleakedlater,forexampleduringadevicebackup. Herearedifferentexamplesofsessionterminationforproperserver-sidelogout: • Spring(Java) • RubyonRails • PHP Ifaccessandrefreshtokensareusedwithstatelessauthentication,theyshouldbedeletedfromthemobiledevice. The refreshtokenshouldbeinvalidatedontheserver. TheOWASPWebTestingGuide(WSTG-SESS-06)includesadetailedexplanationandmoretestcases. Supplementary Authentication Authenticationschemesaresometimessupplementedbypassivecontextualauthentication,whichcanincorporate: • Geolocation • IPaddress • Timeofday • Thedevicebeingused Ideally, in such a system the user’s context is compared to previously recorded data to identify anomalies that might indicateaccountabuseorpotentialfraud. Thisprocessistransparenttotheuser,butcanbecomeapowerfuldeterrent toattackers. Two-factor Authentication Two-factor authentication (2FA) is standard for apps that allow users to access sensitive functions and data. Common implementationsuseapasswordforthefirstfactorandanyofthefollowingasthesecondfactor: • One-timepasswordviaSMS(SMS-OTP) • One-timecodeviaphonecall • Hardwareorsoftwaretoken • PushnotificationsincombinationwithPKIandlocalauthentication Whateveroptionisused,italwaysmustbeenforcedandverifiedontheserver-sideandneveronclient-side. Otherwise the2FAcanbeeasilybypassedwithintheapp. The2FAcanbeperformedatloginorlaterintheuser’ssession. For example, after logging in to a banking app with a username and PIN, the user is authorized to perform non- sensitive tasks. Once the user attempts to execute a bank transfer, the second factor (“step-up authentication”) mustbepresented. BestPractices: • Don’trollyourown2FA:Therearevarioustwo-factorauthenticationmechanismsavailablewhichcanrangefrom third-partylibraries,usageofexternalappstoselfimplementedchecksbythedevelopers. • Useshort-livedOTPs: AOTPshouldbevalidforonlyacertainamountoftime(usually30seconds)andafterkeying intheOTPwronglyseveraltimes(usually3times)theprovidedOTPshouldbeinvalidatedandtheusershouldbe redirectedtothelandingpageorloggedout. • Storetokenssecurely: Topreventthesekindofattacks,theapplicationshouldalwaysverifysomekindofusertoken orotherdynamicinformationrelatedtotheuserthatwaspreviouslysecurelystored(e.g.intheKeychain/KeyStore). 56\\nSMS-OTP Althoughone-timepasswords(OTP)sentviaSMSareacommonsecondfactorfortwo-factorauthentication,thismethod has its shortcomings. In 2016, NIST suggested: “Dueto the risk that SMS messages may be intercepted or redirected, implementersofnewsystemsSHOULDcarefullyconsideralternativeauthenticators.”. Belowyouwillfindalistofsome relatedthreatsandsuggestionstoavoidsuccessfulattacksonSMS-OTP. Threats: • WirelessInterception: TheadversarycaninterceptSMSmessagesbyabusingfemtocellsandotherknownvulnera- bilitiesinthetelecommunicationsnetwork. • Trojans: InstalledmaliciousapplicationswithaccesstotextmessagesmayforwardtheOTPtoanothernumberor backend. • SIMSWAPAttack: Inthisattack,theadversarycallsthephonecompany,orworksforthem,andhasthevictim’s numbermovedtoaSIMcardownedbytheadversary. Ifsuccessful,theadversarycanseetheSMSmessageswhich aresenttothevictim’sphonenumber. Thisincludesthemessagesusedinthetwo-factorauthentication. • VerificationCodeForwardingAttack: Thissocialengineeringattackreliesonthetrusttheusershaveinthecompany providingtheOTP.Inthisattack,theuserreceivesacodeandislateraskedtorelaythatcodeusingthesamemeans inwhichitreceivedtheinformation. • Voicemail: Sometwo-factorauthenticationschemesallowtheOTPtobesentthroughaphonecallwhenSMSisno longerpreferredoravailable. Manyofthesecalls,ifnotanswered,sendtheinformationtovoicemail. Ifanattacker wasabletogainaccesstothevoicemail,theycouldalsousetheOTPtogainaccesstoauser’saccount. YoucanfindbelowseveralsuggestionstoreducethelikelihoodofexploitationwhenusingSMSforOTP: • Messaging: WhensendinganOTPviaSMS,besuretoincludeamessagethatletstheuserknow1)whattodoif theydidnotrequestthecode2)yourcompanywillnevercallortextthemrequestingthattheyrelaytheirpassword orcode. • Dedicated Channel: When using the OS push notification feature (APN on iOS and FCM on Android), OTPs can be sent securely to a registered application. This information is, compared to SMS, not accessible by other applications. AlternativelyofaOTPthepushnotificationcouldtriggerapop-uptoapprovetherequestedaccess. • Entropy: Use authenticators with high entropy to make OTPs harder to crack or guess and use at least 6 digits. Makesurethatdigitsareseparatesinsmallergroupsincasepeoplehavetorememberthemtocopythemtoyour app. • AvoidVoicemail: Ifauserpreferstoreceiveaphonecall,donotleavetheOTPinformationasavoicemail. SMS-OTPResearch: • [#dmitrienko]Dmitrienko,Alexandra,etal.“Onthe(in)securityofmobiletwo-factorauthentication.” International ConferenceonFinancialCryptographyandDataSecurity. Springer,Berlin,Heidelberg,2014. • [#grassi] Grassi, Paul A., et al. Digital identity guidelines: Authentication and lifecycle management (DRAFT). No.SpecialPublication(NISTSP)-800-63B.2016. • [#grassi2]Grassi,PaulA.,etal.Digitalidentityguidelines: Authenticationandlifecyclemanagement. No.Special Publication(NISTSP)-800-63B.2017. • [#konoth]Konoth,RadheshKrishnan,VictorvanderVeen,andHerbertBos. “Howanywherecomputingjustkilled yourphone-basedtwo-factorauthentication.” InternationalConferenceonFinancialCryptographyandDataSecu- rity. Springer,Berlin,Heidelberg,2016. • [#mulliner]Mulliner,Collin,etal.“SMS-basedone-timepasswords: attacksanddefense.” InternationalConference onDetectionofIntrusionsandMalware,andVulnerabilityAssessment. Springer,Berlin,Heidelberg,2013. • [#siadati]Siadati,Hossein,etal.“MindyourSMSes: Mitigatingsocialengineeringinsecondfactorauthentication.” Computers&Security65(2017): 14-28. • [#siadati2]Siadati,Hossein,ToanNguyen,andNasirMemon. “Verificationcodeforwardingattack(shortpaper).” InternationalConferenceonPasswords. Springer,Cham,2015. Transaction Signing with Push Notifications and PKI Anotheralternativeandstrongmechanismstoimplementasecondfactoristransactionsigning. Transactionsigningrequiresauthenticationoftheuser’sapprovalofcriticaltransactions. Asymmetriccryptographyisthe bestwaytoimplementtransactionsigning. Theappwillgenerateapublic/privatekeypairwhentheusersignsup,then 57\\nregistersthepublickeyonthebackend. TheprivatekeyissecurelystoredintheKeyStore(Android)orKeyChain(iOS). To authorize a transaction, the backend sends the mobile app a push notification containing the transaction data. The useristhenaskedtoconfirmordenythetransaction. Afterconfirmation,theuserispromptedtounlocktheKeychain(by enteringthePINorfingerprint),andthedataissignedwithuser’sprivatekey. Thesignedtransactionisthensenttothe server,whichverifiesthesignaturewiththeuser’spublickey. Login Activity and Device Blocking Itisabestpracticethatappsshouldinformtheuseraboutallloginactivitieswithintheappwiththepossibilityofblocking certaindevices. Thiscanbebrokendownintovariousscenarios: 1. Theapplicationprovidesapushnotificationthemomenttheiraccountisusedonanotherdevicetonotifytheuser ofdifferentactivities. Theusercanthenblockthisdeviceafteropeningtheappviathepush-notification. 2. The application provides an overview of the last session",
  "metadata": {
    "doc_id": "OWASP_MASTG",
    "chunk_id": 45
  },
  "embedding": [
    -0.029874607920646667,
    -0.03187880665063858,
    -0.057540781795978546,
    -0.09176464378833771,
    -0.04105430468916893,
    -0.019313504919409752,
    0.060626257210969925,
    0.026119345799088478,
    0.06035931780934334,
    -0.01889672316610813,
    0.028439337387681007,
    -0.046676669269800186,
    0.07103221118450165,
    -0.0055204108357429504,
    0.07403551787137985,
    0.03733290359377861,
    0.121247299015522,
    0.051328059285879135,
    -0.06202790141105652,
    0.003768063150346279,
    0.016213303431868553,
    -0.01641116477549076,
    -0.00953240878880024,
    0.054160382598638535,
    -0.019514795392751694,
    -0.12531088292598724,
    -0.050960566848516464,
    -0.06750393658876419,
    -0.0013510583667084575,
    0.038494616746902466,
    0.030571389943361282,
    -0.0041807773523032665,
    -0.051654305309057236,
    -0.009273596107959747,
    0.023877043277025223,
    -0.039224039763212204,
    -0.00854443944990635,
    0.05631101131439209,
    -0.04319208115339279,
    -0.023010646924376488,
    -0.056060731410980225,
    -0.04398282244801521,
    -0.09219053387641907,
    0.034113626927137375,
    -0.03746514767408371,
    -0.04480859264731407,
    0.007962756790220737,
    0.004713758826255798,
    -0.03682037815451622,
    0.07087128609418869,
    -0.00044793638517148793,
    0.008391286246478558,
    0.020504990592598915,
    0.0748734101653099,
    -0.10815204679965973,
    0.016262007877230644,
    -0.015598519705235958,
    0.0035312939435243607,
    -0.0010530268773436546,
    0.036641355603933334,
    0.038546979427337646,
    -0.02746707759797573,
    0.02581588551402092,
    0.03602311387658119,
    3.700984234455973e-05,
    0.06439303606748581,
    -0.06201830878853798,
    -0.03274235129356384,
    0.030950095504522324,
    0.021252349019050598,
    -0.035989582538604736,
    -0.08130394667387009,
    -0.0985492542386055,
    -0.06112850829958916,
    0.02690761536359787,
    0.03135095164179802,
    -0.01465007197111845,
    0.006408246234059334,
    0.07431422919034958,
    -0.1630648374557495,
    0.06724211573600769,
    0.07324343174695969,
    0.03765086084604263,
    0.05229666829109192,
    -0.04002367705106735,
    0.06739041954278946,
    0.02770429663360119,
    -0.027988919988274574,
    0.0443972572684288,
    0.03087886981666088,
    0.0417209155857563,
    -0.015441949479281902,
    0.028615692630410194,
    -0.08640728890895844,
    0.1014220342040062,
    -0.006433262024074793,
    -0.05244296044111252,
    -0.023906521499156952,
    -0.042173076421022415,
    0.01863691210746765,
    0.013746420852839947,
    -0.03620639070868492,
    -0.013662898913025856,
    -0.008284853771328926,
    0.06388065963983536,
    -0.002951517701148987,
    0.031734708696603775,
    -0.06636384129524231,
    0.11518782377243042,
    0.05636125057935715,
    0.014648212119936943,
    -0.013562951236963272,
    0.06330779939889908,
    -0.001248027547262609,
    0.054312463849782944,
    0.07382690161466599,
    -0.04349232837557793,
    0.07105137407779694,
    0.08129468560218811,
    0.051143158227205276,
    -0.0037501570768654346,
    0.021941326558589935,
    0.08207716047763824,
    -0.11855452507734299,
    0.012310507707297802,
    0.008508053608238697,
    -0.05841470882296562,
    2.178623907868389e-32,
    -0.052172351628541946,
    0.04034345969557762,
    -0.004919826053082943,
    0.007916077971458435,
    -0.024017076939344406,
    -0.020745912566781044,
    0.008418906480073929,
    -0.014923295937478542,
    -0.009791780263185501,
    0.007102822419255972,
    -0.00989865604788065,
    0.08499852567911148,
    0.017826661467552185,
    -0.03276146203279495,
    0.025081178173422813,
    -0.030730994418263435,
    -0.054099228233098984,
    0.07041345536708832,
    0.03783810883760452,
    0.062144290655851364,
    0.0020313304848968983,
    -0.042124778032302856,
    0.0648588165640831,
    0.023831836879253387,
    0.002784040756523609,
    -0.09479193389415741,
    -0.007006901782006025,
    -0.005642166826874018,
    0.011743339709937572,
    0.02938508801162243,
    -0.026630863547325134,
    -0.01874925196170807,
    -0.03274495154619217,
    0.023174956440925598,
    0.014179801568388939,
    -0.01959867775440216,
    0.017106322571635246,
    -0.08165214955806732,
    0.035709090530872345,
    -0.07771090418100357,
    -0.09464196115732193,
    0.018055178225040436,
    0.011435857973992825,
    0.02096467651426792,
    0.02164812572300434,
    -0.03972317650914192,
    0.02578905038535595,
    0.005115716252475977,
    0.012145334854722023,
    0.05482351407408714,
    -0.015829602256417274,
    -0.014376147650182247,
    0.0067347390577197075,
    -0.06458689272403717,
    -0.0886123850941658,
    -0.015851929783821106,
    -0.02748899720609188,
    -0.04972297325730324,
    -0.04361601546406746,
    -0.0712263435125351,
    -0.04637795314192772,
    -0.04233618080615997,
    -0.06869958341121674,
    -0.03391164541244507,
    -0.048772331327199936,
    0.008639614097774029,
    0.005074700806289911,
    -0.05075879767537117,
    -0.07655540853738785,
    -0.05372180417180061,
    -0.027504216879606247,
    0.03628034517168999,
    -0.025072844699025154,
    -0.012012278661131859,
    -0.09855574369430542,
    -0.03779340535402298,
    0.061397485435009,
    0.06883379817008972,
    0.004914852790534496,
    8.816024637781084e-05,
    0.06233551353216171,
    4.948932837578468e-05,
    -0.005582872778177261,
    0.04097887501120567,
    -0.09857939928770065,
    0.01608814112842083,
    0.022314339876174927,
    -0.044219620525836945,
    -0.08228418231010437,
    0.056538164615631104,
    -0.013266927562654018,
    0.04922061040997505,
    0.05308283865451813,
    0.12364593893289566,
    -0.03178592771291733,
    -2.0013392294236303e-32,
    -0.011638417840003967,
    -0.1217045933008194,
    0.005689695943146944,
    0.014405287802219391,
    0.021834775805473328,
    0.029902581125497818,
    -0.02144760638475418,
    -0.005719756241887808,
    -0.024587059393525124,
    -0.10652758181095123,
    -0.001835484174080193,
    0.0697147324681282,
    0.00958599429577589,
    -0.00298618758097291,
    -0.010919969528913498,
    -0.05600937828421593,
    0.025953251868486404,
    0.013199307955801487,
    -0.0326521173119545,
    0.044936541467905045,
    0.04951874539256096,
    0.005208272021263838,
    -0.031365685164928436,
    0.06528525054454803,
    0.048177577555179596,
    0.03126772865653038,
    -0.0944957286119461,
    0.007270439527928829,
    0.028100011870265007,
    -0.04129457101225853,
    0.0260868351906538,
    0.01627160981297493,
    -0.0667162612080574,
    -0.046453773975372314,
    -0.09308794140815735,
    -0.06134285405278206,
    0.020933745428919792,
    0.04280867055058479,
    -0.05562165006995201,
    -0.021348880603909492,
    0.086061030626297,
    0.0017665245104581118,
    -0.028320029377937317,
    -0.06137256324291229,
    0.040893565863370895,
    0.012485125102102757,
    -0.02364880032837391,
    -0.031021075323224068,
    0.006598677020519972,
    0.03843250125646591,
    0.03331020474433899,
    -0.05567202344536781,
    0.03519177809357643,
    0.05874761566519737,
    -0.05216307193040848,
    0.12102528661489487,
    0.1635105162858963,
    -0.0060464972630143166,
    0.010498116724193096,
    -0.050991665571928024,
    0.027874477207660675,
    0.024049758911132812,
    0.04844658076763153,
    0.06311606615781784,
    0.02360566146671772,
    0.06661663204431534,
    0.0031915921717882156,
    0.07343382388353348,
    -0.013679360039532185,
    0.022600654512643814,
    -0.0005276687443256378,
    -0.11095903813838959,
    -0.04776221886277199,
    -0.08612170815467834,
    0.0032556718215346336,
    0.04940139874815941,
    0.032530106604099274,
    -0.16254399716854095,
    -0.055823639035224915,
    -0.05137507990002632,
    -0.06781193614006042,
    0.03643646091222763,
    -0.02165735885500908,
    0.011003699153661728,
    0.03308263421058655,
    -0.0715208351612091,
    -0.04327501729130745,
    -0.03458704426884651,
    0.06612024456262589,
    0.05814434960484505,
    -0.0467994324862957,
    -0.002454260131344199,
    -0.02895449474453926,
    0.010062625631690025,
    -0.07870221883058548,
    -7.40883834282613e-08,
    0.018293138593435287,
    -0.0029020875226706266,
    0.056073080748319626,
    -0.052448514848947525,
    0.03505042940378189,
    -0.015587403438985348,
    0.003375584725290537,
    -0.04603427276015282,
    0.035906244069337845,
    -0.014001733623445034,
    -0.06148984655737877,
    -0.0177069753408432,
    -0.09909851104021072,
    -0.027895497158169746,
    0.04996410012245178,
    -0.02185768261551857,
    0.01858355477452278,
    -0.036039505153894424,
    -0.0375262126326561,
    0.013005897402763367,
    -0.061460282653570175,
    -0.015932181850075722,
    -0.06276040524244308,
    0.011034690774977207,
    -0.036634813994169235,
    -0.032582320272922516,
    0.08404231816530228,
    0.05507207661867142,
    0.06331056356430054,
    0.056824781000614166,
    -0.09062328934669495,
    0.030067594721913338,
    0.02669161558151245,
    -0.06330540776252747,
    -0.125232994556427,
    0.13248400390148163,
    -0.01292569562792778,
    -0.0739128366112709,
    -0.01596864126622677,
    -0.05247357487678528,
    -0.024074604734778404,
    0.05372385308146477,
    0.09275034070014954,
    -8.369420538656414e-05,
    0.0344889871776104,
    -0.002754278713837266,
    -0.00207678135484457,
    0.009921664372086525,
    0.11794553697109222,
    -0.026123149320483208,
    -0.07862507551908493,
    -0.006886997260153294,
    -0.0017286919755861163,
    0.11936511099338531,
    0.026036396622657776,
    -0.01943247765302658,
    0.011760200373828411,
    -0.04141310602426529,
    0.06934115290641785,
    0.0038487138226628304,
    0.07301337271928787,
    -0.009970004670321941,
    0.0806366354227066,
    -0.007021090481430292
  ]
}