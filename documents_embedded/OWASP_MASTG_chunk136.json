{
  "text": "usinga dynamicanalysis approachishighly recommended. Forinstance, by usingthe techniqueslike 396\\nhookingorsimplydebuggingtheapplication,wecaneasilydeterminethereturnedvalues. Normallyit’sagoodideato useadynamicanalysisapproachandthenfallbacktomanuallyanalyzingthefunctionsinafeedbackloop. Thiswayyou canbenefitfrombothapproachesatthesametimewhilesavingtimeandreducingeffort. Dynamicanalysistechniques arediscussedin“DynamicAnalysis”section. 397\\niOS Data Storage Overview Theprotectionofsensitivedata,suchasauthenticationtokensandprivateinformation,iskeyformobilesecurity. Inthis chapter,you’lllearnabouttheiOSAPIsforlocaldatastorage,andbestpracticesforusingthem. As little sensitive data as possible should be saved in permanent local storage. However, in most practical scenarios, atleastsomeuserdatamustbestored. Fortunately,iOSofferssecurestorageAPIs,whichallowdeveloperstousethe cryptographichardwareavailableoneveryiOS device. IftheseAPIs areusedcorrectly, sensitivedataand filescanbe securedviahardware-backed256-bitAESencryption. NSData and NSMutableData NSData(staticdataobjects)andNSMutableData(dynamicdataobjects)aretypicallyusedfordatastorage,buttheyare alsousefulfordistributedobjectsapplications,inwhichdatacontainedindataobjectscanbecopiedormovedbetween applications. ThefollowingaremethodsusedtowriteNSDataobjects: • NSDataWritingWithoutOverwriting • NSDataWritingFileProtectionNone • NSDataWritingFileProtectionComplete • NSDataWritingFileProtectionCompleteUnlessOpen • NSDataWritingFileProtectionCompleteUntilFirstUserAuthentication • writeToFile: storesdataaspartoftheNSDataclass • NSSearchPathForDirectoriesInDomains, NSTemporaryDirectory: usedtomanagefilepaths • NSFileManager: letsyouexamineandchangethecontentsofthefilesystem. YoucanusecreateFileAtPathto createafileandwritetoit. ThefollowingexampleshowshowtocreateacompleteencryptedfileusingtheFileManagerclass. Youcanfindmore informationintheAppleDeveloperDocumentation“EncryptingYourApp’sFiles” Swift: FileManager.default.createFile( atPath:filePath, contents:\"secrettext\".data(using:.utf8), attributes:[FileAttributeKey.protectionKey:FileProtectionType.complete] ) Objective-C: [[NSFileManagerdefaultManager]createFileAtPath:[self filePath] contents:[@\"secrettext\" dataUsingEncoding:NSUTF8StringEncoding] attributes:[NSDictionarydictionaryWithObject:NSFileProtectionComplete forKey:NSFileProtectionKey]]; NSUserDefaults TheNSUserDefaultsclassprovidesaprogrammaticinterfaceforinteractingwiththedefaultsystem. Thedefaultsystem allows an application to customize its behavior according to user preferences. Data saved by NSUserDefaults can be viewed in the application bundle. This class stores data in a plist file, but it’s meant to be used with small amounts of data. Databases CoreData 398\\nCoreDataisaframeworkformanagingthemodellayerofobjectsinyourapplication. Itprovidesgeneralandautomated solutionstocommontasksassociatedwithobjectlifecyclesandobjectgraphmanagement,includingpersistence. Core DatacanuseSQLiteasitspersistentstore,buttheframeworkitselfisnotadatabase. CoreDatadoesnotencryptit’sdatabydefault. Aspartofaresearchproject(iMAS)fromtheMITRECorporation,thatwas focusedonopensourceiOSsecuritycontrols,anadditionalencryptionlayercanbeaddedtoCoreData. SeetheGitHub Repoformoredetails. SQLite Databases TheSQLite3librarymustbeaddedtoanappiftheappistouseSQLite. ThislibraryisaC++wrapperthatprovidesan APIfortheSQLitecommands. Firebase Real-time Databases Firebaseisadevelopmentplatformwithmorethan15products,andoneofthemisFirebaseReal-timeDatabase. Itcan beleveragedbyapplicationdeveloperstostoreandsyncdatawithaNoSQLcloud-hosteddatabase. Thedataisstored asJSONandissynchronizedinreal-timetoeveryconnectedclientandalsoremainsavailableevenwhentheapplication goesoffline. AmisconfiguredFirebaseinstancecanbeidentifiedbymakingthefollowingnetworkcall: https://\\<firebaseProjectName\\>.firebaseio.com/.json The firebaseProjectName can be retrieved from the property list(.plist) file. For example, PROJECT_ID key stores the correspondingFirebaseprojectnameinGoogleService-Info.plistfile. Alternatively,theanalystscanuseFirebaseScanner,apythonscriptthatautomatesthetaskaboveasshownbelow: pythonFirebaseScanner.py -f<commaSeparatedFirebaseProjectNames> Realm Databases Realm Objective-C and Realm Swift aren’t supplied by Apple, but they are still worth noting. They store everything unencrypted,unlesstheconfigurationhasencryptionenabled. ThefollowingexampledemonstrateshowtouseencryptionwithaRealmdatabase: //OpentheencryptedRealmfilewheregetKey()isamethodtoobtainakeyfromtheKeychainora server letconfig =Realm.Configuration(encryptionKey:getKey()) do{ letrealm =tryRealm(configuration:config) //UsetheRealmasnormal }catch leterror asNSError { //Iftheencryptionkeyiswrong,`error`willsaythatit'saninvaliddatabase fatalError(\"Erroropeningrealm: \\(error)\") } Couchbase Lite Databases CouchbaseLiteisalightweight,embedded,document-oriented(NoSQL)databaseenginethatcanbesynced. Itcompiles nativelyforiOSandmacOS. YapDatabase YapDatabaseisakey/valuestorebuiltontopofSQLite. 399\\nUser Interface UI Components Entering sensitive information when, for example, registering an account or making payments, is an essential part of usingmanyapps. Thisdatamaybefinancialinformationsuchascreditcarddataoruseraccountpasswords. Thedata maybeexposediftheappdoesn’tproperlymaskitwhileitisbeingtyped. In order to prevent disclosure and mitigate risks such as shoulder surfing you should verify that no sensitive data is exposed via the user interface unless explicitly required (e.g. a password being entered). For the data required to be presentitshouldbeproperlymasked,typicallybyshowingasterisksordotsinsteadofcleartext. CarefullyreviewallUIcomponentsthateithershowsuchinformationortakeitasinput. Searchforanytracesofsensitive informationandevaluateifitshouldbemaskedorcompletelyremoved. Screenshots Manufacturerswanttoprovidedeviceuserswithanaestheticallypleasingeffectwhenanapplicationisstartedorexited, so they introduced the concept of saving a screenshot when the application goes into the background. This feature can pose a security risk because screenshots (which may display sensitive information such as an email or corporate documents) are written to local storage, where they can be recovered by a rogue application with a sandbox bypass exploitorsomeonewhostealsthedevice. Keyboard Cache Severaloptions,suchasautocorrectandspellcheck,areavailabletouserstosimplifykeyboardinputandarecachedby defaultin.datfilesin/private/var/mobile/Library/Keyboard/anditssubdirectories. The UITextInputTraits protocol is used for keyboard caching. The UITextField, UITextView, and UISearchBar classes automaticallysupportthisprotocolanditoffersthefollowingproperties: • varautocorrectionType:UITextAutocorrectionTypedetermineswhetherautocorrectionisenabledduringtyp- ing. When autocorrection is enabled, the text object tracks unknown words and suggests suitable replacements, replacingthetypedtextautomaticallyunlesstheuseroverridesthereplacement. Thedefaultvalueofthisproperty isUITextAutocorrectionTypeDefault,whichformostinputmethodsenablesautocorrection. • var secureTextEntry: BOOL determines whether text copying and text caching are disabled and hides the text beingenteredforUITextField. ThedefaultvalueofthispropertyisNO. Internal Storage Data Protection API AppdeveloperscanleveragetheiOSDataProtectionAPIstoimplementfine-grainedaccesscontrolforuserdatastored inflashmemory. TheAPIsarebuiltontopoftheSecureEnclaveProcessor(SEP),whichwasintroducedwiththeiPhone 5S.TheSEPisacoprocessorthatprovidescryptographicoperationsfordataprotectionandkeymanagement. Adevice- specifichardwarekey-thedeviceUID(UniqueID)-isembeddedinthesecureenclave,ensuringtheintegrityofdatapro- tectionevenwhentheoperatingsystemkerneliscompromised. YoucanlearnmoreabouttheSecureEnclaveinthisBlackHatpresentation“DemystifyingtheSecureEnclavePro- cessor”byTarjeiMandt,MathewSolnikandDavidWang. Thedataprotectionarchitectureisbasedonahierarchyofkeys. TheUIDandtheuserpasscodekey(whichisderivedfrom theuser’spassphraseviathePBKDF2algorithm)sitatthetopofthishierarchy. Together,theycanbeusedto“unlock” so-calledclasskeys,whichareassociatedwithdifferentdevicestates(e.g.,devicelocked/unlocked). EveryfilestoredontheiOSfilesystemisencryptedwithitsownper-filekey,whichiscontainedinthefilemetadata. The metadataisencryptedwiththefilesystemkeyandwrappedwiththeclasskeycorrespondingtotheprotectionclassthe appselectedwhencreatingthefile. ThefollowingillustrationshowstheiOSDataProtectionKeyHierarchy. 400\\nFiles can be assigned to one of four different protection classes, which are explained in more detail in theiOS Security Guide: • CompleteProtection(NSFileProtectionComplete): AkeyderivedfromtheuserpasscodeandthedeviceUID protectsthisclasskey. Thederivedkeyiswipedfrommemoryshortlyafterthedeviceislocked,makingthedata inaccessibleuntiltheuserunlocksthedevice. • ProtectedUnlessOpen(NSFileProtectionCompleteUnlessOpen): ThisprotectionclassissimilartoComplete Protection,but,ifthefileisopenedwhenunlocked,theappcancontinuetoaccessthefileeveniftheuserlocks thedevice. Thisprotectionclassisusedwhen,forexample,amailattachmentisdownloadinginthebackground. • Protected Until First User Authentication (NSFileProtectionCompleteUntilFirstUserAuthentication): Thefilecanbeaccessedassoonastheuserunlocksthedeviceforthefirsttimeafterbooting. Itcanbeaccessed eveniftheusersubsequentlylocksthedeviceandtheclasskeyisnotremovedfrommemory. • No Protection (NSFileProtectionNone): The key for this protection class is protected with the UID only. The",
  "metadata": {
    "doc_id": "OWASP_MASTG",
    "chunk_id": 136
  },
  "embedding": [
    -0.025966431945562363,
    0.04502193257212639,
    -0.054392099380493164,
    0.032707732170820236,
    -0.007397078908979893,
    -0.009769396856427193,
    0.03609464690089226,
    0.06525084376335144,
    -0.006773367058485746,
    0.046301573514938354,
    0.03722741827368736,
    -0.03166396543383598,
    0.029166821390390396,
    -0.010792110115289688,
    -0.11463120579719543,
    0.008172810077667236,
    0.10618193447589874,
    -0.007651704829186201,
    -0.11970146000385284,
    0.04244571179151535,
    0.016444217413663864,
    -0.004368515685200691,
    -0.043092746287584305,
    0.03178732469677925,
    0.026303857564926147,
    0.01396348886191845,
    0.0013720367569476366,
    -0.03603498637676239,
    0.042776331305503845,
    0.013953100889921188,
    0.0035471359733492136,
    -0.0018450525822117925,
    -0.03857322782278061,
    0.036726389080286026,
    0.09351831674575806,
    -0.014786294661462307,
    -0.015434266068041325,
    0.028233520686626434,
    -0.010582963936030865,
    -0.0286256093531847,
    -0.04407627135515213,
    0.04341379925608635,
    -0.061077870428562164,
    0.03446396067738533,
    -0.035858433693647385,
    -0.02242417074739933,
    -0.014997361227869987,
    -0.04529934749007225,
    -0.04952464997768402,
    0.07275514304637909,
    -0.021103201434016228,
    0.10254891961812973,
    -0.015585280954837799,
    0.08105561882257462,
    0.006242841947823763,
    0.02822646126151085,
    0.01454558502882719,
    0.009261678904294968,
    -0.02946612797677517,
    0.07854864001274109,
    0.030058180913329124,
    -0.00938489194959402,
    0.01595076359808445,
    -0.04114773869514465,
    -0.014838951639831066,
    0.09159444272518158,
    0.044839903712272644,
    -0.038622599095106125,
    0.1099323034286499,
    0.004281353671103716,
    -0.0760592594742775,
    0.054424457252025604,
    -0.04141790047287941,
    -0.0028836564160883427,
    0.06982120871543884,
    0.026663167402148247,
    -0.03276251628994942,
    0.005350503139197826,
    0.05532955378293991,
    -0.13005341589450836,
    0.04699008911848068,
    -0.004391401540488005,
    -0.002372919814661145,
    -0.008774922229349613,
    0.0048208036459982395,
    0.01410377211868763,
    -0.025481119751930237,
    -0.0007924044621177018,
    0.06501957029104233,
    0.03093061037361622,
    0.04968961700797081,
    0.031580597162246704,
    -0.001412333338521421,
    -0.022316697984933853,
    0.11569968611001968,
    -0.06597588956356049,
    0.004014078062027693,
    -0.026941295713186264,
    0.033954329788684845,
    -0.003991908393800259,
    -0.023146292194724083,
    -0.0034893907140940428,
    -0.0741610899567604,
    0.05389190465211868,
    0.005711458623409271,
    -0.10675796121358871,
    0.07645808160305023,
    -0.054138895124197006,
    -0.013257075101137161,
    0.08043050020933151,
    0.014998776838183403,
    0.061010152101516724,
    0.003668431658297777,
    -0.020017830654978752,
    0.06995748728513718,
    -0.014628604985773563,
    -0.06485099345445633,
    -0.005297769792377949,
    -0.01572146639227867,
    0.020138388499617577,
    0.03389602154493332,
    -0.04080737382173538,
    0.05633935704827309,
    -0.05347186699509621,
    0.013991029001772404,
    0.004446623846888542,
    0.01629641465842724,
    1.9323341845473095e-32,
    -0.002618391066789627,
    -0.006015464197844267,
    -0.019359013065695763,
    -0.015677006915211678,
    -0.07118244469165802,
    -0.034229110926389694,
    0.041370246559381485,
    0.07529164850711823,
    0.048827264457941055,
    -0.021541647613048553,
    -0.04961676150560379,
    0.0999412015080452,
    -0.015155751258134842,
    -0.07933558523654938,
    0.049136705696582794,
    0.02068311721086502,
    0.055705469101667404,
    0.054062891751527786,
    -0.04505809023976326,
    0.03104241192340851,
    0.06000163033604622,
    -0.055179160088300705,
    0.035034097731113434,
    -0.00021020168787799776,
    0.014777051284909248,
    -0.026478584855794907,
    0.03222990036010742,
    0.050740208476781845,
    0.002266209339722991,
    0.04654812440276146,
    -0.028198182582855225,
    -0.01511100959032774,
    -0.1167151927947998,
    -0.01844712905585766,
    0.028944384306669235,
    -0.03000810742378235,
    0.01376835722476244,
    0.006559981498867273,
    -0.0038343118503689766,
    -0.05884702503681183,
    -0.01528933271765709,
    -0.0021721315570175648,
    -0.03630707412958145,
    -0.026332374662160873,
    -0.045672062784433365,
    -0.06528965383768082,
    -0.023066936060786247,
    -0.007111528888344765,
    -0.008737368509173393,
    0.050204064697027206,
    -0.04546475410461426,
    0.03680801019072533,
    -0.02217000722885132,
    -0.06773985922336578,
    -0.11750868707895279,
    0.006144749466329813,
    -0.013812773860991001,
    -0.0803588256239891,
    0.04368332400918007,
    0.06790625303983688,
    -0.03508683666586876,
    0.014333833940327168,
    0.022655293345451355,
    -0.08701668679714203,
    0.03501474857330322,
    0.008787310682237148,
    0.03141671419143677,
    -0.11871334165334702,
    -0.005053218454122543,
    -0.07638297975063324,
    0.00254159327596426,
    -0.024893010035157204,
    0.03850376978516579,
    -0.0023020843509584665,
    -0.02363261766731739,
    -0.05736025795340538,
    0.06379159539937973,
    0.08803864568471909,
    -0.04573442041873932,
    -0.09179063141345978,
    0.03765169158577919,
    -0.043308716267347336,
    0.04337262734770775,
    0.006706547923386097,
    -0.06203949451446533,
    -0.04263071343302727,
    -0.03960173949599266,
    -0.1084621325135231,
    -0.11022424697875977,
    0.059352923184633255,
    -0.011927166022360325,
    -0.00723732216283679,
    -0.031521353870630264,
    0.04477456957101822,
    -0.054858896881341934,
    -1.7550401021477442e-32,
    -0.0077460589818656445,
    -0.07125481963157654,
    -0.05543462559580803,
    -0.05256754532456398,
    -0.027121013030409813,
    0.01765856146812439,
    -0.1267014741897583,
    0.0964532196521759,
    0.012167959474027157,
    -0.034665998071432114,
    -0.026447070762515068,
    -0.05168655887246132,
    -0.04805688560009003,
    -0.05602186545729637,
    -0.020604241639375687,
    0.054253920912742615,
    -0.020806627348065376,
    -0.07789565622806549,
    0.0037402089219540358,
    0.08450859785079956,
    -0.0015974337002262473,
    0.0859685018658638,
    -0.03640510514378548,
    -0.01654812879860401,
    0.02433859370648861,
    0.07574278861284256,
    -0.013192633166909218,
    0.042795829474925995,
    0.02148021198809147,
    -0.05774300545454025,
    -0.03071000799536705,
    -0.019297456368803978,
    -0.0996241420507431,
    -0.056178729981184006,
    -0.06032518297433853,
    -0.10246618837118149,
    -0.023879019543528557,
    -0.0581914484500885,
    -0.06697507947683334,
    0.029951822012662888,
    0.0872335135936737,
    0.1344892680644989,
    -0.05855061858892441,
    -0.01763548143208027,
    0.023845825344324112,
    0.01555956993252039,
    -0.012777423486113548,
    0.009813379496335983,
    0.05326405167579651,
    0.06560039520263672,
    0.15541237592697144,
    -0.02940872311592102,
    0.020031480118632317,
    0.06439538300037384,
    -0.006712594535201788,
    0.09273751080036163,
    0.14373533427715302,
    -0.08773482590913773,
    -0.062427327036857605,
    -0.021973295137286186,
    0.06202733516693115,
    -0.05461546778678894,
    0.01834222860634327,
    0.02084389142692089,
    0.01448804885149002,
    0.08244836330413818,
    0.07212652266025543,
    -0.03588313236832619,
    0.01524602435529232,
    0.002832005964592099,
    -0.008799931965768337,
    -0.08791974186897278,
    -0.005679156631231308,
    -0.05420108139514923,
    0.09954788535833359,
    -0.03334977850317955,
    -0.05295389145612717,
    -0.09614582359790802,
    -0.03088061511516571,
    0.0017851360607892275,
    -0.08619027584791183,
    0.0365481898188591,
    -0.030505478382110596,
    -0.006934854667633772,
    0.007454364560544491,
    -0.08144453912973404,
    -0.03783923014998436,
    -0.02623686194419861,
    0.017470115795731544,
    0.05929737165570259,
    -0.06667013466358185,
    -0.03368362784385681,
    -0.1277111917734146,
    0.03210526332259178,
    0.0066705490462481976,
    -6.329332080667882e-08,
    -0.01967768743634224,
    -0.0017322343774139881,
    0.02585221640765667,
    0.050973933190107346,
    0.032460711896419525,
    -0.039518699049949646,
    -0.00015409733168780804,
    0.02681211195886135,
    0.004629660397768021,
    -0.04785614833235741,
    0.062449052929878235,
    -0.020134011283516884,
    -0.03174285963177681,
    -0.04978074133396149,
    -0.042305365204811096,
    -0.03961890563368797,
    0.0032057054340839386,
    -0.08048932999372482,
    -0.060888662934303284,
    -0.016065973788499832,
    -0.006405005231499672,
    0.002124321646988392,
    0.006240405607968569,
    0.016759118065238,
    0.08563429862260818,
    0.03612726554274559,
    0.09016966074705124,
    0.05102407932281494,
    0.03399450704455376,
    0.05378115177154541,
    -0.05970945209264755,
    0.01456287782639265,
    0.08919785171747208,
    -0.019785858690738678,
    -0.11743023991584778,
    0.06518357992172241,
    0.0149397486820817,
    -0.005345284007489681,
    -0.017936643213033676,
    0.09469236433506012,
    -0.023688144981861115,
    0.06317199766635895,
    -0.01585044525563717,
    0.05242267996072769,
    0.011655843816697598,
    -0.0707206279039383,
    0.0047187190502882,
    0.03331810608506203,
    0.05025412514805794,
    0.0022942887153476477,
    -0.10952813923358917,
    -0.03932619467377663,
    -0.05136851966381073,
    0.09013332426548004,
    -0.040366753935813904,
    -0.015968000516295433,
    0.0373271107673645,
    0.002699879929423332,
    0.06496179848909378,
    0.014425353147089481,
    0.057691752910614014,
    0.010459261946380138,
    -0.040140531957149506,
    -0.00613437918946147
  ]
}