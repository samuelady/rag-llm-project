{
  "text": "must declare a corresponding<uses-permission> element in their own manifest to start, stop, or bind to theservice. Formoreinformationaboutthecontentproviders,pleaserefertothetestcase“TestingWhetherStoredSensitiveDataIs ExposedviaIPCMechanisms”inchapter“TestingDataStorage”. Once you identify a list of IPC mechanisms, review the source code to see whether sensitive data is leaked when the mechanismsareused. Forexample,contentproviderscanbeusedtoaccessdatabaseinformation,andservicescanbe probedtoseeiftheyreturndata. Broadcastreceiverscanleaksensitiveinformationifprobedorsniffed. Inthefollowing,weusetwoexampleappsandgiveexamplesofidentifyingvulnerableIPCcomponents: • “Sieve” • “AndroidInsecureBank” Activities Inspect the AndroidManifest Inthe“Sieve”app,wefindthreeexportedactivities,identifiedby<activity>: <activity android:excludeFromRecents=\"true\" android:label=\"@string/app_name\" android:launchMode=\"singleTask\" android:name=\".MainLoginActivity\" ↪ android:windowSoftInputMode=\"adjustResize|stateVisible\"> <intent-filter> <action android:name=\"android.intent.action.MAIN\" /> <category android:name=\"android.intent.category.LAUNCHER\" /> </intent-filter> </activity> <activity android:clearTaskOnLaunch=\"true\" android:excludeFromRecents=\"true\" android:exported=\"true\" android:finishOnTaskLaunch=\"true\" ↪ android:label=\"@string/title_activity_file_select\" android:name=\".FileSelectActivity\" /> <activity android:clearTaskOnLaunch=\"true\" android:excludeFromRecents=\"true\" android:exported=\"true\" android:finishOnTaskLaunch=\"true\" ↪ android:label=\"@string/title_activity_pwlist\" android:name=\".PWList\" /> Inspect the Source Code ByinspectingthePWList.javaactivity,weseethatitoffersoptionstolistallkeys,add,delete,etc. Ifweinvokeitdirectly, wewillbeabletobypasstheLoginActivity. Moreonthiscanbefoundinthedynamicanalysisbelow. Services 270\\nInspect the AndroidManifest Inthe“Sieve”app,wefindtwoexportedservices,identifiedby<service>: <service android:exported=\"true\" android:name=\".AuthService\" android:process=\":remote\" /> <service android:exported=\"true\" android:name=\".CryptoService\" android:process=\":remote\" /> Inspect the Source Code Checkthesourcecodefortheclassandroid.app.Service: By reversing the target application, we can see that the service AuthService provides functionality for changing the passwordandPIN-protectingthetargetapp. public void handleMessage(Messagemsg){ AuthService.this.responseHandler =msg.replyTo; BundlereturnBundle =msg.obj; intresponseCode; intreturnVal; switch (msg.what){ ... case AuthService.MSG_SET /*6345*/: if(msg.arg1 ==AuthService.TYPE_KEY)/*7452*/ { responseCode =42; if(AuthService.this.setKey(returnBundle.getString(\"com.mwr.example.sieve.PASSWORD\"))){ returnVal =0; }else { returnVal =1; } }else if(msg.arg1 ==AuthService.TYPE_PIN){ responseCode =41; if(AuthService.this.setPin(returnBundle.getString(\"com.mwr.example.sieve.PIN\"))){ returnVal =0; }else { returnVal =1; } }else { sendUnrecognisedMessage(); return; } } } Broadcast Receivers Inspect the AndroidManifest Inthe“AndroidInsecureBank”app,wefindabroadcastreceiverinthemanifest,identifiedby<receiver>: <receiver android:exported=\"true\" android:name=\"com.android.insecurebankv2.MyBroadCastReceiver\"> <intent-filter> <action android:name=\"theBroadcast\" /> </intent-filter> </receiver> Inspect the Source Code SearchthesourcecodeforstringslikesendBroadcast,sendOrderedBroadcast,andsendStickyBroadcast. Makesure thattheapplicationdoesn’tsendanysensitivedata. IfanIntentisbroadcastedandreceivedwithintheapplicationonly,LocalBroadcastManagercanbeusedtopreventother appsfromreceivingthebroadcastmessage. Thisreducestheriskofleakingsensitiveinformation. Tounderstandmoreaboutwhatthereceiverisintendedtodo,wehavetogodeeperinourstaticanalysisandsearchfor usage of the class android.content.BroadcastReceiver and the Context.registerReceiver method, which is used todynamicallycreatereceivers. Thefollowingextractofthetargetapplication’ssourcecodeshowsthatthebroadcastreceivertriggerstransmissionof anSMSmessagecontainingtheuser’sdecryptedpassword. 271\\npublic class MyBroadCastReceiver extends BroadcastReceiver { StringusernameBase64ByteString; public static final StringMYPREFS =\"mySharedPreferences\"; @Override public void onReceive(Contextcontext,Intentintent){ //TODO Auto-generatedmethodstub Stringphn =intent.getStringExtra(\"phonenumber\"); Stringnewpass =intent.getStringExtra(\"newpass\"); if(phn!=null){ try{ SharedPreferencessettings =context.getSharedPreferences(MYPREFS,Context.MODE_WORLD_READABLE); final Stringusername =settings.getString(\"EncryptedUsername\",null); byte[]usernameBase64Byte =Base64.decode(username,Base64.DEFAULT); usernameBase64ByteString =newString(usernameBase64Byte,\"UTF-8\"); final Stringpassword =settings.getString(\"superSecurePassword\",null); CryptoClasscrypt =newCryptoClass(); StringdecryptedPassword =crypt.aesDeccryptedString(password); StringtextPhoneno =phn.toString(); StringtextMessage =\"UpdatedPasswordfrom:\"+decryptedPassword+\"to: \"+newpass; SmsManagersmsManager =SmsManager.getDefault(); System.out.println(\"Forthechangepassword-phonenumber:\"+textPhoneno+\"password is:\"+textMessage); smsManager.sendTextMessage(textPhoneno,null,textMessage,null,null); } } } } BroadcastReceiversshouldusetheandroid:permissionattribute; otherwise, otherapplicationscaninvokethem. You canuseContext.sendBroadcast(intent, receiverPermission);tospecifypermissionsareceivermusthavetoread thebroadcast. YoucanalsosetanexplicitapplicationpackagenamethatlimitsthecomponentsthisIntentwillresolve to. Ifleftasthedefaultvalue(null),allcomponentsinallapplicationswillbeconsidered. Ifnon-null,theIntentcanmatch onlythecomponentsinthegivenapplicationpackage. Dynamic Analysis YoucanenumerateIPCcomponentswithMobSF.TolistallexportedIPCcomponents,uploadtheAPKfileandthecompo- nentscollectionwillbedisplayedinthefollowingscreen: Content Providers The “Sieve” application implements a vulnerable content provider. To list the content providers exported by the Sieve app,executethefollowingcommand: $adbshelldumpsyspackagecom.mwr.example.sieve |grep -Po\"Provider{[\\w\\d\\s\\./]+}\" |sort -u Provider{34a20d5com.mwr.example.sieve/.FileBackupProvider} Provider{64f10eacom.mwr.example.sieve/.DBContentProvider} Once identified, you can use jadx to reverse engineer the app and analyze the source code of the exported content providerstoidentifypotentialvulnerabilities. Toidentifythecorrespondingclassofacontentprovider,usethefollowinginformation: 272\\n• PackageName: com.mwr.example.sieve. • ContentProviderClassName: DBContentProvider. Whenanalyzingtheclasscom.mwr.example.sieve.DBContentProvider,you’llseethatitcontainsseveralURIs: package com.mwr.example.sieve; ... public class DBContentProvider extends ContentProvider { public static final UriKEYS_URI =Uri.parse(\"content://com.mwr.example.sieve.DBContentProvider/Keys\"); public static final UriPASSWORDS_URI =Uri.parse(\"content://com.mwr.example.sieve.DBContentProvider/Passwords\"); ... } UsethefollowingcommandstocallthecontentproviderusingtheidentifiedURIs: $adbshellcontentquery --uri content://com.mwr.example.sieve.DBContentProvider/Keys/ Row:0Password=1234567890AZERTYUIOPazertyuiop,pin=1234 $adbshellcontentquery --uri content://com.mwr.example.sieve.DBContentProvider/Passwords/ Row:0_id=1,service=test,username=test,password=BLOB,email=t@tedt.com Row:1_id=2,service=bank,username=owasp,password=BLOB,email=user@tedt.com $adbshellcontentquery --uri content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection email:username:password --where 'service=\\\"bank\\\"' Row:0email=user@tedt.com,username=owasp,password=BLOB Youareablenowtoretrievealldatabaseentries(seealllinesstartingwith“Row:” intheoutput). Activities Tolistactivitiesexportedbyanapplication,youcanusethefollowingcommandandfocusonactivityelements: $aaptdxmltreesieve.apkAndroidManifest.xml ... E:activity (line=32) A:android:label(0x01010001)=@0x7f05000f A:android:name(0x01010003)=\".FileSelectActivity\" (Raw: \".FileSelectActivity\") A:android:exported(0x01010010)=(type0x12)0xffffffff A:android:finishOnTaskLaunch(0x01010014)=(type0x12)0xffffffff A:android:clearTaskOnLaunch(0x01010015)=(type0x12)0xffffffff A:android:excludeFromRecents(0x01010017)=(type0x12)0xffffffff E:activity (line=40) A:android:label(0x01010001)=@0x7f050000 A:android:name(0x01010003)=\".MainLoginActivity\" (Raw: \".MainLoginActivity\") A:android:excludeFromRecents(0x01010017)=(type0x12)0xffffffff A:android:launchMode(0x0101001d)=(type0x10)0x2 A:android:windowSoftInputMode(0x0101022b)=(type0x11)0x14 E:intent-filter (line=46) E:action (line=47) A:android:name(0x01010003)=\"android.intent.action.MAIN\" (Raw: \"android.intent.action.MAIN\") E:category (line=49) A:android:name(0x01010003)=\"android.intent.category.LAUNCHER\" (Raw: \"android.intent.category.LAUNCHER\") E:activity (line=52) A:android:label(0x01010001)=@0x7f050009 A:android:name(0x01010003)=\".PWList\" (Raw: \".PWList\") A:android:exported(0x01010010)=(type0x12)0xffffffff A:android:finishOnTaskLaunch(0x01010014)=(type0x12)0xffffffff A:android:clearTaskOnLaunch(0x01010015)=(type0x12)0xffffffff A:android:excludeFromRecents(0x01010017)=(type0x12)0xffffffff E:activity (line=60) A:android:label(0x01010001)=@0x7f05000a A:android:name(0x01010003)=\".SettingsActivity\" (Raw: \".SettingsActivity\") A:android:finishOnTaskLaunch(0x01010014)=(type0x12)0xffffffff A:android:clearTaskOnLaunch(0x01010015)=(type0x12)0xffffffff A:android:excludeFromRecents(0x01010017)=(type0x12)0xffffffff ... Youcanidentifyanexportedactivityusingoneofthefollowingproperties: • Ithaveanintent-filtersubdeclaration. • Ithavetheattributeandroid:exportedto0xffffffff. YoucanalsousejadxtoidentifyexportedactivitiesinthefileAndroidManifest.xmlusingthecriteriadescribedabove: 273\\n<?xml version=\"1.0\" encoding=\"utf-8\"?> <manifest xmlns:android=\"http://schemas.android.com/apk/res/android\" package=\"com.mwr.example.sieve\"> ... Thisactivityisexportedviatheattribute\"exported\" <activity android:name=\".FileSelectActivity\" android:exported=\"true\" /> Thisactivityisexportedviathe\"intent-filter\"declaration <activity android:name=\".MainLoginActivity\"> <intent-filter> <action android:name=\"android.intent.action.MAIN\"/> <category android:name=\"android.intent.category.LAUNCHER\"/> </intent-filter> </activity> Thisactivityisexportedviatheattribute\"exported\" <activity android:name=\".PWList\" android:exported=\"true\" /> Activitiesbelowarenotexported <activity android:name=\".SettingsActivity\" /> <activity android:name=\".AddEntryActivity\"/> <activity android:name=\".ShortLoginActivity\" /> <activity android:name=\".WelcomeActivity\" /> <activity android:name=\".PINActivity\" /> ... </manifest> Enumeratingactivitiesinthevulnerablepasswordmanager“Sieve”showsthatthefollowingactivitiesareexported: • .MainLoginActivity • .PWList •",
  "metadata": {
    "doc_id": "OWASP_MASTG",
    "chunk_id": 103
  },
  "embedding": [
    -0.022848213091492653,
    0.0025917154271155596,
    -0.009084856137633324,
    -0.04028083384037018,
    0.06083451211452484,
    -0.05486821383237839,
    0.04863450676202774,
    -0.042401958256959915,
    0.021032122895121574,
    0.0325944647192955,
    0.0307465847581625,
    -0.06751743704080582,
    0.031518757343292236,
    0.0019975779578089714,
    0.013634578324854374,
    -0.05797784775495529,
    0.10067737847566605,
    -0.059895701706409454,
    -0.06083673611283302,
    0.026745671406388283,
    0.0333515964448452,
    0.016619550064206123,
    0.007723531220108271,
    0.005556677468121052,
    0.005585800390690565,
    -0.009886544197797775,
    -0.0338689461350441,
    -0.08246100693941116,
    0.01735115610063076,
    -0.01325808186084032,
    0.05775807797908783,
    -0.01807486265897751,
    0.023221230134367943,
    0.02439076080918312,
    0.04527996852993965,
    -0.06220412626862526,
    0.017760371789336205,
    0.007567208725959063,
    -0.016722654923796654,
    0.03754014894366264,
    0.055846069008111954,
    -0.04661945253610611,
    -0.07951604574918747,
    0.08676009625196457,
    -0.05681635066866875,
    -0.0036901331041008234,
    0.05167355760931969,
    -0.06879021227359772,
    -0.038252197206020355,
    0.0554463192820549,
    0.05362752452492714,
    0.006518169771879911,
    0.053821414709091187,
    0.06447406858205795,
    -0.12003616243600845,
    -0.07305601984262466,
    0.01091251615434885,
    0.060774631798267365,
    0.03718438744544983,
    0.16678014397621155,
    0.015616515651345253,
    0.005351330153644085,
    -0.03940127044916153,
    0.012402115389704704,
    -0.06274515390396118,
    0.06967875361442566,
    0.03647250309586525,
    -0.05764882266521454,
    0.08822159469127655,
    -0.059342868626117706,
    0.0039646741934120655,
    0.05159032717347145,
    -0.0004569207667373121,
    -0.0262517761439085,
    0.05075795203447342,
    0.042173802852630615,
    -0.04486415535211563,
    -0.01956935040652752,
    0.01469904463738203,
    -0.1852346807718277,
    0.05688350275158882,
    -0.02311774343252182,
    0.017226798459887505,
    0.05343512073159218,
    0.001324009383097291,
    0.03107292205095291,
    0.04636264964938164,
    0.018089694902300835,
    0.03155860677361488,
    0.04973991960287094,
    -0.00904160924255848,
    0.04032415151596069,
    -0.037415340542793274,
    0.023840056732296944,
    0.022329043596982956,
    -0.02331516146659851,
    -0.08252271264791489,
    -0.058007217943668365,
    -0.04845685139298439,
    0.022741051390767097,
    0.02733357809484005,
    0.053163591772317886,
    -0.061922378838062286,
    0.03190809115767479,
    0.0009699541260488331,
    -0.06601298600435257,
    -0.0016794154653325677,
    -0.030119339004158974,
    0.0464913547039032,
    0.1563822478055954,
    0.01800735481083393,
    0.0035186167806386948,
    -0.0016297153197228909,
    -0.025272775441408157,
    0.048642758280038834,
    0.013776512816548347,
    -0.019631069153547287,
    0.03966587781906128,
    -0.00042197489528916776,
    0.04385478422045708,
    -0.016858890652656555,
    -0.04374593868851662,
    -0.004053494427353144,
    -0.09263334423303604,
    -0.0005469800671562552,
    -0.010878905653953552,
    -0.05093562975525856,
    1.776204290187124e-32,
    -0.010405080392956734,
    0.013569308444857597,
    -0.024531319737434387,
    0.03153470158576965,
    -0.0813153013586998,
    0.03405993431806564,
    0.048706553876399994,
    0.05925169587135315,
    -0.0028049692045897245,
    -0.026932640001177788,
    0.02132919803261757,
    -0.011681524105370045,
    -0.013070622459053993,
    -0.01496085338294506,
    0.026573363691568375,
    0.04013749212026596,
    0.023303808644413948,
    0.01703290455043316,
    0.03644199296832085,
    0.03202351555228233,
    -0.001089109806343913,
    -0.057659588754177094,
    -0.005830598063766956,
    -0.03641672059893608,
    -0.010267253033816814,
    0.011717083863914013,
    -0.036803700029850006,
    0.011853573843836784,
    0.07217714935541153,
    0.028733564540743828,
    -0.027733152732253075,
    -0.039478544145822525,
    -0.003080506809055805,
    0.05316169559955597,
    0.015731224790215492,
    -0.0176741611212492,
    0.008428828790783882,
    -0.026820693165063858,
    -0.006690890062600374,
    -0.042840998619794846,
    -0.01730097457766533,
    -0.059868793934583664,
    -0.04510962963104248,
    -0.018230682238936424,
    -0.03536651283502579,
    -0.0798034816980362,
    -0.08741334080696106,
    -0.014703740365803242,
    -0.010775327682495117,
    -0.005413401871919632,
    0.005904988385736942,
    0.030525807291269302,
    -0.0049747079610824585,
    -0.13803671300411224,
    -0.049626678228378296,
    -0.02470792829990387,
    -0.048119183629751205,
    -0.019919533282518387,
    0.03129662200808525,
    0.03875913843512535,
    -0.0032022653613239527,
    0.05560676380991936,
    0.013489237986505032,
    -0.014422698877751827,
    -0.029291490092873573,
    -0.01131484191864729,
    0.012794050388038158,
    -0.10215625911951065,
    -0.053694937378168106,
    0.012755241245031357,
    -0.09197031706571579,
    -0.027416085824370384,
    0.03633801266551018,
    0.05331592261791229,
    -0.08486916124820709,
    -0.013561195693910122,
    -0.013587039895355701,
    0.03897477686405182,
    -0.009881782345473766,
    -0.03495069220662117,
    0.08850009739398956,
    -0.07495266944169998,
    0.11647257953882217,
    0.0130405742675066,
    -0.15288285911083221,
    -0.08790875226259232,
    -0.009197964332997799,
    -0.08733787387609482,
    -0.09299550950527191,
    0.10386627912521362,
    0.006053668446838856,
    0.035255465656518936,
    -0.041030801832675934,
    0.06560105085372925,
    -0.05550844967365265,
    -1.7459428044299366e-32,
    -0.06728030741214752,
    -0.022586027160286903,
    -0.10802942514419556,
    -0.09088222682476044,
    0.011730645783245564,
    -0.05638803541660309,
    0.008040403947234154,
    0.038266755640506744,
    -0.003030982566997409,
    -0.017016854137182236,
    0.03232540190219879,
    -0.02866005338728428,
    -0.05249279737472534,
    -0.060323894023895264,
    -0.04452066868543625,
    0.01954631134867668,
    0.01710282452404499,
    0.010089565068483353,
    -0.022722311317920685,
    0.01305355690419674,
    -0.03209800645709038,
    0.04515169933438301,
    0.050264254212379456,
    0.054216887801885605,
    0.007620206102728844,
    -0.055501069873571396,
    0.023282913491129875,
    0.04489684849977493,
    0.035984206944704056,
    -0.009110941551625729,
    0.017313869670033455,
    0.0332614965736866,
    -0.08190198987722397,
    -0.031887784600257874,
    -0.025583460927009583,
    -0.039012085646390915,
    -0.010025502182543278,
    -0.04660947620868683,
    0.008343426510691643,
    0.011834701523184776,
    0.0586523711681366,
    0.046827878803014755,
    -0.02182605490088463,
    0.05647682026028633,
    0.036002565175294876,
    -0.05183696001768112,
    -0.014831890352070332,
    -0.027863161638379097,
    0.01601378805935383,
    0.016546832397580147,
    0.10874111205339432,
    -0.051493097096681595,
    0.04667235538363457,
    0.05135215446352959,
    0.0455157570540905,
    0.15488779544830322,
    0.0956033244729042,
    -0.03192870318889618,
    -0.004988652188330889,
    -0.05150321498513222,
    0.10768792033195496,
    -0.022417044267058372,
    -0.10261093825101852,
    0.06534677743911743,
    0.07213296741247177,
    0.023855306208133698,
    0.08465215563774109,
    0.04416029155254364,
    0.01319381408393383,
    0.05135713145136833,
    0.05127253383398056,
    -0.12859036028385162,
    -0.02559821866452694,
    -0.04145738109946251,
    0.029298964887857437,
    -0.015552708879113197,
    -0.027897272258996964,
    -0.034570638090372086,
    -0.08638954907655716,
    -0.022410264238715172,
    0.033900342881679535,
    0.00458512082695961,
    -0.06512904167175293,
    -0.013873367570340633,
    0.09760566055774689,
    -0.041872669011354446,
    -0.01081320084631443,
    -0.011817347258329391,
    -0.02394200675189495,
    0.02927560731768608,
    -0.08969347178936005,
    -0.0002098039840348065,
    -0.07584609091281891,
    0.02049117349088192,
    0.019858350977301598,
    -6.89569361611575e-08,
    0.03873099014163017,
    -0.040110815316438675,
    -0.010522007942199707,
    -0.008737917058169842,
    0.06430985778570175,
    -0.0146323936060071,
    -0.01766011118888855,
    -0.0030691674910485744,
    0.03144266828894615,
    -0.02419889345765114,
    -9.277534991269931e-05,
    -0.036709219217300415,
    -0.07455785572528839,
    0.0350312814116478,
    0.0755363255739212,
    -0.03864135220646858,
    0.024179808795452118,
    -0.02284804917871952,
    -0.021875139325857162,
    -0.029459327459335327,
    -0.015365978702902794,
    -0.049137577414512634,
    -0.036635592579841614,
    -0.06404980272054672,
    0.04241515323519707,
    -0.03161665052175522,
    0.10126736760139465,
    0.04472503438591957,
    0.05284625291824341,
    0.07854776084423065,
    -0.01893594115972519,
    -0.09338240325450897,
    0.0041980198584496975,
    -0.11112410575151443,
    -0.05346336215734482,
    0.2059866338968277,
    0.026759780943393707,
    -0.0693124309182167,
    0.0430603064596653,
    0.08220992237329483,
    -0.05895550176501274,
    0.0603029690682888,
    0.024674246087670326,
    0.03579340875148773,
    0.009120938368141651,
    -0.032554447650909424,
    0.012677166610956192,
    0.08674678951501846,
    0.0689668282866478,
    -0.004031984135508537,
    -0.07105465233325958,
    -0.035322174429893494,
    -0.052817776799201965,
    0.0308595672249794,
    -0.0014630327932536602,
    -0.054962389171123505,
    -0.04175472632050514,
    -0.027411092072725296,
    0.03246986120939255,
    0.020375482738018036,
    0.08251278847455978,
    0.003690264420583844,
    0.01147637702524662,
    -0.013090014457702637
  ]
}