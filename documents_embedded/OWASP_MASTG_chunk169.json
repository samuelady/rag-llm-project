{
  "text": "https://github.com/FSecureLABS/drozer Drozer is an Android security assessment framework that allows you to search for security vulnerabilities in apps and devicesbyassumingtheroleofathird-partyappinteractingwiththeotherapplication’sIPCendpointsandtheunderlying OS. The advantage of using drozer consists on its ability to automate several tasks and that it can be expanded through modules. Themodulesareveryhelpfulandtheycoverdifferentcategoriesincludingascannercategorythatallowsyou toscanforknowndefectswithasimplecommandsuchasthemodulescanner.provider.injectionwhichdetectsSQL injections in content providers in all the apps installed in the system. Without drozer, simple tasks such as listing the app’spermissionsrequireseveralstepsthatincludedecompilingtheAPKandmanuallyanalyzingtheresults. Installing Drozer You can refer to drozer GitHub page (for Linux and Windows, for macOS please refer to this blog post) and the drozer websiteforprerequisitesandinstallationinstructions. Using Drozer Beforeyoucanstartusingdrozer,you’llalsoneedthedrozeragentthatrunsontheAndroiddeviceitself. Downloadthe latestdrozeragentfromtheGitHubreleasespageandinstallitwithadb install drozer.apk. OncethesetupiscompletedyoucanstartasessiontoanemulatororadeviceconnectedperUSBbyrunningadbforward tcp:31415 tcp:31415anddrozer console connect. Thisiscalleddirectmodeandyoucanseethefullinstructionsin the User Guide in section “Starting a Session”. An alternative is to run Drozer in infrastructure mode, where, you are runningadrozerserverthatcanhandlemultipleconsolesandagents,androutessessionsbetweenthem. Youcanfind thedetailsofhowtosetupdrozerinthismodeinthe“InfrastructureMode”sectionoftheUserGuide. Nowyouarereadytobeginanalyzingapps. Agoodfirststepistoenumeratetheattacksurfaceofanappwhichcanbe doneeasilywiththefollowingcommand: dz>runapp.package.attacksurface <package> Again, withoutdrozerthiswouldhaverequiredseveralsteps. Themoduleapp.package.attacksurfacelistsactivities, broadcastreceivers,contentprovidersandservicesthatareexported,hence,theyarepublicandcanbeaccessedthrough otherapps. Oncewehaveidentifiedourattacksurface,wecaninteractwiththeIPCendpointsthroughdrozerwithout havingtowriteaseparatestandaloneappasitwouldberequiredforcertaintaskssuchascommunicatingwithacontent provider. Forexample,iftheapphasanexportedActivitythatleakssensitiveinformationwecaninvokeitwiththeDrozermodule app.activity.start: 527\\ndz>runapp.activity.start --component <package><componentname> Thispreviouscommandwillstarttheactivity,hopefullyleakingsomesensitiveinformation. Drozerhasmodulesforevery typeofIPCmechanism. DownloadInsecureBankv2ifyouwouldliketotrythemoduleswithanintentionallyvulnerable applicationthatillustratescommonproblemsrelatedtoIPCendpoints. Paycloseattentiontothemodulesinthescanner category as they are very helpful automatically detecting vulnerabilities even in system packages, specially if you are usingaROMprovidedbyyourcellphonecompany. EvenSQLinjectionvulnerabilitiesinsystempackagesbyGooglehave beenidentifiedinthepastwithdrozer. Other Drozer commands Here’sanon-exhaustivelistofcommandsyoucanusetostartexploringonAndroid: ##Listalltheinstalledpackages $dz>runapp.package.list ##Findthepackagenameofaspecificapp $dz>runapp.package.list -f(stringtobesearched) ##Seebasicinformation $dz>runapp.package.info -a(packagename) ##Identifytheexportedapplicationcomponents $dz>runapp.package.attacksurface (packagename) ##IdentifythelistofexportedActivities $dz>runapp.activity.info -a(packagename) ##LaunchtheexportedActivities $dz>runapp.activity.start --component (packagename)(componentname) ##IdentifythelistofexportedBroadcastreceivers $dz>runapp.broadcast.info -a(packagename) ##SendamessagetoaBroadcastreceiver $dz>runapp.broadcast.send --action (broadcastreceivername)--extra (numberofarguments) ##DetectSQLinjectionsincontentproviders $dz>runscanner.provider.injection -a(packagename) Other Drozer resources Otherresourceswhereyoumightfindusefulinformationare: • OfficialdrozerUserGuide. • drozerGitHubpage • drozerWiki Scrcpy Platform: android Availableat: https://github.com/Genymobile/scrcpy ScrcpyprovidesdisplayandcontrolofAndroiddevicesconnectedoverUSB(orTCP/IP).Itdoesnotrequireanyrootaccess anditworksonGNU/Linux,WindowsandmacOS. Android Studio Platform: android TheofficialIDEforGoogle’sAndroidoperatingsystem,builtonJetBrains’IntelliJIDEAsoftwareanddesignedspecifically forAndroiddevelopment-https://developer.android.com/studio/index.html 528\\nFrida for Android Platform: android FridasupportsinteractionwiththeAndroidJavaruntimethoughtheJavaAPI.You’llbeabletohookandcallbothJavaand nativefunctionsinsidetheprocessanditsnativelibraries. YourJavaScriptsnippetshavefullaccesstomemory,e.g.to readand/orwriteanystructureddata. HerearesometasksthatFridaAPIsoffersandarerelevantorexclusiveonAndroid: • InstantiateJavaobjectsandcallstaticandnon-staticclassmethods(JavaAPI). • ReplaceJavamethodimplementations(JavaAPI). • EnumerateliveinstancesofspecificclassesbyscanningtheJavaheap(JavaAPI). • Scanprocessmemoryforoccurrencesofastring(MemoryAPI). • Interceptnativefunctioncallstorunyourowncodeatfunctionentryandexit(InterceptorAPI). RememberthatonAndroid,youcanalsobenefitfromthebuilt-intoolsprovidedwheninstallingFrida,thatincludesthe FridaCLI(frida),frida-ps,frida-ls-devicesandfrida-trace,tonamesomeofthem. Frida is often compared to Xposed, however this comparison is far from fair as both frameworks were designed with differentgoalsinmind. Thisisimportanttounderstandasanappsecuritytestersothatyoucanknowwhichframework touseinwhichsituation: • Fridaisstandalone,allyouneedistorunthefrida-serverbinaryfromaknownlocationinyourtargetAndroiddevice (see“InstallingFrida”below). Thismeansthat,incontrasttoXposed,itisnotdeepinstalledinthetargetOS. • Reversinganappisaniterativeprocess. Asaconsequenceofthepreviouspoint, youobtainashorterfeedback loopwhentestingasyoudon’tneedto(soft)reboottoapplyorsimplyupdateyourhooks. Soyoumightpreferto useXposedwhenimplementingmorepermanenthooks. • You may inject and update your Frida JavaScript code on the fly at any point during the runtime of your process (similarlytoCycriptoniOS).Thiswayyoucanperformtheso-calledearlyinstrumentationbylettingFridaspawn yourapporyoumayprefertoattachtoarunningappthatyoumighthavebroughttoacertainstate. • FridaisabletohandlebothJavaaswellasnativecode(JNI),allowingyoutomodifybothofthem. Thisisunfortu- natelyalimitationofXposedwhichlacksofnativecodesupport. NotethatXposed,asofearly2019,doesnotworkonAndroid9(APIlevel28)yet. Installing Frida on Android InordertosetupFridaonyourAndroiddevice: • Ifyourdeviceisnotrooted,youcanalsouseFrida,pleaserefertosection“DynamicAnalysisonNon-RootedDevices” ofthe“ReverseEngineeringandTampering”chapter. • Ifyouhavearooteddevice,simplyfollowtheofficialinstructionsorfollowthehintsbelow. Weassumearooteddevicehereunlessotherwisenoted. Downloadthefrida-serverbinaryfromtheFridareleasespage. Makesurethatyoudownloadtherightfrida-serverbinaryforthearchitectureofyourAndroiddeviceoremulator: x86, x86_64,armorarm64. Makesurethattheserverversion(atleastthemajorversionnumber)matchestheversionofyour localFridainstallation. PyPIusuallyinstallsthelatestversionofFrida. Ifyou’reunsurewhichversionisinstalled,youcan checkwiththeFridacommandlinetool: frida --version OryoucanrunthefollowingcommandtoautomaticallydetectFridaversionanddownloadtherightfrida-serverbinary: wget https://github.com/frida/frida/releases/download/$(frida --version)/frida-server-$(frida --version)-android-arm.xz Copyfrida-servertothedeviceandrunit: 529\\nadbpushfrida-server/data/local/tmp/ adbshell \"chmod755/data/local/tmp/frida-server\" adbshell \"su-c/data/local/tmp/frida-server&\" Using Frida on Android Withfrida-serverrunning,youshouldnowbeabletogetalistofrunningprocesseswiththefollowingcommand(usethe -UoptiontoindicateFridatouseaconnectedUSBdevicesoremulator): $frida-ps -U PID Name ----- -------------------------------------------------------------- 276 adbd 956 android.process.media 198 bridgemgrd 30692 com.android.chrome 30774 com.android.chrome:privileged_process0 30747 com.android.chrome:sandboxed 30834 com.android.chrome:sandboxed 3059 com.android.nfc 1526 com.android.phone 17104 com.android.settings 1302 com.android.systemui (...) Orrestrictthelistwiththe-Uaiflagcombinationtogetallapps(-a)currentlyinstalled(-i)ontheconnectedUSBdevice (-U): $frida-ps -Uai PID Name Identifier ----- ---------------------------------------- ------------------------------ 766 AndroidSystem android 30692 Chrome com.android.chrome 3520 ContactsStorage com.android.providers.contacts - Uncrackable1 sg.vantagepoint.uncrackable1 - drozerAgent com.mwr.dz Thiswillshowthenamesandidentifiersofallapps,iftheyarecurrentlyrunningitwillalsoshowtheirPIDs. Searchfor yourappinthelistandtakeanoteofthePIDoritsname/identifier. Fromnowonyou’llrefertoyourappbyusingoneof them. Arecommendationistousetheidentifiers,asthePIDswillchangeoneachrunoftheapp. Forexamplelet’stake com.android.chrome. YoucanusethisstringnowonallFridatools,e.g.ontheFridaCLI,onfrida-traceorfromaPython script. Tracing Native Libraries with frida-trace Totracespecific(low-level)librarycalls,youcanusethefrida-tracecommandlinetool: frida-trace -Ucom.android.chrome -i\"open\" This generates a little JavaScript in __handlers__/libc.so/open.js, which Frida injects into the process. The script tracesallcallstotheopenfunctioninlibc.so. YoucanmodifythegeneratedscriptaccordingtoyourneedswithFrida JavaScriptAPI. Unfortunatelytracinghigh-levelmethodsofJavaclassesisnotyetsupported(butmightbeinthefuture). Frida CLI and the Java API Use the Frida CLI tool (frida) to work with Frida interactively. It hooks into a process and gives you a command line interfacetoFrida’sAPI. frida -Ucom.android.chrome Withthe-loption,youcanalsousetheFridaCLItoloadscripts,e.g.,toloadmyscript.js: 530\\nfrida -U-lmyscript.jscom.android.chrome FridaalsoprovidesaJavaAPI,whichisespeciallyhelpfulfordealingwithAndroidapps. ItletsyouworkwithJavaclasses andobjectsdirectly. HereisascripttooverwritetheonResumefunctionofanActivityclass: Java.perform(function (){ varActivity =Java.use(\"android.app.Activity\"); Activity.onResume.implementation =function (){ console.log(\"[*]onResume()gotcalled!\"); this.onResume(); }; }); TheabovescriptcallsJava.performtomakesurethatyourcodegetsexecutedinthecontextoftheJavaVM.Itinstantiates awrapperfortheandroid.app.ActivityclassviaJava.useandoverwritestheonResumefunction. ThenewonResume functionimplementationprintsanoticetotheconsoleandcallstheoriginalonResumemethodbyinvokingthis.onResume everytimeanactivityisresumedintheapp. The JADX decompiler (v1.3.3 and",
  "metadata": {
    "doc_id": "OWASP_MASTG",
    "chunk_id": 169
  },
  "embedding": [
    -0.07218489795923233,
    0.027938365936279297,
    -0.0015301923267543316,
    -0.03529815003275871,
    0.03499990701675415,
    -0.026553276926279068,
    0.0266334880143404,
    0.09684817492961884,
    -0.031069358810782433,
    -0.012621687725186348,
    -0.050051480531692505,
    -0.10474308580160141,
    0.03641875460743904,
    0.05748484656214714,
    -0.029187500476837158,
    -0.0307441558688879,
    0.03555852547287941,
    0.019208775833249092,
    -0.026544645428657532,
    0.003986880648881197,
    0.001806776155717671,
    0.05144142732024193,
    0.029689380899071693,
    -0.006790241226553917,
    0.03078472428023815,
    0.05985654145479202,
    0.015085751190781593,
    -0.04808177053928375,
    -0.004708121530711651,
    -0.06164398416876793,
    0.07600047439336777,
    -0.02931852452456951,
    0.08865241706371307,
    0.08830402791500092,
    -0.03996626287698746,
    -0.08276387304067612,
    0.003663139184936881,
    -0.05580194666981697,
    -0.07510929554700851,
    -0.029167769476771355,
    -0.013674238696694374,
    0.0008131113136187196,
    -0.03683463856577873,
    0.0145608214661479,
    -0.07362737506628036,
    -0.09966935962438583,
    -0.05579671636223793,
    0.06640612334012985,
    0.050647106021642685,
    0.02559099905192852,
    0.017864666879177094,
    -0.04800312593579292,
    0.05381977930665016,
    0.03306959569454193,
    -0.03600031137466431,
    0.04656093567609787,
    0.026264458894729614,
    -0.019518030807375908,
    0.0022815491538494825,
    -0.032638151198625565,
    0.06770830601453781,
    0.016632329672574997,
    -0.03249413147568703,
    0.04760110378265381,
    -0.07338887453079224,
    0.050702113658189774,
    0.02635251358151436,
    0.014692983590066433,
    0.14621907472610474,
    -0.07776491343975067,
    -0.09890124946832657,
    -0.036098383367061615,
    0.06876222789287567,
    -0.052989475429058075,
    0.016316263005137444,
    0.033711839467287064,
    -0.02092742919921875,
    0.000883476051967591,
    -0.05401668697595596,
    -0.07312893122434616,
    0.01825990155339241,
    0.021362515166401863,
    0.05366402491927147,
    0.09158126264810562,
    -0.009256992489099503,
    0.061515506356954575,
    0.02457883581519127,
    -0.011722568422555923,
    0.056488242000341415,
    0.020278235897421837,
    0.019835924729704857,
    0.022473514080047607,
    -0.03271965682506561,
    0.020769312977790833,
    0.014805012382566929,
    -0.00927902851253748,
    -0.030482608824968338,
    -0.03695446252822876,
    -0.0344528965651989,
    0.025712905451655388,
    -0.00022209582675714046,
    -0.060641929507255554,
    -0.010902573354542255,
    -0.10068125277757645,
    0.02445346675813198,
    -0.030735349282622337,
    0.020963413640856743,
    -0.09849301725625992,
    -0.007625516038388014,
    0.01441716868430376,
    -0.0019936433527618647,
    0.0272201094776392,
    0.06895574927330017,
    0.022623151540756226,
    0.03615577146410942,
    -0.034190982580184937,
    -0.012189975939691067,
    -0.0110022546723485,
    0.0806298479437828,
    0.05228278040885925,
    0.0600275844335556,
    -0.0624999962747097,
    0.030633646994829178,
    -0.10512623190879822,
    0.045158885419368744,
    -0.0023837294429540634,
    -0.14612770080566406,
    1.4380058961847146e-32,
    0.017309507355093956,
    0.005769707728177309,
    -0.00676248362287879,
    -0.04235389083623886,
    -0.004497222602367401,
    -0.046310096979141235,
    -0.020282825455069542,
    0.046708256006240845,
    -0.0058790091425180435,
    -0.0431009903550148,
    -0.025033269077539444,
    0.11167015135288239,
    -0.007734985090792179,
    -0.0037108520045876503,
    0.03216820955276489,
    -0.06179621070623398,
    -0.006469433195888996,
    0.05914195999503136,
    0.0054819900542497635,
    0.03498988598585129,
    -0.017726639285683632,
    -0.11101891100406647,
    -0.01910512149333954,
    -0.02367684245109558,
    0.017040181905031204,
    0.04757930338382721,
    0.040776900947093964,
    0.030292049050331116,
    0.06054314970970154,
    0.01668025553226471,
    -0.07210054248571396,
    -0.08370672166347504,
    -0.05040862038731575,
    -0.005742169450968504,
    -0.059766508638858795,
    -0.011385126039385796,
    -0.08951569348573685,
    -0.04042644798755646,
    -0.021812455728650093,
    -0.0926104485988617,
    -0.0370040237903595,
    -0.0938676968216896,
    -0.0614117868244648,
    0.024512942880392075,
    0.06724108010530472,
    -0.04243583604693413,
    -0.12200870364904404,
    -0.043358780443668365,
    -0.002359807724133134,
    -0.01032885443419218,
    0.03284985199570656,
    -0.06448666751384735,
    0.027203261852264404,
    -0.041879862546920776,
    -0.092707060277462,
    0.02083723247051239,
    -0.06195612996816635,
    -0.04424777254462242,
    0.01009680237621069,
    0.013851228170096874,
    -0.04786611348390579,
    0.031530141830444336,
    -0.03465927019715309,
    -0.057546310126781464,
    -0.01970464363694191,
    -0.061934854835271835,
    0.02948586456477642,
    -0.03227890655398369,
    -0.013896608725190163,
    0.1043529361486435,
    -0.05640539154410362,
    -0.01452405285090208,
    0.09973648190498352,
    0.04580692946910858,
    -0.024719521403312683,
    -0.05166894942522049,
    0.040645308792591095,
    0.058030661195516586,
    -0.01933514140546322,
    -0.03015146777033806,
    0.0620744451880455,
    -0.03160018473863602,
    0.046534083783626556,
    -0.013718725182116032,
    -0.07374373823404312,
    -0.04325145110487938,
    0.03301556780934334,
    -0.06106463819742203,
    -0.039619121700525284,
    0.06597808003425598,
    -0.018116051331162453,
    -0.016400838270783424,
    -0.011579645797610283,
    0.01035893615335226,
    0.014515691436827183,
    -1.4731872666104748e-32,
    -0.01758231222629547,
    -0.09859193116426468,
    -0.009553897194564342,
    0.026616260409355164,
    0.037346355617046356,
    -0.03410813584923744,
    -0.03324263170361519,
    0.06373552232980728,
    0.052689991891384125,
    -0.0821390151977539,
    -0.06095058098435402,
    0.08818698674440384,
    0.04826459288597107,
    -0.10583028197288513,
    0.027378417551517487,
    0.1025533452630043,
    0.0015903892926871777,
    -0.05203402042388916,
    -0.06282680481672287,
    0.015827883034944534,
    -0.03671823814511299,
    0.08517429977655411,
    -0.007924964651465416,
    -0.009285211563110352,
    -0.02351398766040802,
    -0.035487428307533264,
    0.03179575130343437,
    0.012369537726044655,
    0.01085243746638298,
    0.004753082524985075,
    0.0808388814330101,
    0.08887139707803726,
    -0.06110316887497902,
    -0.0519004687666893,
    -0.030171111226081848,
    -0.06281083822250366,
    0.0022322910372167826,
    -0.0318484753370285,
    0.01841128244996071,
    -0.018296943977475166,
    0.05839201807975769,
    0.0094985356554389,
    -0.01800951547920704,
    -0.026827190071344376,
    0.06394504755735397,
    0.07067110389471054,
    -0.06606142967939377,
    0.039981596171855927,
    0.009297299198806286,
    -0.028806783258914948,
    0.03714553639292717,
    0.004459949675947428,
    0.010606992989778519,
    0.0813763290643692,
    0.018505077809095383,
    0.057860035449266434,
    0.05525117367506027,
    -0.031436532735824585,
    0.02010902389883995,
    0.10631521046161652,
    -0.023193208500742912,
    -0.011067129671573639,
    -0.02975062094628811,
    0.04437555372714996,
    -0.07250341773033142,
    -0.061341043561697006,
    -0.008511824533343315,
    0.01489739678800106,
    -0.05301854759454727,
    0.09815139323472977,
    0.08709298074245453,
    -0.025648748502135277,
    -0.009523730725049973,
    0.01435257587581873,
    -0.013024799525737762,
    0.0517365038394928,
    -0.04723082855343819,
    -0.07742965966463089,
    -0.14042706787586212,
    -0.005971364676952362,
    0.05047869682312012,
    0.027815397828817368,
    0.016977623105049133,
    -0.0010402938351035118,
    0.025680048391222954,
    -0.051730770617723465,
    0.020294882357120514,
    -0.015922240912914276,
    -0.008735422044992447,
    0.010869640856981277,
    -0.0577419176697731,
    -0.09861371666193008,
    -0.09541915357112885,
    0.06250806897878647,
    0.05706239491701126,
    -6.599400848017467e-08,
    0.07573601603507996,
    -0.04194347932934761,
    0.028848830610513687,
    -0.027734950184822083,
    0.007387268356978893,
    0.018055083230137825,
    -0.04129530116915703,
    0.05174841359257698,
    0.02736094780266285,
    -0.015097569674253464,
    0.024537980556488037,
    -0.13991467654705048,
    -0.07280565053224564,
    0.022102968767285347,
    0.06084444746375084,
    0.062317587435245514,
    0.10759163647890091,
    0.07482130080461502,
    -0.03273528069257736,
    0.0073526781052351,
    0.018839292228221893,
    0.0009942696196958423,
    0.00862505380064249,
    0.026351194828748703,
    0.06453302502632141,
    0.08147865533828735,
    0.06585515290498734,
    -0.02076251246035099,
    0.039022453129291534,
    0.036933593451976776,
    0.016136037185788155,
    0.06040845438838005,
    0.0687309131026268,
    0.0034583979286253452,
    0.008329365402460098,
    0.1067177951335907,
    -0.009449410252273083,
    -0.048248015344142914,
    -0.0051465160213410854,
    0.06392654776573181,
    0.031991999596357346,
    0.025044020265340805,
    0.03454817458987236,
    -0.006782369688153267,
    -0.14307405054569244,
    -0.08747507631778717,
    0.009751267731189728,
    -0.04860890284180641,
    0.06287252902984619,
    0.024895094335079193,
    0.036547351628541946,
    -0.02494218945503235,
    -0.0895221158862114,
    0.013484506867825985,
    -0.06310178339481354,
    0.058134596794843674,
    -0.017624830827116966,
    -0.10527502745389938,
    0.01613292284309864,
    0.011328878812491894,
    0.06721896678209305,
    0.007626885082572699,
    0.03767359256744385,
    0.01740272529423237
  ]
}