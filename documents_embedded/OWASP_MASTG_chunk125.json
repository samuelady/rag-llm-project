{
  "text": "an App Debuggable Bydefault,anappavailableontheAppleAppStoreisnotdebuggable. InordertodebuganiOSapplication,itmusthave theget-task-allowentitlementenabled. Thisentitlementallowsotherprocesses(likeadebugger)toattachtotheapp. Xcodeisnotaddingtheget-task-allowentitlementinadistributionprovisioningprofile;itisonlywhitelistedandadded inadevelopmentprovisioningprofile. Thus,todebuganiOSapplicationobtainedfromtheAppStore,itneedstobere-signedwithadevelopmentprovisioning profilewiththeget-task-allowentitlement. Howtore-signanapplicationisdiscussedinthenextsection. Process Exploration Platform: ios Whentestinganapp,processexplorationcanprovidethetesterwithdeepinsightsintotheappprocessmemory. Itcan beachievedviaruntimeinstrumentationandallowstoperformtaskssuchas: • Retrievingthememorymapandloadedlibraries. • Searchingforoccurrencesofcertaindata. • Afterdoingasearch,obtainingthelocationofacertainoffsetinthememorymap. • Performingamemorydumpandinspectorreverseengineerthebinarydataoffline. • ReverseengineeringabinaryorFrameworkwhileit’srunning. As you can see, these tasks are rather supportive and/or passive, they’ll help us collect data and information that will supportothertechniques. Therefore,they’renormallyusedincombinationwithothertechniquessuchasmethodhook- ing. In the following sections you will be using r2frida to retrieve information straight from the app runtime. First start by openinganr2fridasessiontothetargetapp(e.g.iGoat-Swift)thatshouldberunningonyouriPhone(connectedperUSB). Usethefollowingcommand: r2frida://usb//iGoat-Swift Memory Maps and Inspection Youcanretrievetheapp’smemorymapsbyrunning:dm: 347\\n[0x00000000]>:dm 0x0000000100b7c000 -0x0000000100de0000r-x/private/var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/iGoat-Swift.app/iGoat-Swift 0x0000000100de0000 -0x0000000100e68000rw-/private/var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/iGoat-Swift.app/iGoat-Swift 0x0000000100e68000 -0x0000000100e97000r--/private/var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/iGoat-Swift.app/iGoat-Swift ... 0x0000000100ea8000 -0x0000000100eb0000rw- 0x0000000100eb0000 -0x0000000100eb4000r-- 0x0000000100eb4000 -0x0000000100eb8000r-x/usr/lib/TweakInject.dylib 0x0000000100eb8000 -0x0000000100ebc000rw-/usr/lib/TweakInject.dylib 0x0000000100ebc000 -0x0000000100ec0000r--/usr/lib/TweakInject.dylib 0x0000000100f60000 -0x00000001012dc000r-x ↪ /private/var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/iGoat-Swift.app/Frameworks/Realm.framework/Realm While you’re searching or exploring the app memory, you can always verify where your current offset is located in the memorymap. Insteadofnotingandsearchingforthememoryaddressinthislistyoucansimplyrun:dm.. You’llfindan exampleinthefollowingsection“In-MemorySearch”. Ifyou’reonlyinterestedintothemodules(binariesandlibraries)thattheapphasloaded,youcanusethecommand:il tolistthemall: [0x00000000]>:il 0x0000000100b7c000iGoat-Swift 0x0000000100eb4000TweakInject.dylib 0x00000001862c0000SystemConfiguration 0x00000001847c0000libc++.1.dylib 0x0000000185ed9000Foundation 0x000000018483c000libobjc.A.dylib 0x00000001847be000libSystem.B.dylib 0x0000000185b77000CFNetwork 0x0000000187d64000CoreData 0x00000001854b4000CoreFoundation 0x00000001861d3000Security 0x000000018ea1d000UIKit 0x0000000100f60000Realm Asyoumightexpectyoucancorrelatetheaddressesofthelibrarieswiththememorymaps: e.g.themainappbinary iGoat-Swiftislocatedat0x0000000100b7c000andtheRealmFrameworkat0x0000000100f60000. Youcanalsouseobjectiontodisplaythesameinformation. $objection --gadget OWASP.iGoat-Swiftexplore OWASP.iGoat-Swifton (iPhone:11.1.2)[usb] #memorylistmodules Savetheoutputbyadding `--jsonmodules.json`tothiscommand Name Base Size Path -------------------------------- ----------- -------------------- ------------------------------------------------------------------------------ iGoat-Swift 0x100b7c000 2506752 (2.4MiB) /var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/iGo... TweakInject.dylib 0x100eb4000 16384 (16.0KiB) /usr/lib/TweakInject.dylib SystemConfiguration 0x1862c0000 446464 (436.0KiB) /System/Library/Frameworks/SystemConfiguration.framework/SystemConfiguratio... libc++.1.dylib 0x1847c0000 368640 (360.0KiB) /usr/lib/libc++.1.dylib In-Memory Search In-memorysearchisaveryusefultechniquetotestforsensitivedatathatmightbepresentintheappmemory. See r2frida’s help on the search command (\\/?) to learn about the search command and get a list of options. The followingshowsonlyasubsetofthem: [0x00000000]>\\/? / search /j searchjson /w searchwide /wj searchwidejson /x searchhex /xj searchhexjson ... Youcanadjustyoursearchbyusingthesearchsettings\\e~search. Forexample,\\e search.quiet=true;willprintonly theresultsandhidesearchprogress: 348\\n[0x00000000]>\\e~search esearch.in=perm:r-- esearch.quiet=false Fornow,we’llcontinuewiththedefaultsandconcentrateonstringsearch. Inthisfirstexample,youcanstartbysearching forsomethingthatyouknowshouldbelocatedinthemainbinaryoftheapp: [0x00000000]>\\/iGoat Searching5bytes:69476f6174 Searching5bytesin [0x0000000100b7c000-0x0000000100de0000] ... hits:509 0x100d7d332hit2_0iGoat_Swift24StringAnalysisExerciseVCC 0x100d7d3b2hit2_1iGoat_Swift28BrokenCryptographyExerciseVCC 0x100d7d442hit2_2iGoat_Swift23BackgroundingExerciseVCC 0x100d7d4b2hit2_3iGoat_Swift9AboutCellC 0x100d7d522hit2_4iGoat_Swift12FadeAnimatorV Nowtakethefirsthit,seektoitandcheckyourcurrentlocationinthememorymap: [0x00000000]>s0x100d7d332 [0x100d7d332]>:dm. 0x0000000100b7c000 -0x0000000100de0000r-x/private/var/containers/Bundle/Application/3ADAF47D-A734-49FA-B274-FBCA66589E67/iGoat-Swift.app/iGoat-Swift Asexpected,youarelocatedintheregionofthemainiGoat-Swiftbinary(r-x,readandexecute). Intheprevioussection, yousawthatthemainbinaryislocatedbetween0x0000000100b7c000and0x0000000100e97000. Now,forthissecondexample,youcansearchforsomethingthat’snotintheappbinarynorinanyloadedlibrary,typically userinput. OpentheiGoat-SwiftappandnavigateinthemenutoAuthentication->RemoteAuthentication->Start. Thereyou’llfindapasswordfieldthatyoucanoverwrite. Writethestring“owasp-mstg”butdonotclickonLoginjust yet. Performthefollowingtwosteps. [0x00000000]>\\/owasp-mstg hits:1 0x1c06619c0hit3_0owasp-mstg Infact,thestringcouldbefoundataddress0x1c06619c0. Seekstothereandretrievethecurrentmemoryregionwith :dm.. [0x100d7d332]>s0x1c06619c0 [0x1c06619c0]>:dm. 0x00000001c0000000 -0x00000001c8000000rw- Nowyouknowthatthestringislocatedinarw-(readandwrite)regionofthememorymap. Additionally, you can search for occurrences of the wide version of the string (/w) and, again, check their memory re- gions: Thistimewerunthe\\dm. commandforall@@hitsmatchingtheglobhit5_*. [0x00000000]>/wowasp-mstg Searching20bytes:6f0077006100730070002d006d00730074 006700 Searching20bytesin [0x0000000100708000-0x000000010096c000] ... hits:2 0x1020d1280hit5_06f0077006100730070002d006d00730074006700 0x1030c9c85hit5_16f0077006100730070002d006d00730074006700 [0x00000000]>\\dm.@@hit5_* 0x0000000102000000 -0x0000000102100000rw- 0x0000000103084000 -0x00000001030cc000rw- Theyareinadifferentrw-region. Notethatsearchingforthewideversionsofstringsissometimestheonlywaytofind themasyou’llseeinthefollowingsection. In-memorysearchcan be very useful to quickly know ifcertain data is located in the main app binary, inside a shared libraryorinanotherregion. Youmayalsouseittotestthebehavioroftheappregardinghowthedataiskeptinmemory. Forinstance,youcouldcontinuethepreviousexample,thistimeclickingonLoginandsearchingagainforoccurrences ofthedata. Also,youmaycheckifyoustillcanfindthosestringsinmemoryaftertheloginiscompletedtoverifyifthis sensitivedataiswipedfrommemoryafteritsuse. 349\\nMemory Dump Youcandumptheapp’sprocessmemorywithobjectionandFridump. Totakeadvantageofthesetoolsonanon-jailbroken device,theAndroidappmustberepackagedwithfrida-gadget.soandre-signed. Adetailedexplanationofthisprocess is in the section “Dynamic Analysis on Non-Jailbroken Devices. To use these tools on a jailbroken phone, simply have frida-serverinstalledandrunning. Withobjectionitispossibletodumpallmemoryoftherunningprocessonthedevicebyusingthecommandmemorydump all. $objectionexplore iPhoneon (iPhone:10.3.1)[usb] #memorydumpall/Users/foo/memory_iOS/memory Dumping768.0KiBfrombase:0x1ad200000 [####################################] 100% Memorydumpedtofile:/Users/foo/memory_iOS/memory Alternatively you can use Fridump. First, you need the name of the app you want to dump, which you can get with frida-ps. $frida-ps -U PID Name ---- ------ 1026 Gadget Afterwards,specifytheappnameinFridump. $python3fridump.py -uGadget -s CurrentDirectory:/Users/foo/PentestTools/iOS/fridump Outputdirectoryissetto:/Users/foo/PentestTools/iOS/fridump/dump Creatingdirectory... StartingMemorydump... Progress: [##################################################]100.0%Complete Runningstringsonallfiles: Progress: [##################################################]100.0%Complete Finished!PressCtrl+C Whenyouaddthe-sflag,allstringsareextractedfromthedumpedrawmemoryfilesandaddedtothefilestrings.txt, whichisstoredinFridump’sdumpdirectory. Inbothcases,ifyouopenthefileinradare2youcanuseitssearchcommand(/). Notethatfirstwedoastandardstring searchwhichdoesn’tsucceedandnextwesearchforawidestring,whichsuccessfullyfindsourstring“owasp-mstg”. $r2memory_ios [0x00000000]>/owasp-mstg Searching10bytesin [0x0-0x628c000] hits:0 [0x00000000]>/wowasp-mstg Searching20bytesin [0x0-0x628c000] hits:1 0x0036f800hit4_06f0077006100730070002d006d00730074006700 Next,wecanseektoitsaddressusings0x0036f800orshit4_0andprintitusingpsw(whichstandsforprintstringwide) orusepxtoprintitsrawhexadecimalvalues: [0x0036f800]>psw owasp-mstg [0x0036f800]>px48 -offset - 01 23 45 67 89 AB CD EF 0123456789ABCDEF 0x0036f800 6f0077006100730070002d006d007300 o.w.a.s.p.-.m.s. 0x0036f810 74006700000000000000000000000000 t.g............. 0x0036f820 00000000000000000000000000000000 ................ Notethatinordertofindthisstringusingthestringscommandyou’llhavetospecifyanencodingusingthe-eflagand inthiscaselfor16-bitlittle-endiancharacter. 350\\n$strings -elmemory_ios |grep owasp-mstg owasp-mstg Waiting for the debugger Platform: ios TODO:Shouldbepossiblewithlldbaswell,currentlydon’thaveanything. Get Loaded Native Libraries Platform: ios Using Objection Youcanusethelist_frameworkscommandinobjectiontolistalltheapplication’sbundlesthatrepresentFrameworks. ...itudehacks.DVIAswiftv2.developon (iPhone:13.2.3)[usb] #iosbundleslist_frameworks Executable Bundle Version Path -------------- ----------------------------------------- --------- ------------------------------------------- Bolts org.cocoapods.Bolts 1.9.0 ...8/DVIA-v2.app/Frameworks/Bolts.framework RealmSwift org.cocoapods.RealmSwift 4.1.1 ...A-v2.app/Frameworks/RealmSwift.framework ...ystem/Library/Frameworks/IOKit.framework ... Using Frida",
  "metadata": {
    "doc_id": "OWASP_MASTG",
    "chunk_id": 125
  },
  "embedding": [
    -0.05698445439338684,
    -0.041238248348236084,
    -0.033279430121183395,
    -0.05793014541268349,
    0.04963393881917,
    -0.020268194377422333,
    0.07601439952850342,
    -0.0027798013761639595,
    -0.06911654770374298,
    0.04917391017079353,
    0.01895994134247303,
    -0.07626359164714813,
    -0.028856515884399414,
    0.015871495008468628,
    -0.005821709055453539,
    -0.0010134023614227772,
    0.1382560282945633,
    -0.04439268633723259,
    -0.04642828181385994,
    0.048913437873125076,
    0.026570698246359825,
    -0.0037557370960712433,
    -0.0029307063668966293,
    0.07287657260894775,
    0.02544846199452877,
    0.01484905369579792,
    -0.06299714744091034,
    -0.04029681161046028,
    0.008324281312525272,
    -0.003442088607698679,
    0.044926054775714874,
    -0.02370545268058777,
    0.011906057596206665,
    0.05546754226088524,
    0.11292854696512222,
    -0.002530558966100216,
    0.05059313401579857,
    -0.06824177503585815,
    -0.02637036144733429,
    -0.10680511593818665,
    -0.051588624715805054,
    0.018653562292456627,
    -0.08798740804195404,
    0.09051673859357834,
    -0.00840284489095211,
    -0.02740500681102276,
    -0.026227569207549095,
    -0.03451870009303093,
    -0.02888154797255993,
    0.013765181414783001,
    0.018022460862994194,
    0.015125579200685024,
    -0.009704992175102234,
    0.0487801730632782,
    0.0013305164175108075,
    0.028997264802455902,
    0.0429501011967659,
    0.023426998406648636,
    0.05115955322980881,
    0.09755852818489075,
    0.011977370828390121,
    0.005231465678662062,
    -0.030052732676267624,
    0.009847765788435936,
    -0.014512174762785435,
    0.06264367699623108,
    -0.0611177422106266,
    -0.04580363258719444,
    0.05310238525271416,
    -0.08099120855331421,
    -0.07993068546056747,
    0.0054219006560742855,
    -0.01230122335255146,
    -0.013662064447999,
    -0.004940769635140896,
    -0.04202022776007652,
    0.008777215145528316,
    0.0013860608451068401,
    -0.05590078607201576,
    -0.18119527399539948,
    -0.005637648515403271,
    0.005618406925350428,
    -0.005210901144891977,
    0.10110631585121155,
    0.009067513979971409,
    0.02822953835129738,
    -0.011011771857738495,
    -0.03528660535812378,
    0.08447104692459106,
    0.06620573252439499,
    -0.03552931174635887,
    0.007332013454288244,
    -0.06278441101312637,
    -0.05619565397500992,
    0.06638701260089874,
    -0.040612027049064636,
    0.020738372579216957,
    -0.08032070845365524,
    -0.039926353842020035,
    0.023547759279608727,
    -0.008478892967104912,
    -0.014288507401943207,
    0.02734404057264328,
    -0.055022019892930984,
    0.05511514097452164,
    -0.05152834951877594,
    0.01657230034470558,
    -0.045528262853622437,
    0.006410578265786171,
    0.04612162336707115,
    -0.04929135739803314,
    -0.05489446967840195,
    0.03984791412949562,
    0.00870957039296627,
    0.06487460434436798,
    0.014979067258536816,
    -0.07182162255048752,
    0.06748376041650772,
    0.057852379977703094,
    0.018112394958734512,
    0.07239128649234772,
    0.01888451725244522,
    0.03062411956489086,
    -0.06078753620386124,
    -0.05386880785226822,
    -0.050131335854530334,
    -0.015098142437636852,
    2.2167222675257148e-32,
    -0.003266233019530773,
    -0.016192616894841194,
    -0.02971038781106472,
    0.048445895314216614,
    0.01946250908076763,
    -0.09577392786741257,
    0.053241100162267685,
    0.0731697678565979,
    -0.018675953149795532,
    0.0022436438594013453,
    -0.008311868645250797,
    0.07383693009614944,
    -0.044109541922807693,
    0.0494765043258667,
    0.07012639939785004,
    -0.07304433733224869,
    -0.06399286538362503,
    0.055110540241003036,
    -0.061041317880153656,
    0.03574235364794731,
    0.02706935442984104,
    -0.053789980709552765,
    -0.06102894991636276,
    -0.023569447919726372,
    0.004426246043294668,
    0.014248775318264961,
    -0.01691642962396145,
    0.006584950257092714,
    0.04025580734014511,
    0.041596680879592896,
    -0.06421903520822525,
    0.018055502325296402,
    -0.06771369278430939,
    -0.010422660037875175,
    -0.0026508879382163286,
    -0.06378950923681259,
    0.03351762518286705,
    -0.028393149375915527,
    0.028633207082748413,
    -0.04244531691074371,
    -0.050754252821207047,
    -0.02628241665661335,
    -0.060061126947402954,
    -0.052480824291706085,
    0.03620569780468941,
    -0.03896816074848175,
    0.03827650099992752,
    -0.09283827245235443,
    0.03141766041517258,
    0.030972789973020554,
    0.047319673001766205,
    -0.017232511192560196,
    0.056226879358291626,
    -0.07400941848754883,
    -0.10817330330610275,
    -0.038904014974832535,
    0.009477960877120495,
    -0.0035786128137260675,
    0.032844968140125275,
    0.032999660819768906,
    -0.03890591114759445,
    -0.00767515366896987,
    -0.05600656941533089,
    -0.0482608899474144,
    -0.0017607659101486206,
    0.023985307663679123,
    0.00030408677412196994,
    -0.09577268362045288,
    -0.002775935223326087,
    -0.021704023703932762,
    -0.1162189245223999,
    -0.00917807500809431,
    0.03176836669445038,
    0.004159706644713879,
    -0.0008811223669908941,
    -0.010537334717810154,
    0.006185788195580244,
    0.04650791361927986,
    -0.07333987951278687,
    -0.03569191321730614,
    0.007156856823712587,
    -0.006846928037703037,
    0.007578050252050161,
    -0.038196973502635956,
    0.019900597631931305,
    -0.02116990089416504,
    -0.03495389223098755,
    -0.0920635238289833,
    -0.1300634890794754,
    0.054431091994047165,
    -0.029690880328416824,
    0.028107086196541786,
    -0.007119941059499979,
    0.01772060990333557,
    -0.03165413811802864,
    -2.1567337051305826e-32,
    0.020994488149881363,
    -0.10408008098602295,
    -0.07976644486188889,
    -0.012405485846102238,
    0.018044838681817055,
    -0.007920753210783005,
    -0.06581076234579086,
    -0.010807023383677006,
    0.014929276891052723,
    -0.015394044108688831,
    -0.04181861877441406,
    -0.011155822314321995,
    -0.01865089125931263,
    0.022174572572112083,
    -0.01789838820695877,
    0.0203325804322958,
    0.014098337851464748,
    0.012709980830550194,
    -0.02400301769375801,
    0.08515480160713196,
    -0.01910088211297989,
    0.11153575032949448,
    0.0002936402161139995,
    -0.02092539705336094,
    0.0006891717202961445,
    -0.008213917724788189,
    0.019477156922221184,
    0.020747510716319084,
    0.08910300582647324,
    -0.07861288636922836,
    0.0493217408657074,
    0.004331451840698719,
    -0.09948048740625381,
    -0.053444452583789825,
    -0.009754120372235775,
    -0.014047801494598389,
    -0.011662006378173828,
    -0.005686205346137285,
    -0.10295427590608597,
    0.02328289858996868,
    0.13303014636039734,
    -0.010157370939850807,
    -0.012033459730446339,
    0.021350877359509468,
    0.07766499370336533,
    0.09604703634977341,
    0.008124299347400665,
    -0.05155734345316887,
    -0.02318841777741909,
    0.030804267153143883,
    0.1209830716252327,
    -0.007673792541027069,
    -0.0015622025821357965,
    0.034586407244205475,
    -0.02487638033926487,
    0.0686311274766922,
    0.151394784450531,
    -0.06718456745147705,
    -0.04867148771882057,
    -0.04526233300566673,
    0.11447763442993164,
    0.03553086146712303,
    0.03983180597424507,
    -0.04749993979930878,
    0.061720363795757294,
    0.02467484027147293,
    0.020773660391569138,
    0.03335144370794296,
    -0.048879701644182205,
    0.028750630095601082,
    -0.02062799409031868,
    -0.10360502451658249,
    -0.07286491245031357,
    -0.08270920068025589,
    -0.0023176823742687702,
    0.03360288217663765,
    0.026614079251885414,
    -0.11794085800647736,
    -0.08130056411027908,
    -0.02240714803338051,
    -0.06605173647403717,
    0.09327027201652527,
    -0.005427408032119274,
    -0.01825037971138954,
    0.01820039004087448,
    -0.05175422504544258,
    -0.09201572090387344,
    0.030304022133350372,
    0.00954376719892025,
    0.03891851007938385,
    -0.034598931670188904,
    0.018452370539307594,
    -0.006678977515548468,
    0.062177207320928574,
    -0.06705260276794434,
    -7.250717715123756e-08,
    -0.03206565976142883,
    -0.020790018141269684,
    -0.01928650587797165,
    -0.03244567662477493,
    0.05722331628203392,
    0.05446059629321098,
    0.031166458502411842,
    0.024117982015013695,
    0.04110947623848915,
    -0.11123528331518173,
    -0.03762916475534439,
    -0.03697569668292999,
    -0.12686298787593842,
    0.030983762815594673,
    0.022181957960128784,
    -0.02913745678961277,
    0.01283388864248991,
    0.013768099248409271,
    -0.02890934608876705,
    -0.038371194154024124,
    -0.01152344886213541,
    -0.020981643348932266,
    -0.06426812708377838,
    -0.00793092418462038,
    -0.01211990974843502,
    0.022668922320008278,
    0.0981084555387497,
    0.04445948079228401,
    0.03187929093837738,
    0.06012120842933655,
    0.006145458202809095,
    0.03882179409265518,
    0.029363838955760002,
    -0.037428081035614014,
    -0.019330622628331184,
    0.0800003707408905,
    0.007675082888454199,
    -0.021666480228304863,
    0.07395961135625839,
    -0.013151867315173149,
    0.02560993656516075,
    0.08716266602277756,
    0.028854403644800186,
    0.025718482211232185,
    0.004401737358421087,
    0.03786632791161537,
    -0.04245856776833534,
    -0.037191908806562424,
    0.0732632502913475,
    -0.03752586618065834,
    -0.10498027503490448,
    -0.014844286255538464,
    -0.0057876198552548885,
    0.06429032236337662,
    -0.010592518374323845,
    0.09606970846652985,
    0.05701611191034317,
    -0.095732182264328,
    0.029681453481316566,
    0.046990782022476196,
    0.14566728472709656,
    -0.0039048658218234777,
    0.0758357048034668,
    0.07031471282243729
  ]
}