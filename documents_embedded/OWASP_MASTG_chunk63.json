{
  "text": "10KDec 516:29AndroidManifest.xml -rw-r--r-- 1sven staff 401BDec 516:29apktool.yml drwxr-xr-x 6sven staff 204BDec 516:29assets drwxr-xr-x 3sven staff 102BDec 516:29lib drwxr-xr-x 4sven staff 136BDec 516:29original drwxr-xr-x 131sven staff 4.3KDec 516:29res drwxr-xr-x 9sven staff 306BDec 516:29smali The Android Manifest TheAndroidManifestisthemainsourceofinformation, itincludesalotofinterestinginformationsuchasthepackage name,thepermissions,appcomponents,etc. Here’sanon-exhaustivelistofsomeinfoandthecorrespondingkeywordsthatyoucaneasilysearchforintheAndroid Manifestbyjustinspectingthefileorbyusinggrep -i <keyword> AndroidManifest.xml: • Apppermissions: permission(see“AndroidPlatformAPIs”) • Backupallowance: android:allowBackup(see“DataStorageonAndroid • App components: activity, service, provider, receiver (see “Android Platform APIs” and “Data Storage on Android • Debuggableflag: debuggable(see“CodeQualityandBuildSettingsofAndroidApps”) Pleaserefertothementionedchapterstolearnmoreabouthowtotesteachofthesepoints. App Binary Theappbinary(classes.dex)canbefoundintherootdirectoryoftheapppackage. Itisaso-calledDEX(DalvikExe- cutable)filethatcontainscompiledJavacode. Duetoitsnature,afterapplyingsomeconversionsyou’llbeabletousea decompilertoproduceJavacode. We’vealsoseenthefoldersmalithatwasobtainedafterwerunapktool. Thiscontains thedisassembledDalvikbytecodeinanintermediatelanguagecalledsmali, whichisahuman-readablerepresentation oftheDalvikexecutable. Refertothesection“ReviewingDecompiledJavaCode”inthechapter“TamperingandReverseEngineeringonAndroid” formoreinformationabouthowtoreverseengineerDEXfiles. 114\\nCompiled App Binary Insomecasesitmightbeusefultoretrievethecompiledappbinary(.odex). Firstgetthepathtotheapp’sdatadirectory: adbshellpmpathcom.example.myapplication package:/data/app/~~DEMFPZh7R4qfUwwwh1czYA==/com.example.myapplication-pOslqiQkJclb_1Vk9-WAXg==/base.apk Remove the /base.apk part, add /oat/arm64/base.odex and use the resulting path to pull the base.odex from the device: adbroot adbpull/data/app/~~DEMFPZh7R4qfUwwwh1czYA==/com.example.myapplication-pOslqiQkJclb_1Vk9-WAXg==/oat/arm64/base.odex NotethattheexactdirectorywillbedifferentbasedonyourAndroidversion. Ifthe/oat/arm64/base.odexfilecan’tbe found,manuallysearchinthedirectoryreturnedbypm path. Native Libraries YoucaninspectthelibfolderintheAPK: $ls -1lib/armeabi/ libdatabase_sqlcipher.so libnative.so libsqlcipher_android.so libstlport_shared.so orfromthedevicewithobjection: ...g.vp.owasp_mobile.omtg_androidon (google:8.1.0)[usb] #lslib Type ... Name ------ ... ------------------------ File ... libnative.so File ... libdatabase_sqlcipher.so File ... libstlport_shared.so File ... libsqlcipher_android.so For now this is all information you can get about the native libraries unless you start reverse engineering them, which isdoneusingadifferentapproachthantheoneusedtoreversetheappbinaryasthiscodecannotbedecompiledbut only disassembled. Refer to the section “Reviewing Disassemble Native Code” in the chapter “Tampering and Reverse EngineeringonAndroid”formoreinformationabouthowtoreverseengineertheselibraries. Other App Resources ItisnormallyworthtakingalookattherestoftheresourcesandfilesthatyoumayfindintherootfolderoftheAPKas sometimestheycontainadditionalgoodieslikekeystores,encrypteddatabases,certificates,etc. Symbolic Execution Platform: android Symbolicexecutionisaveryusefultechniquetohaveinyourtoolbox,especiallywhiledealingwithproblemswhereyou needtofindacorrectinputforreachingacertainblockofcode. Inthissection,wewillsolveasimpleAndroidcrackme byusingtheAngrbinaryanalysisframeworkasoursymbolicexecutionengine. Todemonstratethistechniquewe’lluseacrackmecalledAndroidLicenseValidator. ThecrackmeconsistsofasingleELF executablefile,whichcanbeexecutedonanyAndroiddevicebyfollowingtheinstructionsbelow: 115\\n$adbpushvalidate/data/local/tmp [100%]/data/local/tmp/validate $adbshellchmod755/data/local/tmp/validate $adbshell/data/local/tmp/validate Usage:./validate <serial> $adbshell/data/local/tmp/validate12345 Incorrectserial (wrongformat). Sofarsogood,butweknownothingaboutwhatavalidlicensekeylookslike. Togetstarted,opentheELFexecutable inadisassemblersuchasiaito. Themainfunctionislocatedatoffset0x00001874inthedisassembly. Itisimportantto notethatthisbinaryisPIE-enabled,andiaitochoosestoloadthebinaryat0x0asimagebaseaddress. 116\\nThefunctionnameshavebeenstrippedfromthebinary,butluckilythereareenoughdebuggingstringstoprovideusa contexttothecode. Movingforward,wewillstartanalyzingthebinaryfromtheentryfunctionatoffset0x00001874,and keepanoteofalltheinformationeasilyavailabletous. Duringthisanalysis,wewillalsotrytoidentifythecoderegions whicharesuitableforsymbolicexecution. 117\\nstrleniscalledatoffset0x000018a8, andthereturnedvalueiscomparedto0x10atoffset0x000018b0. Immediately afterthat,theinputstringispassedtoaBase32decodingfunctionatoffset0x00001340. Thisprovidesuswithvaluable informationthattheinputlicensekeyisaBase32-encoded16-characterstring(whichtotals10bytesinraw). Thedecoded inputisthenpassedtothefunctionatoffset0x00001760,whichvalidatesthelicensekey. Thedisassemblyofthisfunction isshownbelow. Wecannowusethisinformationabouttheexpectedinputtofurtherlookintothevalidationfunctionat0x00001760. ╭(fcn)fcn.00001760 268 │ fcn.00001760 (int32_targ1); │ ;varint32_tvar_20h@fp-0x20 │ ;varint32_tvar_14h@fp-0x14 │ ;varint32_tvar_10h@fp-0x10 │ ;argint32_targ1@r0 │ ;CALLXREFfromfcn.00001760(+0x1c4) │ 0x00001760 push {r4,fp,lr} │ 0x00001764 addfp,sp,8 │ 0x00001768 subsp,sp,0x1c │ 0x0000176c strr0,[var_20h] ;0x20;\"$!\";arg1 │ 0x00001770 ldrr3,[var_20h] ;0x20;\"$!\";entry.preinit0 │ 0x00001774 strr3,[var_10h] ;str. │ ;0x10 │ 0x00001778 movr3,0 │ 0x0000177c strr3,[var_14h] ;0x14 │ ╭─<0x00001780 b0x17d0 │ │ ;CODEXREFfromfcn.00001760(0x17d8) │ ╭──>0x00001784 ldrr3,[var_10h] ;str. │ │ ;0x10;entry.preinit0 │ ╎│ 0x00001788 ldrbr2,[r3] │ ╎│ 0x0000178c ldrr3,[var_10h] ;str. │ ╎│ ;0x10;entry.preinit0 │ ╎│ 0x00001790 addr3,r3,1 │ ╎│ 0x00001794 ldrbr3,[r3] │ ╎│ 0x00001798 eorr3,r2,r3 │ ╎│ 0x0000179c andr2,r3,0xff │ ╎│ 0x000017a0 mvnr3,0xf │ ╎│ 0x000017a4 ldrr1,[var_14h] ;0x14;entry.preinit0 │ ╎│ 0x000017a8 subr0,fp,0xc │ ╎│ 0x000017ac addr1,r0,r1 │ ╎│ 0x000017b0 addr3,r1,r3 118\\n│ ╎│ 0x000017b4 strbr2,[r3] │ ╎│ 0x000017b8 ldrr3,[var_10h] ;str. │ ╎│ ;0x10;entry.preinit0 │ ╎│ 0x000017bc addr3,r3,2 ;\"ELF\\x01\\x01\\x01\";aav.0x00000001 │ ╎│ 0x000017c0 strr3,[var_10h] ;str. │ ╎│ ;0x10 │ ╎│ 0x000017c4 ldrr3,[var_14h] ;0x14;entry.preinit0 │ ╎│ 0x000017c8 addr3,r3,1 │ ╎│ 0x000017cc strr3,[var_14h] ;0x14 │ ╎│ ;CODEXREFfromfcn.00001760(0x1780) │ ╎╰─>0x000017d0 ldrr3,[var_14h] ;0x14;entry.preinit0 │ ╎ 0x000017d4 cmpr3,4 ;aav.0x00000004;aav.0x00000001;aav.0x00000001 │ ╰──<0x000017d8 ble0x1784 ;likely │ 0x000017dc ldrbr4,[fp,-0x1c] ;\"4\" │ 0x000017e0 blfcn.000016f0 │ 0x000017e4 movr3,r0 │ 0x000017e8 cmpr4,r3 │ ╭─<0x000017ec bne0x1854 ;likely │ │ 0x000017f0 ldrbr4,[fp,-0x1b] │ │ 0x000017f4 blfcn.0000170c │ │ 0x000017f8 movr3,r0 │ │ 0x000017fc cmpr4,r3 │ ╭──<0x00001800 bne0x1854 ;likely │ ││ 0x00001804 ldrbr4,[fp,-0x1a] │ ││ 0x00001808 blfcn.000016f0 │ ││ 0x0000180c movr3,r0 │ ││ 0x00001810 cmpr4,r3 │ ╭───<0x00001814 bne0x1854 ;likely │ │││ 0x00001818 ldrbr4,[fp,-0x19] │ │││ 0x0000181c blfcn.00001728 │ │││ 0x00001820 movr3,r0 │ │││ 0x00001824 cmpr4,r3 │ ╭────<0x00001828 bne0x1854 ;likely │ ││││ 0x0000182c ldrbr4,[fp,-0x18] │ ││││ 0x00001830 blfcn.00001744 │ ││││ 0x00001834 movr3,r0 │ ││││ 0x00001838 cmpr4,r3 │ ╭─────<0x0000183c bne0x1854 ;likely │ │││││ 0x00001840 ldrr3,[0x0000186c] ;[0x186c:4]=0x270section..hash;section..hash │ │││││ 0x00001844 addr3,pc,r3",
  "metadata": {
    "doc_id": "OWASP_MASTG",
    "chunk_id": 63
  },
  "embedding": [
    -0.03388510271906853,
    -0.029629888013005257,
    0.011834579519927502,
    -0.114417165517807,
    0.043593697249889374,
    -0.0636696070432663,
    0.01810593344271183,
    -0.005432908423244953,
    -0.02565375156700611,
    -0.011669084429740906,
    0.041562482714653015,
    -0.061981335282325745,
    0.08063115924596786,
    -0.04129696264863014,
    0.0011532107600942254,
    -0.027755487710237503,
    -0.004266180098056793,
    -0.003144477726891637,
    -0.03862899914383888,
    0.047982774674892426,
    0.030141647905111313,
    0.06405604630708694,
    -0.0048776306211948395,
    -0.03275240585207939,
    0.06367482990026474,
    0.03697147220373154,
    -0.0686177909374237,
    -0.02210112288594246,
    -0.036125753074884415,
    -0.04948510229587555,
    0.025032637640833855,
    0.11128812283277512,
    0.0681598037481308,
    0.0860683023929596,
    0.008375527337193489,
    -0.006451105698943138,
    -0.02308877743780613,
    -0.02197330817580223,
    0.004552456550300121,
    -0.0028207525610923767,
    -0.06292586773633957,
    0.011302360333502293,
    0.021461881697177887,
    0.09306345134973526,
    -0.1040605828166008,
    -0.01863357238471508,
    -0.07958720624446869,
    -0.05535764619708061,
    0.010890178382396698,
    0.054307132959365845,
    0.03278183564543724,
    0.04459254816174507,
    0.04448052495718002,
    0.08226633071899414,
    -0.023776084184646606,
    0.04133367910981178,
    -0.07025115191936493,
    0.028074441477656364,
    -0.00036752966116182506,
    0.08237098157405853,
    0.01364822220057249,
    0.0018959775334224105,
    -0.044708024710416794,
    0.04844900220632553,
    -0.0750514343380928,
    0.020449604839086533,
    -0.038605134934186935,
    -0.07311350107192993,
    0.05572788044810295,
    -0.03582875803112984,
    -0.005253770854324102,
    0.057385172694921494,
    -0.018773740157485008,
    0.024075746536254883,
    -0.04811796173453331,
    0.03571036458015442,
    0.04394695535302162,
    9.623913683753926e-06,
    -0.06108720973134041,
    -0.14179293811321259,
    -0.04446389526128769,
    0.042356207966804504,
    -0.011318083852529526,
    0.09740825742483139,
    -0.0190595593303442,
    0.04210355132818222,
    0.05399300530552864,
    0.013412061147391796,
    -0.021510830149054527,
    0.07139204442501068,
    -0.006471795961260796,
    0.06928766518831253,
    -0.008899647742509842,
    -0.05861026421189308,
    -0.06907963752746582,
    0.03222369775176048,
    -0.03741437569260597,
    -0.009309749118983746,
    -0.11478374898433685,
    0.10870056599378586,
    0.01003294438123703,
    0.02997947297990322,
    0.010064922273159027,
    -0.09306175261735916,
    -0.02607724629342556,
    -0.03769133612513542,
    0.018802128732204437,
    0.025368565693497658,
    -0.10486489534378052,
    0.027820421382784843,
    -0.004866952076554298,
    -0.018778860569000244,
    -0.044425442814826965,
    -0.03826403245329857,
    0.0032377406023442745,
    -0.005749377887696028,
    0.029708903282880783,
    0.05261829122900963,
    0.04769068956375122,
    0.0324351042509079,
    0.09170278161764145,
    -0.014856955967843533,
    -0.05106841027736664,
    -0.09240646660327911,
    -0.010492871515452862,
    -0.005056424532085657,
    -0.06874198466539383,
    1.9990603866877674e-32,
    0.03128676116466522,
    0.019684160128235817,
    -0.003960421774536371,
    -0.020946752279996872,
    -0.00965114962309599,
    -0.03417941927909851,
    0.053928304463624954,
    0.1289900690317154,
    -0.029133325442671776,
    -0.08895264565944672,
    0.005245512817054987,
    0.058784909546375275,
    -0.006362468935549259,
    -0.03370881453156471,
    0.03185766562819481,
    -0.10337913036346436,
    0.012562096118927002,
    0.04723217338323593,
    -0.030445927754044533,
    0.03206820413470268,
    0.0013045384548604488,
    -0.06507520377635956,
    -0.029277782887220383,
    -0.016169065609574318,
    -0.06009036675095558,
    0.043349552899599075,
    0.006656712386757135,
    0.023995039984583855,
    0.01975431479513645,
    0.017443595454096794,
    -0.08194165676832199,
    -0.03738975152373314,
    -0.022305253893136978,
    0.03031359240412712,
    0.0010671841446310282,
    0.006539241876453161,
    -0.028361083939671516,
    -0.045758120715618134,
    -0.0032757557928562164,
    -0.06634621322154999,
    -0.09069772809743881,
    -0.004075685050338507,
    -0.08452247083187103,
    -0.0039474559016525745,
    -0.004510996397584677,
    -0.013504735194146633,
    -0.010658630169928074,
    -0.05760439857840538,
    -0.007984708994626999,
    0.0011550645576789975,
    0.007324105128645897,
    0.019576366990804672,
    0.05594123899936676,
    -0.03537873178720474,
    -0.06289617717266083,
    -0.047908492386341095,
    -0.06405126303434372,
    0.032282207161188126,
    -0.04802251607179642,
    0.046992022544145584,
    0.030742483213543892,
    0.034430406987667084,
    0.013516430743038654,
    0.02897201105952263,
    0.01087984535843134,
    -0.018952427431941032,
    0.04849476367235184,
    -0.08841098845005035,
    -0.006414604373276234,
    0.02540520951151848,
    -0.04481467977166176,
    -0.051053278148174286,
    0.14364661276340485,
    0.05920419842004776,
    -0.03916158154606819,
    -0.002855053637176752,
    0.004731655120849609,
    -0.050846539437770844,
    -0.04972635954618454,
    -0.06853916496038437,
    0.030834848061203957,
    -0.00983474962413311,
    0.0017452463507652283,
    -0.01315669622272253,
    -0.0026685483753681183,
    -0.01399187557399273,
    0.053163331001996994,
    -0.07629907131195068,
    -0.056205909699201584,
    0.03933339938521385,
    -0.040733449161052704,
    -0.009105575270950794,
    0.019971255213022232,
    -0.05352877825498581,
    -0.09517309814691544,
    -1.847326253452482e-32,
    -0.022680990397930145,
    -0.0679502859711647,
    0.026817023754119873,
    -0.05637463927268982,
    0.04090021178126335,
    -0.005868011154234409,
    -0.016991987824440002,
    0.0720987617969513,
    0.02279215306043625,
    0.016727427020668983,
    0.04969986900687218,
    0.027228232473134995,
    -0.05182716250419617,
    -0.07967973500490189,
    0.037173863500356674,
    0.05001668632030487,
    0.0550435408949852,
    0.014737533405423164,
    -0.06656894087791443,
    0.015690205618739128,
    -0.03979486972093582,
    0.1618804931640625,
    0.0061648753471672535,
    0.070888452231884,
    0.03782251849770546,
    0.007325594779103994,
    0.05594544857740402,
    0.07696442306041718,
    0.037679001688957214,
    -0.02718297764658928,
    0.08240275084972382,
    -0.01429841760545969,
    -0.10249499976634979,
    -0.018897777423262596,
    0.06622086465358734,
    -0.015219167806208134,
    -0.07491515576839447,
    0.05798947066068649,
    -0.013135517947375774,
    0.04076351597905159,
    0.03190828859806061,
    -0.08800756186246872,
    0.015461517497897148,
    0.027445757761597633,
    0.03050098940730095,
    -0.1100129783153534,
    -0.010984030552208424,
    -0.017290864139795303,
    -0.003137921215966344,
    0.010445577092468739,
    0.07164113968610764,
    -0.03636914864182472,
    0.0007584591512568295,
    0.00862641166895628,
    0.06814979761838913,
    0.06737558543682098,
    0.012301716953516006,
    -0.051185838878154755,
    0.058054469525814056,
    -0.10354838520288467,
    0.018852300941944122,
    -0.01930883526802063,
    -0.04622694477438927,
    0.04333312064409256,
    0.04985107108950615,
    -0.05660435929894447,
    0.015181174501776695,
    0.01772027276456356,
    -0.09840244799852371,
    0.09129445999860764,
    -0.02487616240978241,
    -0.04261377826333046,
    -0.12871786952018738,
    0.0031897726003080606,
    0.03247625008225441,
    0.03318459913134575,
    0.011876077391207218,
    -0.0773792564868927,
    -0.11463095247745514,
    0.016237501055002213,
    -0.005437023937702179,
    0.0659094974398613,
    -0.013396267779171467,
    0.012351185083389282,
    0.050318244844675064,
    -0.05346491187810898,
    -0.041476164013147354,
    0.06877224147319794,
    -0.03688254579901695,
    -0.008202382363379002,
    -0.0314495824277401,
    -0.0019664871506392956,
    -0.04032544046640396,
    0.08156749606132507,
    -0.005659407004714012,
    -6.705537458628896e-08,
    0.020367609336972237,
    -0.03985494375228882,
    -0.03422420844435692,
    0.0025752943474799395,
    0.11765840649604797,
    0.02862941287457943,
    -0.0008468572050333023,
    0.011701878160238266,
    0.03704586252570152,
    -0.0508149079978466,
    0.03601834550499916,
    -0.022780979052186012,
    -0.08449365943670273,
    -0.018122538924217224,
    0.0778713971376419,
    -0.05428214743733406,
    -0.014041002839803696,
    0.0742947980761528,
    -0.07058848440647125,
    -0.05121300742030144,
    -0.03558812662959099,
    -0.01511326339095831,
    -0.03128997981548309,
    -0.06424368917942047,
    0.020270714536309242,
    0.05086716264486313,
    0.05111106485128403,
    0.07031428068876266,
    -0.000950120622292161,
    0.07179734855890274,
    0.055425014346838,
    -0.03155997395515442,
    0.016534218564629555,
    -0.12829656898975372,
    0.05174638703465462,
    0.07765732705593109,
    -0.01002400554716587,
    -0.0385454036295414,
    0.0656990185379982,
    0.033668313175439835,
    -0.04424397274851799,
    0.04887101799249649,
    0.05933249369263649,
    0.11811376363039017,
    -0.04615055024623871,
    -0.01733466610312462,
    -0.05423401668667793,
    0.08630117028951645,
    0.08455276489257812,
    -0.07682511955499649,
    -0.0597994439303875,
    -0.02656739205121994,
    -0.05513766035437584,
    -0.0489039421081543,
    -0.05416399985551834,
    0.04521811008453369,
    -0.04547080397605896,
    -0.012623781338334084,
    -0.012207630090415478,
    0.027959831058979034,
    0.07418058067560196,
    0.06114979833364487,
    0.012695486657321453,
    0.06525495648384094
  ]
}