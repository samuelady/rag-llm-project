{
  "text": "successCallback(message){ alert(message); //Messageisalways:CONNECTION_SECURE. //Nowdosomethingwiththetrustedserver. } function errorCallback(message){ alert(message); if(message ===\"CONNECTION_NOT_SECURE\"){ //Thereislikelyamaninthemiddleattackgoingon,becareful! }else if(message.indexOf(\"CONNECTION_FAILED\")>-1){ //Therewasnoconnection(yet).Internetmaybedown.Tryagain(afewtimes)afteralittletimeout. } } AfterdecompressingtheAPKfile,Cordova/Phonegapfileswillbelocatedinthe/assets/wwwfolder. The‘plugins’folderwill giveyouthevisibilityofthepluginsused. WewillneedtosearchforthismethodsintheJavaScriptcodeoftheapplication toconfirmitsusage. Dynamic Analysis Followtheinstructionsfrom“TestingEndpointIdentifyVerification>DynamicAnalysis”. Ifdoingsodoesn’tleadtotraffic beingproxied,itmaymeanthatcertificatepinningisactuallyimplementedandallsecuritymeasuresareinplace. Does thesamehappenforalldomains? As a quick smoke test, you can try to bypass certificate pinning using objection as described in “Bypassing Certificate Pinning”. PinningrelatedAPIsbeinghookedbyobjectionshouldappearinobjection’soutput. However,keepinmindthat: • theAPIsmightnotbecomplete. • ifnothingishooked,thatdoesn’tnecessarilymeanthattheappdoesn’timplementpinning. Inbothcases,theapporsomeofitscomponentsmightimplementcustompinninginawaythatissupportedbyobjection. Pleasecheckthestaticanalysissectionforspecificpinningindicatorsandmorein-depthtesting. 238\\nTesting Endpoint Identify Verification Platform: android MASVSV1: MSTG-NETWORK-3 MASVSV2: MASVS-NETWORK-1 Overview Static Analysis UsingTLStotransportsensitiveinformationoverthenetworkisessentialforsecurity. However,encryptingcommunication betweenamobileapplicationanditsbackendAPIisnottrivial. Developersoftendecideonsimplerbutlesssecuresolutions (e.g.,thosethatacceptanycertificate)tofacilitatethedevelopmentprocess,andsometimestheseweaksolutionsmake itintotheproductionversion,potentiallyexposinguserstoman-in-the-middleattacks. Twokeyissuesshouldbeaddressed: • Verifythatacertificatecomesfromatrustedsource,i.e.atrustedCA(CertificateAuthority). • Determinewhethertheendpointserverpresentstherightcertificate. Makesurethatthehostnameandthecertificateitselfareverifiedcorrectly. Examplesandcommonpitfallsareavailable intheofficialAndroiddocumentation. SearchthecodeforexamplesofTrustManagerandHostnameVerifierusage. In thesectionsbelow,youcanfindexamplesofthekindofinsecureusagethatyoushouldlookfor. Notethat fromAndroid8.0(API level 26) onward, thereis no supportfor SSLv3 andHttpsURLConnection willno longerperformafallbacktoaninsecureTLS/SSLprotocol. Verifying the Target SDK Version Applications targeting Android 7.0 (API level 24) or higher will use a default Network Security Configuration that doesn’t trust any user supplied CAs, reducing the possibility of MITM attacks by luring users to install malicious CAs. DecodetheappusingapktoolandverifythatthetargetSdkVersioninapktool.ymlisequaltoorhigherthan24. greptargetSdkVersionUnCrackable-Level3/apktool.yml targetSdkVersion:'28' However, even if targetSdkVersion >=24, the developer can disable default protections by using a custom Network Security Configuration defining a custom trust anchor forcing the app to trust user supplied CAs. See “Analyzing CustomTrustAnchors”. Analyzing Custom Trust Anchors Search for the Network Security Configuration file and inspect any custom <trust-anchors> defining <certificates src=\"user\">(whichshouldbeavoided). Youshouldcarefullyanalyzetheprecedenceofentries: • Ifavalueisnotsetina<domain-config>entryorinaparent<domain-config>,theconfigurationsinplacewillbe basedonthe<base-config> • Ifnotdefinedinthisentry,thedefaultconfigurationswillbeused. TakealookatthisexampleofaNetworkSecurityConfigurationforanapptargetingAndroid9(APIlevel28): 239\\n<?xml version=\"1.0\" encoding=\"utf-8\"?> <network-security-config> <domain-config> <domain includeSubdomains=\"false\">owasp.org</domain> <trust-anchors> <certificates src=\"system\" /> <certificates src=\"user\" /> </trust-anchors> </domain-config> </network-security-config> Someobservations: • There’sno<base-config>,meaningthatthedefaultconfigurationforAndroid9(APIlevel28)orhigherwillbeused forallotherconnections(onlysystemCAwillbetrustedinprinciple). • However,the<domain-config>overridesthedefaultconfigurationallowingtheapptotrustbothsystemanduser CAsfortheindicated<domain>(owasp.org). • Thisdoesn’taffectsubdomainsbecauseofincludeSubdomains=\"false\". PuttingalltogetherwecantranslatetheaboveNetworkSecurityConfigurationto: “theapptrustssystemanduserCAs fortheowasp.orgdomain,excludingitssubdomains. ForanyotherdomainstheappwilltrustthesystemCAsonly”. Verifying the Server Certificate TrustManagerisameansofverifyingconditionsnecessaryforestablishingatrustedconnectioninAndroid. Thefollowing conditionsshouldbecheckedatthispoint: • HasthecertificatebeensignedbyatrustedCA? • Hasthecertificateexpired? • Isthecertificateself-signed? Thefollowingcodesnippetissometimesusedduringdevelopmentandwillacceptanycertificate,overwritingthefunctions checkClientTrusted,checkServerTrusted,andgetAcceptedIssuers. Suchimplementationsshouldbeavoided,and, iftheyarenecessary,theyshouldbeclearlyseparatedfromproductionbuildstoavoidbuilt-insecurityflaws. TrustManager[]trustAllCerts =newTrustManager[]{ newX509TrustManager(){ @Override public X509Certificate[]getAcceptedIssuers(){ return newjava.security.cert.X509Certificate[]{}; } @Override public void checkClientTrusted(X509Certificate[]chain,StringauthType) throws CertificateException { } @Override public void checkServerTrusted(X509Certificate[]chain,StringauthType) throws CertificateException { } } }; //SSLContextcontext context.init(null,trustAllCerts,newSecureRandom()); WebView Server Certificate Verification Sometimes applications use a WebView to render the website associated with the application. This is true of HTML/JavaScript-basedframeworkssuchasApacheCordova,whichusesaninternalWebViewforapplicationinteraction. When a WebView is used, the mobile browser performs the server certificate validation. Ignoring any TLS error that occurswhentheWebViewtriestoconnecttotheremotewebsiteisabadpractice. The following code will ignore TLS issues, exactly like the WebViewClient custom implementation provided to the Web- View: 240\\nWebViewmyWebView =(WebView)findViewById(R.id.webview); myWebView.setWebViewClient(newWebViewClient(){ @Override public void onReceivedSslError(WebViewview,SslErrorHandlerhandler,SslErrorerror){ //IgnoreTLScertificateerrorsandinstructtheWebViewClienttoloadthewebsite handler.proceed(); } }); Apache Cordova Certificate Verification ImplementationoftheApacheCordovaframework’sinternalWebViewusagewillignoreTLSerrorsinthemethodonRe- ceivedSslErroriftheflagandroid:debuggableisenabledintheapplicationmanifest. Therefore, makesurethatthe appisnotdebuggable. Seethetestcase“TestingIftheAppisDebuggable”. Hostname Verification Anothersecurityflawinclient-sideTLSimplementationsisthelackofhostnameverification. Developmentenvironments usuallyuseinternaladdressesinsteadofvaliddomainnames,sodevelopersoftendisablehostnameverification(orforce an application to allow any hostname) and simply forget to change it when their application goes to production. The followingcodedisableshostnameverification: final static HostnameVerifierNO_VERIFY =newHostnameVerifier(){ public boolean verify(Stringhostname,SSLSessionsession){ return true; } }; Withabuilt-inHostnameVerifier,acceptinganyhostnameispossible: HostnameVerifierNO_VERIFY =org.apache.http.conn.ssl.SSLSocketFactory .ALLOW_ALL_HOSTNAME_VERIFIER; Makesurethatyourapplicationverifiesahostnamebeforesettingatrustedconnection. Dynamic Analysis WhentestinganapptargetingAndroid7.0(APIlevel24)orhigheritshouldbeeffectivelyapplyingtheNetworkSecurity Configurationandyoushouldn’tabletoseethedecryptedHTTPStrafficatfirst. However, iftheapptargetsAPIlevels below24,theappwillautomaticallyaccepttheinstalledusercertificates. TotestimpropercertificateverificationlaunchaMITMattackusinganinterceptionproxysuchasBurp. Trythefollowing options: • Self-signedcertificate: 1. InBurp,gototheProxytabandselecttheOptionstab. 2. GototheProxyListenerssection,highlightyourlistener,andclickEdit. 3. GototheCertificatetab,checkUseaself-signedcertificate,andclickOk. 4. Runyourapplication. Ifyou’reabletoseeHTTPStraffic,yourapplicationisacceptingself-signedcertificates. • AcceptingcertificateswithanuntrustedCA: 1. InBurp,gototheProxytabandselecttheOptionstab. 2. GototheProxyListenerssection,highlightyourlistener,andclickEdit. 3. GototheCertificatetab,checkGenerateaCA-signedcertificatewithaspecifichostname,andtype inthebackendserver’shostname. 4. Run your application. If you’re able to see HTTPS traffic, your application is accepting certificates with an untrustedCA. • Acceptingincorrecthostnames: 1. InBurp,gototheProxytabandselecttheOptionstab. 241\\n2. GototheProxyListenerssection,highlightyourlistener,andclickEdit. 3. GototheCertificatetab,checkGenerateaCA-signedcertificatewithaspecifichostname,andtype inaninvalidhostname,e.g.,example.org. 4. Runyourapplication. Ifyou’reabletoseeHTTPStraffic,yourapplicationisacceptingallhostnames. Ifyou’restillnotabletoseeanydecryptedHTTPStraffic,yourapplicationmightbeimplementingcertificatepinning. Testing the Security Provider Platform: android MASVSV1: MSTG-NETWORK-6 MASVSV2: MASVS-NETWORK-1 Overview Static Analysis ApplicationsbasedontheAndroidSDKshoulddependonGooglePlayServices. Forexample,inthegradlebuildfile,youwill findcompile'com.google.android.gms:play-services-gcm:x.x.x'inthedependenciesblock. Youneedtomakesure thattheProviderInstallerclassiscalledwitheitherinstallIfNeededorinstallIfNeededAsync. ProviderInstaller needstobecalledbyacomponentoftheapplicationasearlyaspossible. Exceptionsthrownbythesemethodsshould becaughtandhandledcorrectly. Iftheapplicationcannotpatchitssecurityprovider,itcaneitherinformtheAPIofits lesssecurestateorrestrictuseractions(becauseallHTTPStrafficshouldbedeemedriskierinthissituation). Ifyouhaveaccesstothesourcecode, checkiftheapphandleanyexceptionsrelatedtothesecurityproviderupdates properly, and if it reports to the backend when the application is working",
  "metadata": {
    "doc_id": "OWASP_MASTG",
    "chunk_id": 94
  },
  "embedding": [
    -0.04693875461816788,
    0.02754702977836132,
    0.011022429913282394,
    0.029486438259482384,
    -0.015763938426971436,
    -0.07461120188236237,
    -0.024313921108841896,
    -0.03923022001981735,
    0.0563555508852005,
    -0.003222725121304393,
    0.0441923663020134,
    0.004823969677090645,
    -0.011837279424071312,
    0.05677725747227669,
    -0.03364099934697151,
    -0.006291400175541639,
    0.00857599452137947,
    -0.00909330788999796,
    -0.08094557374715805,
    0.009761467576026917,
    0.04483576491475105,
    0.007919995114207268,
    0.006923954468220472,
    -0.013783842325210571,
    0.043012555688619614,
    -0.053445130586624146,
    -0.055352043360471725,
    0.024864546954631805,
    -0.023979783058166504,
    -0.0023835275787860155,
    0.04465923830866814,
    -0.023136524483561516,
    0.023344818502664566,
    -0.012549031525850296,
    -0.02798308990895748,
    0.02793719246983528,
    -0.04894767701625824,
    -0.008458299562335014,
    -0.044333476573228836,
    0.003743724897503853,
    -0.007254390511661768,
    -2.4943223252194002e-05,
    -0.011195909231901169,
    0.08115344494581223,
    -0.0046518342569470406,
    -0.07971394807100296,
    -0.04659424349665642,
    0.0010658323299139738,
    -0.051061343401670456,
    0.019604409113526344,
    0.05976342782378197,
    0.020479587838053703,
    -0.028035759925842285,
    0.032113052904605865,
    -0.10324881970882416,
    0.08875374495983124,
    -0.034878458827733994,
    0.11349079012870789,
    0.030363967642188072,
    0.05829652398824692,
    0.08504844456911087,
    -0.006566663272678852,
    -0.05049970746040344,
    -0.025055047124624252,
    -0.038452934473752975,
    0.04533713683485985,
    0.018244633451104164,
    -0.002696212148293853,
    -0.035260237753391266,
    0.05516115576028824,
    -0.017243193462491035,
    0.011421657167375088,
    -0.08332442492246628,
    0.012209276668727398,
    0.0434500128030777,
    0.02992631308734417,
    0.05702466890215874,
    0.023403692990541458,
    -0.015770437195897102,
    -0.03535417094826698,
    0.08374588936567307,
    -0.06552611291408539,
    0.020312413573265076,
    0.08305869996547699,
    0.0233075600117445,
    0.023534536361694336,
    0.01816890388727188,
    0.050308164209127426,
    0.004593340214341879,
    -0.10533969849348068,
    0.045063454657793045,
    0.1065460592508316,
    -0.08249344676733017,
    0.049379292875528336,
    -0.037951719015836716,
    -0.00036623518099077046,
    -0.11361884325742722,
    -0.010227552615106106,
    -0.060731325298547745,
    0.008607598021626472,
    0.05581420660018921,
    -0.01079997606575489,
    -0.010952332988381386,
    -0.03605969250202179,
    0.020425697788596153,
    -0.07070863246917725,
    0.05046462267637253,
    -0.023140551522374153,
    0.048552703112363815,
    0.07078509032726288,
    -0.010179664008319378,
    -0.03258970007300377,
    0.059076473116874695,
    0.001007740618661046,
    0.011010590009391308,
    0.0633138120174408,
    -0.049513693898916245,
    0.14175952970981598,
    0.10670073330402374,
    0.025035319849848747,
    0.011438471265137196,
    -0.035479024052619934,
    0.002061506500467658,
    -0.15537129342556,
    0.0011776161845773458,
    -0.037537895143032074,
    0.07707405835390091,
    1.2617728443735602e-32,
    0.013761010020971298,
    0.0072616999968886375,
    -0.03595012053847313,
    0.04691530019044876,
    -0.002795059699565172,
    -0.06647524982690811,
    0.0451701320707798,
    -0.030776813626289368,
    -0.0744050145149231,
    -0.02508101984858513,
    -0.03430633619427681,
    0.0033193137496709824,
    -0.02900621108710766,
    -0.0682436153292656,
    -0.022982802242040634,
    -0.01403055526316166,
    0.04047683626413345,
    -0.04577501490712166,
    0.041104599833488464,
    0.035894040018320084,
    0.030485056340694427,
    -0.10040537267923355,
    0.07614477723836899,
    -0.00220434064976871,
    0.058945707976818085,
    0.02874542586505413,
    0.053839463740587234,
    0.03963647782802582,
    -0.004547064192593098,
    -0.005217341706156731,
    -0.031555306166410446,
    0.006261270027607679,
    -0.05577719211578369,
    0.017877817153930664,
    0.025445066392421722,
    -0.01798897236585617,
    0.0017387396655976772,
    -0.016287414357066154,
    0.005513420328497887,
    -0.012211279943585396,
    -0.03828930854797363,
    -0.06285880506038666,
    -0.12686820328235626,
    0.06415435671806335,
    0.009626288898289204,
    -0.0629744827747345,
    -0.01428664568811655,
    0.004766241647303104,
    0.10104919224977493,
    0.0351480133831501,
    -0.0931461974978447,
    -0.040110472589731216,
    -0.0076293195597827435,
    -0.05160123109817505,
    -0.05685463547706604,
    0.031232230365276337,
    -0.07951931655406952,
    0.05249950662255287,
    -0.06309501826763153,
    -0.07747525721788406,
    0.02862395904958248,
    -0.029873793944716454,
    -0.03210476413369179,
    -0.06954176723957062,
    0.02529269829392433,
    -0.009330902248620987,
    -0.038513053208589554,
    -0.038707077503204346,
    -0.03651119023561478,
    -0.02740376442670822,
    -0.05192352086305618,
    -0.02654496766626835,
    0.043656185269355774,
    0.06017392873764038,
    -0.07584509998559952,
    0.018299434334039688,
    0.010809403844177723,
    0.06171451881527901,
    0.014499149285256863,
    -0.023063641041517258,
    0.04021035134792328,
    -0.07485239207744598,
    0.031128132715821266,
    -0.0073578497394919395,
    0.07916702330112457,
    -0.009715121239423752,
    0.03721461072564125,
    -0.07304561138153076,
    -0.07756385952234268,
    0.14583353698253632,
    -0.06712906807661057,
    0.06993909925222397,
    0.04244497790932655,
    -0.00877662654966116,
    -0.03065941296517849,
    -1.1677258759996876e-32,
    -0.013423284515738487,
    -0.03621011972427368,
    -0.06761745363473892,
    0.054197367280721664,
    0.03241140395402908,
    -0.022421376779675484,
    -0.00636355672031641,
    0.03905684873461723,
    -0.002805265597999096,
    0.04292438179254532,
    0.01976291462779045,
    0.04253377392888069,
    0.07970887422561646,
    -0.07904303073883057,
    -0.03403230383992195,
    0.0601724237203598,
    0.008886570110917091,
    -0.09036015719175339,
    -0.04648736119270325,
    0.03662377595901489,
    0.024286454543471336,
    0.038731109350919724,
    -0.05325429141521454,
    0.04008345305919647,
    -0.03143642097711563,
    -0.01927941106259823,
    -0.022826889529824257,
    -0.004054628778249025,
    -0.02210700511932373,
    -0.06825393438339233,
    0.035054657608270645,
    0.004090811125934124,
    -0.05255752056837082,
    0.035952240228652954,
    0.024018438532948494,
    0.014681673608720303,
    0.05627524480223656,
    0.004200804512947798,
    0.030157066881656647,
    0.034758131951093674,
    0.04337674751877785,
    -0.010131493210792542,
    -0.04891754686832428,
    -0.052819885313510895,
    0.07201748341321945,
    -0.04752402752637863,
    0.011995851993560791,
    -0.07793053239583969,
    -0.12904319167137146,
    0.05443095043301582,
    0.09579893201589584,
    0.009190931916236877,
    0.015848230570554733,
    0.07937251776456833,
    0.021341748535633087,
    0.09286723285913467,
    0.03590463474392891,
    -0.057739581912755966,
    -0.03745347633957863,
    0.013845128938555717,
    0.044952478259801865,
    -0.1320471465587616,
    0.01989847421646118,
    0.009674601256847382,
    0.06051897257566452,
    0.05724938213825226,
    0.032421503216028214,
    0.04852137714624405,
    0.11504890024662018,
    0.09248441457748413,
    -0.06292140483856201,
    -0.03273987025022507,
    -0.018522122874855995,
    -0.05670847371220589,
    0.053057100623846054,
    0.05632934719324112,
    -0.04115026444196701,
    -0.08442234247922897,
    -0.03781057149171829,
    -0.0016965940594673157,
    0.04048846662044525,
    0.0974588617682457,
    -0.04153810814023018,
    -0.04278254881501198,
    0.0814812183380127,
    -0.015898922458291054,
    -0.01780516840517521,
    0.07153522223234177,
    0.020303785800933838,
    0.028260646387934685,
    -0.09149356931447983,
    -0.027776392176747322,
    -0.010986339300870895,
    0.03993413597345352,
    0.000554115860722959,
    -6.12810495681515e-08,
    0.011647135019302368,
    0.00628154631704092,
    -0.01718803308904171,
    -0.10051911324262619,
    0.094970703125,
    -0.007309578359127045,
    0.04671823978424072,
    -0.08091140538454056,
    0.018001209944486618,
    -0.04359617456793785,
    -0.04330023378133774,
    -0.018508046865463257,
    -0.02388477697968483,
    0.06329865008592606,
    -0.02874118834733963,
    -0.06599552184343338,
    0.0436333492398262,
    0.01695193722844124,
    0.00861591286957264,
    -0.0211248267441988,
    0.06955254077911377,
    -0.00740366755053401,
    -0.05478823184967041,
    0.014774205163121223,
    0.02423332817852497,
    -0.026441043242812157,
    0.0018772934563457966,
    0.024799218401312828,
    -0.06385713815689087,
    -0.00753745948895812,
    -0.06438624858856201,
    -0.057752594351768494,
    0.0042136781848967075,
    -0.1115846112370491,
    -0.09954182803630829,
    0.15087072551250458,
    0.050433672964572906,
    -0.09973835945129395,
    0.05448341742157936,
    -0.024031389504671097,
    0.1191278025507927,
    0.05309683457016945,
    0.03778807446360588,
    0.031964708119630814,
    -0.001483673113398254,
    -0.04017508774995804,
    -4.709984750661533e-06,
    0.02571026049554348,
    0.04071018099784851,
    0.02713257446885109,
    -0.08145195245742798,
    -0.04702843353152275,
    -0.09179006516933441,
    -0.03548237681388855,
    -0.02981991320848465,
    -0.0868857279419899,
    0.035706646740436554,
    0.014526158571243286,
    0.010132650844752789,
    -0.004663587547838688,
    -0.004132826812565327,
    -0.007314322981983423,
    0.04426399990916252,
    -0.09681620448827744
  ]
}