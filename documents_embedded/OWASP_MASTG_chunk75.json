{
  "text": "thestateofasocket,forexample,ifthesocketisinactiveuse(ESTABLISHED)orclosed(CLOSED). Get Loaded Native Libraries Platform: android Using Process Memory Maps Thefile/proc/<pid>/mapscontainsthecurrentlymappedmemoryregionsandtheiraccesspermissions. Usingthisfile wecangetthelistofthelibrariesloadedintheprocess. ##cat/proc/9568/maps 12c00000-52c00000rw-p0000000000:0414917 /dev/ashmem/dalvik-mainspace (regionspace)(deleted) 6f019000-6f2c0000rw-p00000000fd:001146914 /data/dalvik-cache/arm64/system@framework@boot.art ... 7327670000-7329747000r--p00000000fd:001884627 /data/app/com.google.android.gms-4FJbDh-oZv-5bCw39jkIMQ==/oat/arm64/base.odex .. 733494d000-7334cfb000r-xp00000000fd:001884542 ↪ /data/app/com.google.android.youtube-Rl_hl9LptFQf3Vf-JJReGw==/lib/arm64/libcronet.80.0.3970.3.so ... Using Frida You can retrieve process related information straight from the Frida CLI by using the Process command. Within the ProcesscommandthefunctionenumerateModulesliststhelibrariesloadedintotheprocessmemory. [HuaweiNexus6P::sg.vantagepoint.helloworldjni]->Process.enumerateModules() [ { \"base\":\"0x558a442000\", \"name\": \"app_process64\", \"path\":\"/system/bin/app_process64\", \"size\":32768 }, { \"base\":\"0x78bc984000\", \"name\":\"libandroid_runtime.so\", \"path\":\"/system/lib64/libandroid_runtime.so\", \"size\":2011136 }, ... Accessing the Device Shell Platform: android Oneofthemostcommonthingsyoudowhentestinganappisaccessingthedeviceshell. Inthissectionwe’llseehow toaccesstheAndroidshellbothremotelyfromyourhostcomputerwith/withoutaUSBcableandlocallyfromthedevice itself. Remote Shell InordertoconnecttotheshellofanAndroiddevicefromyourhostcomputer,adbisusuallyyourtoolofchoice(unless youprefertouseremoteSSHaccess,e.g.viaTermux). 166\\nFor this section we assume that you’ve properly enabled Developer Mode and USB debugging as explained in “Testing on a Real Device”. Once you’ve connected your Android device via USB, you can access the remote device’s shell by running: adbshell pressControl+Dortypeexittoquit Onceintheremoteshell,ifyourdeviceisrootedoryou’reusingtheemulator,youcangetrootaccessbyrunningsu: bullhead:/$su bullhead:/ #id uid=0(root)gid=0(root)groups=0(root)context=u:r:su:s0 Onlyifyou’reworkingwithanemulatoryoumayalternativelyrestartadbwithrootpermissionswiththecommand adb root so next time you enter adb shell you’ll have root access already. This also allows to transfer data bidirectionallybetweenyourhostcomputerandtheAndroidfilesystem,evenwithaccesstolocationswhereonly therootuserhasaccessto(viaadbpush/pull). Seemoreaboutdatatransferinsection“Host-DeviceDataTransfer” below. Connect to Multiple Devices If you have more than one device, remember to include the -s flag followed by the device serial ID on all your adb commands(e.g.adb -s emulator-5554 shelloradb -s 00b604081540b7c6 shell). Youcangetalistofallconnected devicesandtheirserialIDsbyusingthefollowingcommand: adbdevices Listofdevicesattached 00c907098530a82c device emulator-5554 device Connect to a Device over Wi-Fi You can also access your Android device without using the USB cable. For this you’ll have to connect both your host computerandyourAndroiddevicetothesameWi-Finetworkandfollowthenextsteps: • ConnectthedevicetothehostcomputerwithaUSBcableandsetthetargetdevicetolistenforaTCP/IPconnection onport5555: adb tcpip 5555. • Disconnect the USB cable from the target device and run adb connect <device_ip_address>. Check that the deviceisnowavailablebyrunningadb devices. • Opentheshellwithadb shell. However,noticethatbydoingthisyouleaveyourdeviceopentoanyonebeinginthesamenetworkandknowingtheIP addressofyourdevice. YoumayratherpreferusingtheUSBconnection. Forexample,onaNexusdevice,youcanfindtheIPaddressatSettings->System->Aboutphone->Status ->IPaddressorbygoingtotheWi-Fimenuandtappingonceonthenetworkyou’reconnectedto. SeethefullinstructionsandconsiderationsintheAndroidDevelopersDocumentation. Connect to a Device via SSH Ifyouprefer,youcanalsoenableSSHaccess. AconvenientoptionistouseTermux,whichyoucaneasilyconfigureto offerSSHaccess(withpasswordorpublickeyauthentication)andstartitwiththecommandsshd(startsbydefaulton port 8022). In order to connect to the Termux via SSH you can simply run the command ssh -p 8022 <ip_address> (whereip_addressistheactualremotedeviceIP).Thisoptionhassomeadditionalbenefitsasitallowstoaccessthefile systemviaSFTPalsoonport8022. 167\\nOn-device Shell App Whileusuallyusinganon-deviceshell(terminalemulator)suchasTermuxmightbeverytediouscomparedtoaremote shell,itcanprovehandyfordebuggingincaseof,forexample,networkissuesortochecksomeconfiguration. Basic Network Monitoring/Sniffing Platform: android Remotely sniffing all Android traffic in real-time is possible with tcpdump, netcat (nc), and Wireshark. First, make sure thatyouhavethelatestversionofAndroidtcpdumponyourphone. Herearetheinstallationsteps: adbroot adbremount adbpush/wherever/you/put/tcpdump/system/xbin/tcpdump Ifexecutionofadbrootreturnstheerroradbdcannotrunasrootinproductionbuilds,installtcpdumpasfollows: adbpush/wherever/you/put/tcpdump/data/local/tmp/tcpdump adbshell su mount -orw,remount/system; cp/data/local/tmp/tcpdump/system/xbin/ cd/system/xbin chmod 755tcpdump Incertainproductionbuilds,youmightencounteranerrormount: '/system' not in /proc/mounts. Inthatcase,youcanreplacetheaboveline$mount-orw,remount/system;with$mount-orw,remount/,asdescribed inthisStackOverflowpost. Remember: Tousetcpdump,youneedrootprivilegesonthephone! Executetcpdumponcetoseeifitworks. Onceafewpacketshavecomein,youcanstoptcpdumpbypressingCTRL+c. $tcpdump tcpdump:verboseoutputsuppressed,use -vor-vvforfullprotocoldecode listeningonwlan0,link-typeEN10MB (Ethernet),capturesize262144bytes 04:54:06.59075100:9e:1e:10:7f:69 (ouiUnknown)>Broadcast,RRCP-0x23reply 04:54:09.65965800:9e:1e:10:7f:69 (ouiUnknown)>Broadcast,RRCP-0x23reply 04:54:10.57979500:9e:1e:10:7f:69 (ouiUnknown)>Broadcast,RRCP-0x23reply ^C 3packetscaptured 3packetsreceivedbyfilter 0packetsdroppedbykernel ToremotelysnifftheAndroidphone’snetworktraffic,firstexecutetcpdumpandpipeitsoutputtonetcat(nc): tcpdump -iwlan0 -s0-w-|nc-l-p11111 Thetcpdumpcommandaboveinvolves • listeningonthewlan0interface, • definingthesize(snapshotlength)ofthecaptureinbytestogeteverything(-s0),and • writingtoafile(-w). Insteadofafilename,wepass-,whichwillmaketcpdumpwritetostdout. Byusingthepipe(|),wesentalloutputfromtcpdumptonetcat,whichopensalisteneronport11111. You’llusuallywant tomonitorthewlan0interface. Ifyouneedanotherinterface,listtheavailableoptionswiththecommand$ ip addr. Toaccessport11111,youneedtoforwardtheporttoyourhostcomputerviaadb. 168\\nadbforwardtcp:11111tcp:11111 ThefollowingcommandconnectsyoutotheforwardedportvianetcatandpipingtoWireshark. nclocalhost11111 |wireshark -k-S-i- Wiresharkshouldstartimmediately(-k). Itgetsalldatafromstdin(-i-)vianetcat,whichisconnectedtotheforwarded port. Youshouldseeallthephone’strafficfromthewlan0interface. Youcandisplaythecapturedtrafficinahuman-readableformatwithWireshark. Figureoutwhichprotocolsareusedand whethertheyareunencrypted. Capturingalltraffic(TCPandUDP)isimportant,soyoushouldexecuteallfunctionsofthe testedapplicationandanalyzeit. Thisneatlittletrickallowsyounowtoidentifywhatkindofprotocolsareusedandtowhichendpointstheappistalkingto. Thequestionsisnow,howcanItesttheendpointsifBurpisnotcapableofshowingthetraffic? Thereisnoeasyanswer forthis,butafewBurppluginsthatcangetyoustarted. Firebase/Google Cloud Messaging (FCM/GCM) FirebaseCloudMessaging(FCM),thesuccessortoGoogleCloudMessaging(GCM),isafreeserviceofferedbyGooglethat allowsyoutosendmessagesbetweenanapplicationserverandclientapps. Theserverandclientappcommunicatevia theFCM/GCMconnectionserver,whichhandlesdownstreamandupstreammessages. 169\\nDownstreammessages(pushnotifications)aresentfromtheapplicationservertotheclientapp;upstreammessagesare sentfromtheclientapptotheserver. FCMisavailableforAndroid,iOS,andChrome. FCMcurrentlyprovidestwoconnectionserverprotocols: HTTPandXMPP.As describedintheofficialdocumentation,theseprotocolsareimplementeddifferently. Thefollowingexampledemonstrates howtointerceptbothprotocols. Preparation of Test Setup Youneedtoeitherconfigureiptablesonyourphoneorusebettercaptobeabletointercepttraffic. FCMcanuseeitherXMPPorHTTPtocommunicatewiththeGooglebackend. HTTP FCMusestheports5228,5229,and5230forHTTPcommunication. Usually,onlyport5228isused. • ConfigurelocalportforwardingfortheportsusedbyFCM.ThefollowingexampleappliestomacOS: $echo \" rdrpassinetprototcpfromanytoanyport5228->127.0.0.1port8080 rdrpassinetprototcpfromanytoanyport5229->127.0.0.1port8080 rdrpassinetprototcpfromanytoanyport5230->127.0.0.1port8080 \"|sudo pfctl -ef- • Theinterceptionproxymustlistentotheportspecifiedintheportforwardingruleabove(port8080). XMPP ForXMPPcommunication,FCMusesports5235(Production)and5236(Testing). • ConfigurelocalportforwardingfortheportsusedbyFCM.ThefollowingexampleappliestomacOS: $echo \" rdrpassinetprototcpfromanytoanyport5235->127.0.0.1port8080 rdrpassinetprototcpfromanytoanyport5236->127.0.0.1port8080 \"|sudo pfctl -ef- Intercepting the Requests Theinterceptionproxymustlistentotheportspecifiedintheportforwardingruleabove(port8080). StarttheappandtriggerafunctionthatusesFCM.YoushouldseeHTTPmessagesinyourinterceptionproxy. 170\\nEnd-to-End Encryption for Push Notifications Asanadditionallayerofsecurity,pushnotificationscanbeencryptedbyusingCapillary. Capillaryisalibrarytosimplify thesendingofend-to-end(E2E)encryptedpushmessagesfromJava-basedapplicationserverstoAndroidclients. Reviewing Disassembled Native Code Platform: android Followingtheexamplefrom“DisassemblingNativeCode”wewillusedifferentdisassemblerstoreviewthedisassembled nativecode. radare2 Onceyou’veopenedyourfileinradare2youshouldfirstgettheaddressofthefunctionyou’relookingfor. Youcandothis bylistingorgettinginformationiaboutthesymbolss(is)andgrepping(~radare2’sbuilt-ingrep)forsomekeyword,in ourcasewe’relookingforJNIrelatedsymbolssoweenter“Java”: $r2 -AHelloWord-JNI/lib/armeabi-v7a/libnative-lib.so ... [0x00000e3c]>is~Java 0030x00000e780x00000e78GLOBAL FUNC 16Java_sg_vantagepoint_helloworldjni_MainActivity_stringFromJNI Themethodcanbefoundataddress0x00000e78. Todisplayitsdisassemblysimplyrunthefollowingcommands: [0x00000e3c]>eemu.str=true; [0x00000e3c]>s0x00000e78 [0x00000e78]>af [0x00000e78]>pdf ╭(fcn)sym.Java_sg_vantagepoint_helloworldjni_MainActivity_stringFromJNI12 │ sym.Java_sg_vantagepoint_helloworldjni_MainActivity_stringFromJNI (int32_targ1); │ ;argint32_targ1@r0 │ 0x00000e78 ~ 0268 ldrr2, [r0] ;arg1 │ ;--aav.0x00000e79: │ ;UNKNOWNXREFfromaav.0x00000189 (+0x3) │ 0x00000e79 unaligned",
  "metadata": {
    "doc_id": "OWASP_MASTG",
    "chunk_id": 75
  },
  "embedding": [
    0.04845936968922615,
    0.04122767969965935,
    -0.013627374544739723,
    -0.12824101746082306,
    0.03563087061047554,
    -0.04722245782613754,
    0.0013376176357269287,
    0.01637643203139305,
    -0.0052787004970014095,
    0.007411741651594639,
    0.05543337017297745,
    -0.004100216086953878,
    0.0015691479202359915,
    -0.036915551871061325,
    0.012954159639775753,
    -0.04066087305545807,
    0.026449425145983696,
    -0.009404415264725685,
    0.01850792206823826,
    0.013846066780388355,
    0.0444861575961113,
    0.047293771058321,
    0.03952763229608536,
    -0.008620471693575382,
    0.0411820262670517,
    0.02665509097278118,
    0.008889521472156048,
    -0.05291116610169411,
    0.0009819676633924246,
    -0.0034690333995968103,
    0.013128683902323246,
    0.05520673468708992,
    -0.016588697209954262,
    -0.03619490563869476,
    0.08646910637617111,
    0.11817437410354614,
    -0.03865232691168785,
    -0.07251853495836258,
    -0.0580817274749279,
    -0.03417711704969406,
    0.005594813264906406,
    0.01164510753005743,
    -0.02220616489648819,
    0.0796583816409111,
    -0.015993064269423485,
    0.06737212836742401,
    0.05788866803050041,
    -0.02458873763680458,
    -0.06545042991638184,
    0.012284914031624794,
    0.022319041192531586,
    0.06514094024896622,
    0.020116321742534637,
    -0.0469248928129673,
    0.019100371748209,
    0.012762034311890602,
    -0.017323320731520653,
    0.03312070667743683,
    -0.005435877945274115,
    0.1017734557390213,
    -0.039171867072582245,
    -0.031334057450294495,
    -0.032222434878349304,
    -0.00725342333316803,
    -0.02050679363310337,
    0.06636512279510498,
    0.08233568072319031,
    -0.06335610896348953,
    0.013155798427760601,
    -0.11129947006702423,
    0.02888290397822857,
    0.02255907841026783,
    0.01161930151283741,
    -0.027936052531003952,
    -0.062467653304338455,
    0.10062772035598755,
    -0.01419197116047144,
    -0.0008046928560361266,
    -0.04001147300004959,
    -0.15946361422538757,
    -0.007652302738279104,
    -0.008642868138849735,
    0.013924823142588139,
    0.018763750791549683,
    -0.0013660145923495293,
    0.052429795265197754,
    0.021071527153253555,
    -0.08151018619537354,
    0.08123420923948288,
    0.06680106371641159,
    0.01643686182796955,
    0.07627753168344498,
    -0.038470495492219925,
    0.012368847616016865,
    0.06297902017831802,
    -0.02743685059249401,
    0.029090803116559982,
    0.03763744980096817,
    -0.06835410743951797,
    0.07682810723781586,
    0.025988100096583366,
    0.03040941059589386,
    -0.02400871179997921,
    -0.020487478002905846,
    -0.0006035178084857762,
    -0.017376279458403587,
    -0.03387623652815819,
    0.019961051642894745,
    -0.09673044085502625,
    -0.004873322322964668,
    0.016243768855929375,
    -0.045208998024463654,
    0.04206061735749245,
    0.04550667479634285,
    0.046781789511442184,
    -0.03801196068525314,
    0.0055855801329016685,
    -0.032281409949064255,
    0.03104725107550621,
    0.06736086308956146,
    -0.0249053742736578,
    -0.0558403879404068,
    -0.024481644853949547,
    -0.028747104108333588,
    -0.11034809798002243,
    -0.02785629779100418,
    -0.058095213025808334,
    1.0195124218135118e-32,
    0.0005345148965716362,
    -0.10427556931972504,
    0.025581983849406242,
    0.05714124068617821,
    -0.03953658789396286,
    -0.021223489195108414,
    -0.037525784224271774,
    0.0031840987503528595,
    -0.011525548994541168,
    -0.03218981623649597,
    -0.015019623562693596,
    0.009688815101981163,
    -0.029014108702540398,
    0.016280710697174072,
    0.05533090606331825,
    0.00680960388854146,
    0.055026959627866745,
    0.05454821512103081,
    -0.02058229222893715,
    -0.025658655911684036,
    -0.031295742839574814,
    0.03805329650640488,
    -0.0961347296833992,
    -0.07563172280788422,
    0.00431831507012248,
    0.10582010447978973,
    -0.025620317086577415,
    -0.006876256316900253,
    0.023116782307624817,
    0.03616562485694885,
    0.0015981434844434261,
    -0.017912840470671654,
    -0.0563049241900444,
    0.021178115159273148,
    0.019412536174058914,
    -0.06395012140274048,
    0.017130956053733826,
    0.0017345015658065677,
    -0.1121441125869751,
    -0.08819355070590973,
    -0.00386532093398273,
    -0.03684879466891289,
    -0.05116834118962288,
    -0.042536571621894836,
    0.01177386287599802,
    -0.09836050122976303,
    -0.0341518372297287,
    0.01750083453953266,
    -6.311191827990115e-05,
    0.03415960073471069,
    0.0721023753285408,
    0.04549230635166168,
    0.012263125739991665,
    -0.1011713445186615,
    -0.06973456591367722,
    -0.03564605489373207,
    -0.07506005465984344,
    0.0065489262342453,
    0.020457979291677475,
    0.10191642493009567,
    0.022357452660799026,
    0.0948457270860672,
    0.05342099815607071,
    -0.013283994048833847,
    0.04518374428153038,
    -0.04375425726175308,
    -0.010852784849703312,
    -0.04741740971803665,
    -0.05777609348297119,
    0.00633987644687295,
    0.014046302996575832,
    -0.08678455650806427,
    0.12869557738304138,
    0.11506109684705734,
    -0.019573219120502472,
    -0.011681205593049526,
    0.015825584530830383,
    -0.02652198262512684,
    -0.17972777783870697,
    -0.05590306222438812,
    0.038047365844249725,
    -0.08742479234933853,
    0.00398955587297678,
    -0.07638237625360489,
    -0.04989303648471832,
    -0.03664935752749443,
    0.03507461026310921,
    -0.04603317752480507,
    -0.03699812665581703,
    0.07143393903970718,
    -0.03810983523726463,
    -0.03093990497291088,
    -0.005373683292418718,
    0.05436399579048157,
    -0.11427191644906998,
    -1.1369463645757722e-32,
    0.028871215879917145,
    -0.0351187139749527,
    -0.008089490234851837,
    -0.07951746135950089,
    -0.02909788489341736,
    -0.024863455444574356,
    0.013882149010896683,
    0.000509133911691606,
    -0.069343201816082,
    0.00214852555654943,
    -0.01817985810339451,
    -0.018736038357019424,
    0.09789494425058365,
    -0.023705078288912773,
    0.01581287570297718,
    0.03609459474682808,
    0.10062053799629211,
    -0.02912212908267975,
    -0.012526480481028557,
    0.06703384220600128,
    0.007169810589402914,
    0.06580433249473572,
    0.05692824721336365,
    0.06929514557123184,
    -0.026752978563308716,
    0.004214887041598558,
    -0.010428915731608868,
    0.05449444055557251,
    -0.07212873548269272,
    -0.0026194422971457243,
    0.03293076530098915,
    -0.01589212380349636,
    -0.055491961538791656,
    0.016416294500231743,
    -0.02737119421362877,
    0.015309462323784828,
    0.030238956212997437,
    -0.034950487315654755,
    -0.02803673781454563,
    -0.03688929229974747,
    0.014278682880103588,
    -0.044742800295352936,
    -0.02850729040801525,
    -0.042180176824331284,
    0.030964022502303123,
    -0.00031911430414766073,
    0.05808861926198006,
    -0.01430666632950306,
    0.008381707593798637,
    -0.07624758780002594,
    0.11759449541568756,
    0.009924975223839283,
    0.04145093634724617,
    0.04674538969993591,
    0.07592934370040894,
    0.10726610571146011,
    0.07135871797800064,
    -0.05143491178750992,
    0.04197077825665474,
    -0.07922767847776413,
    0.10099317133426666,
    -0.1323675811290741,
    -0.07692015916109085,
    -0.013710862025618553,
    0.0759480819106102,
    0.015366166830062866,
    -0.007180770393460989,
    -0.030195292085409164,
    -0.07532143592834473,
    0.05798608064651489,
    -0.008328251540660858,
    0.05955224856734276,
    -0.06775934249162674,
    -0.0016735291574150324,
    -0.0279709380120039,
    0.09710093587636948,
    0.04282648488879204,
    -0.07211048156023026,
    -0.04720713943243027,
    -0.0667029395699501,
    -0.02384943887591362,
    -0.008460656739771366,
    -0.029181914404034615,
    0.012627559714019299,
    0.026859216392040253,
    0.012869389727711678,
    -0.04450695961713791,
    -0.014347170479595661,
    0.002619594568386674,
    -0.025256773456931114,
    -0.055682990700006485,
    0.018416205421090126,
    -0.0806346908211708,
    0.06491866707801819,
    0.002881386550143361,
    -6.648786410323737e-08,
    0.08482613414525986,
    -0.020526889711618423,
    0.017094597220420837,
    0.05995190143585205,
    0.0945897102355957,
    -0.03468576446175575,
    0.006705296691507101,
    0.03547971695661545,
    0.012005599215626717,
    0.0014606623444706202,
    -0.0240031611174345,
    -0.013956647366285324,
    -0.0619022510945797,
    -0.02021077647805214,
    0.10246070474386215,
    -0.04291639104485512,
    -0.05085796117782593,
    0.05334967002272606,
    -0.008375328965485096,
    -0.05181499198079109,
    0.003853656118735671,
    -0.061041075736284256,
    9.628735824662726e-06,
    -0.01279174443334341,
    0.019824989140033722,
    -0.04693305119872093,
    0.16071656346321106,
    0.01412203162908554,
    0.06869563460350037,
    0.009999297559261322,
    -0.03046388179063797,
    -0.05351312458515167,
    0.036810778081417084,
    -0.06974165141582489,
    -0.0023777647875249386,
    0.09564314037561417,
    0.0061159199103713036,
    0.030480630695819855,
    0.04470076411962509,
    0.026485657319426537,
    -0.06629464775323868,
    0.04440237954258919,
    0.05619899928569794,
    0.040384892374277115,
    -0.007377768401056528,
    -0.01831653341650963,
    0.005687303375452757,
    0.07029376924037933,
    0.016140609979629517,
    0.03357965499162674,
    -0.09213029593229294,
    0.027299078181385994,
    -0.08856340497732162,
    0.01654953695833683,
    -0.017764324322342873,
    -0.05325569584965706,
    -0.009840999729931355,
    -0.10295892506837845,
    -0.03816895931959152,
    0.08241315931081772,
    0.020768655464053154,
    0.03926556184887886,
    -0.03327229246497154,
    -0.02935902588069439
  ]
}