{"text": "file system encryption. Because UIDs aren’t recorded during manufacturing,notevenApplecanrestorethefileencryptionkeysforaparticulardevice. Toallowsecuredeletionofsensitivedataonflashmemory,iOSdevicesincludeafeaturecalledEffaceableStorage. This featureprovidesdirectlow-levelaccesstothestoragetechnology,makingitpossibletosecurelyeraseselectedblocks. Secure Boot WhenaniOSdeviceispoweredon,itreadstheinitialinstructionsfromtheread-onlymemoryknownasBootROM,which bootstrapsthesystem. TheBootROMcontainsimmutablecodeandtheAppleRootCA,whichisetchedintothesilicon chipduringthefabricationprocess,therebycreatingtherootoftrust. Next,theBootROMmakessurethattheLLB’s(Low LevelBootloader)signatureiscorrect,andtheLLBchecksthattheiBootbootloader’ssignatureiscorrecttoo. Afterthe signatureisvalidated,theiBootchecksthesignatureofthenextbootstage,whichistheiOSkernel. Ifanyofthesesteps fail,thebootprocesswillterminateimmediatelyandthedevicewillenterrecoverymodeanddisplaytherestorescreen. However, if the Boot ROM fails to load, the device will enter a special low-level recovery mode called Device Firmware Upgrade(DFU).Thisisthelastresortforrestoringthedevicetoitsoriginalstate. Inthismode,thedevicewillshowno signofactivity;i.e.,itsscreenwon’tdisplayanything. 328\\nThis entire process is called the “Secure Boot Chain”. Its purpose is focused on verifying the boot process integrity, ensuringthatthesystemanditscomponentsarewrittenanddistributedbyApple. TheSecureBootchainconsistsofthe kernel,thebootloader,thekernelextension,andthebasebandfirmware. Code Signing ApplehasimplementedanelaborateDRMsystemtomakesurethatonlyApple-approvedcoderunsontheirdevices,that is,codesignedbyApple. Inotherwords,youwon’tbeabletorunanycodeonaniOSdevicethathasn’tbeenjailbroken unlessAppleexplicitlyallowsit. EndusersaresupposedtoinstallappsthroughtheofficialApple’sAppStoreonly. For thisreason(andothers),iOShasbeencomparedtoacrystalprison. A developer profile and an Apple-signed certificate are required to deploy and run an application. Developers need to registerwithApple,jointheAppleDeveloperProgramandpayayearlysubscriptiontogetthefullrangeofdevelopment anddeploymentpossibilities. There’salsoafreedeveloperaccountthatallowsyoutocompileanddeployapps(butnot distributethemintheAppStore)viasideloading. AccordingtotheArchivedAppleDeveloperDocumentationthecodesignatureconsistsofthreeparts: • Aseal. Thisisacollectionofchecksumsorhashesofthevariouspartsofthecode, createdbythecodesigning software. Thesealcanbeusedatverificationtimetodetectalterations. • A digital signature. The code signing software encrypts the seal using the signer’s identity to create a digital signature. Thisguaranteestheseal’sintegrity. • Coderequirements. Thesearetherulesgoverningverificationofthecodesignature. Dependingonthegoals,some areinherenttotheverifier,whileothersarespecifiedbythesignerandsealedwiththerestofthecode. Learnmore: • CodeSigningGuide(ArchivedAppleDeveloperDocumentation) • CodeSigning(AppleDeveloperDocumentation) • DemystifyingiOSCodeSignature Encryption and Data Protection FairPlay Code Encryption is applied to apps downloaded from the App Store. FairPlay was developed as a DRM when purchasing multimedia content. Originally, FairPlay encryption was applied to MPEG and QuickTime streams, but the samebasicconceptscanalsobeappliedtoexecutablefiles. Thebasicideaisasfollows: OnceyouregisteranewApple user account, or Apple ID, a public/private key pair will be created and assigned to your account. The private key is securelystoredonyourdevice. ThismeansthatFairPlay-encryptedcodecanbedecryptedonlyondevicesassociated withyouraccount. ReverseFairPlayencryptionisusuallyobtainedbyrunningtheapponthedevice,thendumpingthe decryptedcodefrommemory(seealso“BasicSecurityTestingoniOS”). 329\\nApplehasbuiltencryptionintothehardwareandfirmwareofitsiOSdevicessincethereleaseoftheiPhone3GS.Every devicehasadedicatedhardware-basedcryptographicenginethatprovidesanimplementationoftheAES256-bitencryp- tionandtheSHA-1hashingalgorithms. Inaddition,there’sauniqueidentifier(UID)builtintoeachdevice’shardwarewith anAES256-bitkeyfusedintotheApplicationProcessor. ThisUIDisuniqueandnotrecordedelsewhere. Atthetimeof writing,neithersoftwarenorfirmwarecandirectlyreadtheUID.Becausethekeyisburnedintothesiliconchip,itcan’t betamperedwithorbypassed. Onlythecryptoenginecanaccessit. Buildingencryptionintothephysicalarchitecturemakesitadefaultsecurityfeaturethatcanencryptalldatastoredonan iOSdevice. Asaresult,dataprotectionisimplementedatthesoftwarelevelandworkswiththehardwareandfirmware encryptiontoprovidemoresecurity. When data protection is enabled, by simply establishing a passcode in the mobile device, each data file is associated with a specific protection class. Each class supports a different level of accessibility and protects data on the basis of when the data needs to be accessed. The encryption and decryption operations associated with each class are based onmultiplekeymechanismsthatutilizethedevice’sUIDandpasscode,aclasskey,afilesystemkey,andaper-filekey. The per-file key is used to encrypt the file’s contents. The class key is wrapped around the per-file key and stored in the file’s metadata. The file system key is used to encrypt the metadata. The UID and passcode protect the class key. This operation is invisible to users. To enable data protection, the passcode must be used when accessing the device. Thepasscodeunlocksthedevice. CombinedwiththeUID,thepasscodealsocreatesiOSencryptionkeysthataremore resistanttohackingandbrute-forceattacks. Enablingdataprotectionisthemainreasonforuserstousepasscodeson theirdevices. Sandbox TheappsandboxisaniOSaccesscontroltechnology. Itisenforcedatthekernellevel. Itspurposeislimitingsystemand userdatadamagethatmayoccurwhenanappiscompromised. SandboxinghasbeenacoresecurityfeaturesincethefirstreleaseofiOS.Allthird-partyappsrununderthesameuser (mobile),andonlyafewsystemapplicationsandservicesrunasroot(orotherspecificsystemusers). RegulariOSapps areconfinedtoacontainerthatrestrictsaccesstotheapp’sownfilesandaverylimitednumberofsystemAPIs. Accessto allresources(suchasfiles,networksockets,IPCs,andsharedmemory)arecontrolledbythesandbox. Theserestrictions workasfollows[#levin]: • The app process is restricted to its own directory (under /var/mobile/Containers/ Bundle/Application/ or /var/containers/Bundle/Application/,dependingontheiOSversion)viaachroot-likeprocess. • Themmapandmmprotectsystemcallsaremodifiedtopreventappsfrommakingwritablememorypagesexecutable andstoppingprocessesfromexecutingdynamicallygeneratedcode. IncombinationwithcodesigningandFairPlay, this strictly limits what code can run under specific circumstances (e.g., all code in apps distributed via the App StoreisapprovedbyApple). • Processesareisolatedfromeachother,eveniftheyareownedbythesameUIDattheoperatingsystemlevel. • Hardwaredriverscan’tbeaccesseddirectly. Instead,theymustbeaccessedthroughApple’spublicframeworks. General Exploit Mitigations iOS implements address space layout randomization (ASLR) and eXecute Never (XN) bit to mitigate code execution at- tacks. ASLRrandomizesthememorylocationoftheprogram’sexecutablefile, data, heap, andstackeverytimetheprogram isexecuted. Becausethesharedlibrariesmustbestatictobeaccessedbymultipleprocesses,theaddressesofshared libraries are randomized every time the OS boots instead of every time the program is invoked. This makes specific function and library memory addresses hard to predict, thereby preventing attacks such as the return-to-libc attack, whichinvolvesthememoryaddressesofbasiclibcfunctions. TheXNmechanismallowsiOStomarkselectedmemorysegmentsofaprocessasnon-executable. OniOS,theprocess stackandheapofuser-modeprocessesismarkednon-executable. Pagesthatarewritablecannotbemarkedexecutable atthesametime. Thispreventsattackerstoexecutemachinecodeinjectedintothestackorheap. 330\\nSoftware Development on iOS Like other platforms, Apple provides a Software Development Kit (SDK) that helps developers to develop, install, run, andtestnativeiOSApps. XcodeisanIntegratedDevelopmentEnvironment(IDE)forApplesoftwaredevelopment. iOS applicationsaredevelopedinObjective-CorSwift. Objective-C is an", "metadata": {"doc_id": "OWASP_MASTG", "chunk_id": 120}}