{"text": "Inspecttheappentitlementsandcheckthevalueofget-task-allowkey. Ifitissettotrue,theappisdebuggable. Usingcodesign: $codesign -d--entitlements -iGoat-Swift.app Executable=/Users/owasp/iGoat-Swift/Payload/iGoat-Swift.app/iGoat-Swift [Dict] [Key]application-identifier [Value] [String]TNAJ496RHB.OWASP.iGoat-Swift [Key]com.apple.developer.team-identifier [Value] [String]TNAJ496RHB [Key]get-task-allow [Value] [Bool]true [Key]keychain-access-groups [Value] [Array] [String]TNAJ496RHB.OWASP.iGoat-Swift Usingldid: $ldid-eiGoat-Swift.app/iGoat-Swift <?xml version=\"1.0\" encoding=\"UTF-8\"?> <!DOCTYPE plist PUBLIC\"-//Apple//DTDPLIST1.0//EN\"\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"> <plist version=\"1.0\"> <dict> <key>application-identifier</key> <string>TNAJ496RHB.OWASP.iGoat-Swift</string> <key>com.apple.developer.team-identifier</key> <string>TNAJ496RHB</string> <key>get-task-allow</key> <true/> <key>keychain-access-groups</key> <array> <string>TNAJ496RHB.OWASP.iGoat-Swift</string> </array> </dict> </plist> Dynamic Analysis Checkwhetheryoucanattachadebuggerdirectly, usingXcode. Next, checkifyoucandebugtheapponajailbroken deviceafterClutchingit. Thisisdoneusingthedebug-serverwhichcomesfromtheBigBossrepositoryatCydia. Note: if the application is equipped with anti-reverse engineering controls, then the debugger can be detected and stopped. 519\\nTesting Obfuscation Platform: ios MASVSV1: MSTG-RESILIENCE-9 MASVSV2: MASVS-RESILIENCE-3 Overview Attempt to disassemble the Mach-O in the IPA and any included library files in the “Frameworks” directory (.dylib or .frameworkfiles),andperformstaticanalysis. Attheveryleast,theapp’scorefunctionality(i.e.,thefunctionalitymeant tobeobfuscated)shouldn’tbeeasilydiscerned. Verifythat: • meaningfulidentifiers,suchasclassnames,methodnames,andvariablenames,havebeendiscarded. • stringresourcesandstringsinbinariesareencrypted. • codeanddatarelatedtotheprotectedfunctionalityisencrypted,packed,orotherwiseconcealed. Foramoredetailedassessment,youneedadetailedunderstandingoftherelevantthreatsandtheobfuscationmethods used. Testing Reverse Engineering Tools Detection Platform: ios MASVSV1: MSTG-RESILIENCE-4 MASVSV2: MASVS-RESILIENCE-4 Overview Launchtheappwithvariousreverseengineeringtoolsandframeworksinstalledonyourtestdevice,suchasFrida,Cydia Substrate,CycriptorSSLKillSwitch. Theappshouldrespondinsomewaytothepresenceofthosetools. Forexampleby: • Alertingtheuserandaskingforacceptingliability. • Preventingexecutionbygracefullyterminating. • Securelywipinganysensitivedatastoredonthedevice. • Reportingtoabackendserver,e.g,forfrauddetection. Next,workonbypassingthedetectionofthereverseengineeringtoolsandanswerthefollowingquestions: • Canthemechanismsbebypassedtrivially(e.g.,byhookingasingleAPIfunction)? • Howdifficultisidentifyingthedetectioncodeviastaticanddynamicanalysis? • Didyouneedtowritecustomcodetodisablethedefenses? Howmuchtimedidyouneed? • Whatisyourassessmentofthedifficultyofbypassingthemechanisms? Testing for Debugging Symbols Platform: ios MASVSV1: MSTG-CODE-3 MASVSV2: MASVS-RESILIENCE-3 520\\nOverview Static Analysis To verify the existence of debug symbols you can use objdump from binutils or llvm-objdump to inspect all of the app binaries. InthefollowingsnippetwerunobjdumpoverTargetApp(theiOSmainappexecutable)toshowthetypicaloutputofa binarycontainingdebugsymbolswhicharemarkedwiththed(debug)flag. Checktheobjdumpmanpageforinformation aboutvariousothersymbolflagcharacters. $objdump --syms TargetApp 0000000100007dc8l d *UND*-[ViewController handleSubmitButton:] 000000010000809cl d *UND*-[ViewController touchesBegan:withEvent:] 0000000100008158l d *UND*-[ViewController viewDidLoad] ... 000000010000916cl d *UND*_disable_gdb 00000001000091d8l d *UND*_detect_injected_dylds 00000001000092a4l d *UND*_isDebugged ... Topreventtheinclusionofdebugsymbols,setStrip Debug Symbols During CopytoYESviatheXCodeproject’sbuild settings. Strippingdebuggingsymbolswillnotonlyreducethesizeofthebinarybutalsoincreasethedifficultyofreverse engineering. Dynamic Analysis Dynamicanalysisisnotapplicableforfindingdebuggingsymbols. Testing Emulator Detection Platform: ios MASVSV1: MSTG-RESILIENCE-5 MASVSV2: MASVS-RESILIENCE-1 Overview Inordertotestforemulatordetectionyoucantrytoruntheappondifferentemulatorsasindicatedinsection“Emulator Detection”andseewhathappens. Theappshouldrespondinsomeway. Forexampleby: • Alertingtheuserandaskingforacceptingliability. • Preventingexecutionbygracefullyterminating. • Reportingtoabackendserver,e.g,forfrauddetection. Youcanalsoreverseengineertheappusingideasforstringsandmethodsfromsection“EmulatorDetection”. Next,workonbypassingthisdetectionandanswerthefollowingquestions: • Canthemechanismsbebypassedtrivially(e.g.,byhookingasingleAPIfunction)? • Howdifficultisidentifyingthedetectioncodeviastaticanddynamicanalysis? • Didyouneedtowritecustomcodetodisablethedefenses? Howmuchtimedidyouneed? • Whatisyourassessmentofthedifficultyofbypassingthemechanisms? Testing File Integrity Checks 521\\nPlatform: ios MASVSV1: MSTG-RESILIENCE-3,MSTG-RESILIENCE-11 MASVSV2: MASVS-RESILIENCE-2 Overview ApplicationSourceCodeIntegrityChecks: Run the app on the device in an unmodified state and make sure that everything works. Then apply patches to the executableusingoptool,re-signtheappasdescribedinthechapter“iOSTamperingandReverseEngineering”,andrun it. Theappshouldrespondinsomeway. Forexampleby: • Alertingtheuserandaskingforacceptingliability. • Preventingexecutionbygracefullyterminating. • Securelywipinganysensitivedatastoredonthedevice. • Reportingtoabackendserver,e.g,forfrauddetection. Workonbypassingthedefensesandanswerthefollowingquestions: • Canthemechanismsbebypassedtrivially(e.g.,byhookingasingleAPIfunction)? • Howdifficultisidentifyingthedetectioncodeviastaticanddynamicanalysis? • Didyouneedtowritecustomcodetodisablethedefenses? Howmuchtimedidyouneed? • Whatisyourassessmentofthedifficultyofbypassingthemechanisms? FileStorageIntegrityChecks: Gototheappdatadirectoriesasindicatedinsection“AccessingAppDataDirectories”andmodifysomefiles. Next,workonbypassingthedefensesandanswerthefollowingquestions: • Canthemechanismsbebypassedtrivially(e.g.,bychangingthecontentsofafileorakey-valuepair)? • HowdifficultisobtainingtheHMACkeyortheasymmetricprivatekey? • Didyouneedtowritecustomcodetodisablethedefenses? Howmuchtimedidyouneed? • Whatisyourassessmentofthedifficultyofbypassingthemechanisms? Making Sure that the App Is Properly Signed Platform: ios MASVSV1: MSTG-CODE-1 MASVSV2: MASVS-RESILIENCE-2 Overview Static Analysis Youhavetoensurethattheappisusingthelatestcodesignatureformat. Youcanretrievethesigningcertificateinfor- mationfromtheapplication’s.appfilewithcodesign. Codesignisusedtocreate,check,anddisplaycodesignatures,as wellasinquireintothedynamicstatusofsignedcodeinthesystem. Afteryougettheapplication’sIPAfile,re-saveitasaZIPfileanddecompresstheZIPfile. NavigatetothePayloaddirectory, wheretheapplication’s.appfilewillbe. Executethefollowingcodesigncommandtodisplaythesigninginformation: 522\\n$codesign -dvvv YOURAPP.app Executable=/Users/Documents/YOURAPP/Payload/YOURAPP.app/YOURNAME Identifier=com.example.example Format=appbundlewithMach-Ouniversal (armv7arm64) CodeDirectoryv=20200size=154808flags=0x0(none)hashes=4830+5 location=embedded Hashtype=sha256size=32 CandidateCDHashsha1=455758418a5f6a878bb8fdb709ccfca52c0b5b9e CandidateCDHashsha256=fd44efd7d03fb03563b90037f92b6ffff3270c46 Hashchoices=sha1,sha256 CDHash=fd44efd7d03fb03563b90037f92b6ffff3270c46 Signaturesize=4678 Authority=iPhoneDistribution:ExampleLtd Authority=AppleWorldwideDeveloperRelationsCertificationAuthority Authority=AppleRootCA SignedTime=4Aug2017,12:42:52 Info.plistentries=66 TeamIdentifier=8LAMR92KJ8 SealedResourcesversion=2rules=12files=1410 Internalrequirementscount=1size=176 TherearevariouswaystodistributeyourappasdescribedattheAppledocumentation,whichincludeusingtheAppStore orviaAppleBusinessManagerforcustomorin-housedistribution. Incaseofanin-housedistributionscheme,makesure thatnoadhoccertificatesareusedwhentheappissignedfordistribution. 523\\nTesting Tools The OWASP MASTG includes many tools to assist you in executing test cases, allowing you to perform static analysis, dynamic analysis, dynamic instrumentation, etc. These tools are meant to help you conduct your own assessments, rather than provide a conclusive result on an application’s security status. It’s essential to carefully review the tools’ output,asitcancontainbothfalsepositivesandfalsenegatives. The goal of the MASTG is to be as accessible as possible. For this reason, we prioritize including tools that meet the followingcriteria: • Open-source • Freetouse • CapableofanalyzingrecentAndroid/iOSapplications • Regularlyupdated • Strongcommunitysupport Ininstanceswherenosuitableopen-sourcealternativeexists,wemayincludeclosed-sourcetools. However,anyclosed- sourcetoolsincludedmustbefreetouse,asweaimtoavoidfeaturingpaidtoolswheneverpossible. Thisalsoextends tofreewareorcommunityeditionsofcommercialtools. Ourgoalistobevendor-neutralandtoserveasatrustedlearningresource,sothespecificcategoryof“automatedmobile applicationsecurityscanners”presentsauniquechallenge. Forthisreason,wehavehistoricallyavoidedincludingsuch toolsduetothecompetitivedisadvantagestheycancreateamongvendors. Incontrast, weprioritizetoolslikeMobSF thatprovidefullaccesstotheircodeandacomprehensivesetoftests,makingthemexcellentforeducationalpurposes. Toolsthatlackthisleveloftransparency,eveniftheyofferafreeversion,generallydonotmeettheinclusioncriteriaof theOWASPMASproject. Disclaimer: Each tool included in the MASTG examples was verified to be functional at the time it was added. However,thetoolsmaynotworkproperlydependingontheOSversionofbothyourhostcomputerandyourtest device. Thefunctionalityofthetoolscanalsobeaffectedbywhetheryou’reusingarootedorjailbrokendevice,the specific version of the", "metadata": {"doc_id": "OWASP_MASTG", "chunk_id": 167}}