{"text": "derive the input parameters of its open function and auto- maticallylogthemcorrectly. Butthiswon’tbethecaseforotherlibrariesorforAndroidKotlin/Javacode. Inthat case,youmaywanttoobtainthesignaturesofthefunctionsyou’reinterestedinbyreferringtoAndroidDevelopers 182\\ndocumentationorbyreverseengineertheappfirst. Anotherthingtonoticeintheoutputaboveisthatit’scolorized. Anapplicationcanhavemultiplethreadsrunning,and each thread can call the open function independently. By using such a color scheme, the output can be easily visually segregatedforeachthread. frida-traceisaveryversatiletoolandtherearemultipleconfigurationoptionsavailablesuchas: • Including-Iandexcluding-Xentiremodules. • TracingallJNIfunctionsinanAndroidapplicationusing-i \"Java_*\"(notetheuseofaglob*tomatchallpossible functionsstartingwith“Java_”). • Tracingfunctionsbyaddresswhennofunctionnamesymbolsareavailable(strippedbinaries),e.g.-a \"libjpeg. so!0x4793c\". frida-trace -U-i\"Java_*\" com.android.chrome Manybinariesarestrippedanddon’thavefunctionnamesymbolsavailablewiththem. Insuchcases,afunctioncanbe tracedusingitsaddressaswell. frida-trace -p1372 -a\"libjpeg.so!0x4793c\" Frida12.10introducesanewusefulsyntaxtoqueryJavaclassesandmethodsaswellasJavamethodtracingsupportfor frida-tracevia-j(startingonfrida-tools8.0). • In Frida scripts: e.g. Java.enumerateMethods('*youtube*!on*') uses globs to take all classes that include “youtube”aspartoftheirnameandenumerateallmethodsstartingwith“on”. • Infrida-trace: e.g.-j '*!*certificate*/isu'triggersacase-insensitivequery(i),includingmethodsignatures (s)andexcludingsystemclasses(u). RefertotheReleaseNotesforFrida12.10formoredetailsonthisnewfeature. Tolearnmoreaboutalloptionsforadvanced usage,checkthedocumentationontheofficialFridawebsite. Information Gathering - Network Communication Platform: android Most of the apps you might encounter connect to remote endpoints. Even before you perform any dynamic analysis (e.g.trafficcaptureandanalysis),youcanobtainsomeinitialinputsorentrypointsbyenumeratingthedomainstowhich theapplicationissupposedtocommunicateto. Typicallythesedomainswillbepresentasstringswithinthebinaryoftheapplication. Onewaytoachievethisisbyusing automatedtoolssuchasAPKEnumorMobSF.Alternatively,youcangrepforthedomainnamesbyusingregularexpres- sions. Forthisyoucantargettheappbinarydirectlyorreverseengineeritandtargetthedisassembledordecompiled code. Thelatteroptionhasaclearadvantage: itcanprovideyouwithcontext,asyou’llbeabletoseeinwhichcontext eachdomainisbeingused(e.g.classandmethod). From here on you can use this information to derive more insights which might be of use later during your analysis, e.g.youcouldmatchthedomainstothepinnedcertificatesortheNetworkSecurityConfigurationfileorperformfurther reconnaissance on domain names to know more about the target environment. When evaluating an application it is importanttochecktheNetworkSecurityConfigurationfile,asoften(lesssecure)debugconfigurationsmightbepushed intofinalreleasebuildsbymistake. Theimplementationandverificationofsecureconnectionscanbeanintricateprocessandtherearenumerousaspects to consider. For instance, many applications use other protocols apart from HTTP such as XMPP or plain TCP packets, or perform certificate pinning in an attempt to deter MITM attacks but unfortunately have severe logical bugs in its implementationoraninherentlywrongsecuritynetworkconfiguration. Rememberthatinmostofthecases,justusingstaticanalysiswillnotbeenoughandmighteventurntobeextremely inefficient when compared to the dynamic alternatives which will get much more reliable results (e.g. using an inter- ceptor proxy). In this section we’ve just slightly touched the surface, please refer to the section “Basic Network Mon- itoring/Sniffing” in the “Android Basic Security Testing” chapter and also check the test cases in the “Android Network Communication”chapter. 183\\nSandbox Inspection Platform: android Theapplicationdataisstoredinasandboxeddirectorypresentat/data/data/<app_package_name>. Thecontentofthis directoryhasalreadybeendiscussedindetailinthe“AccessingAppDataDirectories”section. Automated Static Analysis Platform: android Youshouldusetoolsforefficientstaticanalysis. Theyallowthetestertofocusonthemorecomplicatedbusinesslogic. A plethoraofstaticcodeanalyzersareavailable,rangingfromopensourcescannerstofull-blownenterprise-readyscanners. Thebesttoolforthejobdependsonbudget,clientrequirements,andthetester’spreferences. Somestaticanalyzersrelyontheavailabilityofthesourcecode; otherstakethecompiledAPKasinput. Keepinmind thatstaticanalyzersmaynotbeabletofindallproblemsbythemselveseventhoughtheycanhelpusfocusonpotential problems. Revieweachfindingcarefullyandtrytounderstandwhattheappisdoingtoimproveyourchancesoffinding vulnerabilities. Configurethestaticanalyzerproperlytoreducethelikelihoodoffalsepositivesandmaybeonlyselectseveralvulnerability categoriesinthescan. Theresultsgeneratedbystaticanalyzerscanotherwisebeoverwhelming,andyoureffortscan becounterproductiveifyoumustmanuallyinvestigatealargereport. ThereareseveralopensourcetoolsforautomatedsecurityanalysisofanAPK. • Androbugs • JAADAS(archived) • MobSF • QARK Listing Installed Apps Platform: android When targeting apps that are installed on the device, you’ll first have to figure out the correct package name of the applicationyouwanttoanalyze. Youcanretrievetheinstalledappseitherbyusingpm(AndroidPackageManager)orby usingfrida-ps: $adbshellpmlistpackages package:sg.vantagepoint.helloworldjni package:eu.chainfire.supersu package:org.teamsik.apps.hackingchallenge.easy package:org.teamsik.apps.hackingchallenge.hard package:sg.vp.owasp_mobile.omtg_android Youcanincludeflagstoshowonlythirdpartyapps(-3)andthelocationoftheirAPKfile(-f),whichyoucanuseafterwards todownloaditviaadb pull: $adbshellpmlistpackages -3-f package:/data/app/sg.vantagepoint.helloworldjni-1/base.apk=sg.vantagepoint.helloworldjni package:/data/app/eu.chainfire.supersu-1/base.apk=eu.chainfire.supersu package:/data/app/org.teamsik.apps.hackingchallenge.easy-1/base.apk=org.teamsik.apps.hackingchallenge.easy package:/data/app/org.teamsik.apps.hackingchallenge.hard-1/base.apk=org.teamsik.apps.hackingchallenge.hard package:/data/app/sg.vp.owasp_mobile.omtg_android-kR0ovWl9eoU_yh0jPJ9caQ==/base.apk=sg.vp.owasp_mobile.omtg_android Thisisthesameasrunningadb shell pm path <app_package_id>onanapppackageID: $adbshellpmpathsg.vp.owasp_mobile.omtg_android package:/data/app/sg.vp.owasp_mobile.omtg_android-kR0ovWl9eoU_yh0jPJ9caQ==/base.apk 184\\nUsefrida-ps -Uaitogetallapps(-a)currentlyinstalled(-i)ontheconnectedUSBdevice(-U): $frida-ps -Uai PID Name Identifier ----- ---------------------------------------- --------------------------------------- 766 AndroidSystem android 21228 Attackmeifucan sg.vp.owasp_mobile.omtg_android 4281 Termux com.termux - Uncrackable1 sg.vantagepoint.uncrackable1 NotethatthisalsoshowsthePIDoftheappsthatarerunningatthemoment. Takeanoteofthe“Identifier”andthePID ifanyasyou’llneedthemafterwards. Dynamic Analysis on Android Platform: android TBD Taint Analysis Platform: android Taint analysis is an information flow analysis technique that tracks the flow of sensitive information within a program. Forexample, itcandeterminewhethergeolocationdatacollectedinanAndroidappisbeingtransmittedtothird-party domains. Intaintanalysis,dataflowsfroma“source”toa“sink”. Asourceiswheresensitiveinformationoriginates,andasinkis wherethisinformationisultimatelyutilized. Forinstance,wecandetermineifthedeviceIDretrievedbyagetDeviceId() functionistransmittedasatextmessageviaanotherfunctionsendTextMessage(). Inthisscenario,getDeviceId()is thesource,andsendTextMessage()isthesink. Ifadirectpathexistsbetweenthem,it’scalledaleak. Inlargeapplications,manualinformationflowanalysiscanbeverytimeconsumingandinaccurate. Taintanalysisauto- mates this, with two main methods: static and dynamic. The former examines code without running it, offering broad coveragebutpotentiallyyieldingfalsepositives. Incontrast,dynamicanalysisobservesreal-timeapplicationexecution, providingactualcontextbutpossiblyoverlookinguntriggeredissues. Athoroughcomparisonofthesetechniquesisbe- yondthissection’sscope. Therearemultipletoolswhichperformtaintanalysisonnativecode,includingTritonandbincat. However,inthissection, we’ll primarily focus on Android Java code and utilize FlowDroid for the taint analysis. Another notable tool supporting taintanalysisforAndroidappsisGDA. Forourdemonstration,we’lluseFlowDroid’scommandlinetooltoperformtaintanalysisontheInsecureShopv1.0appli- cation. TheInsecureShopappacceptsausernameandpasswordasinputandstoresthemintheapp’ssharedpreferences. In ourtaintanalysis, we’reinterestedinhowthisstoredusernameandpasswordareused. Inthiscontext, theusername andpasswordarethesensitiveinformation,andreadingfromsharedpreferencesisthesource. Thesinkinthisanalysis couldbevariousoperations,suchassendinginfooverthenetwork,transmittinginfoviaanIntent,orstoringinfoinan externalfile. TouseFlowDroid,firstly,weneedtoprovideaninputlistofpotentialsourcesandsinkstoevaluatefor. Inourcase,reading fromsharedpreferenceswillbethesource,whileaddingparameterstoanIntentwillbethesink. Theconfigurationfile willlookasfollows(we’llnameit“source_sink.txt”): <android.content.SharedPreferences:java.lang.StringgetString(java.lang.String,java.lang.String)>->_SOURCE_ <android.content.Intent:android.content.IntentputExtra(java.lang.String,java.lang.CharSequence)>->_SINK_ <android.content.Intent:android.content.IntentputExtra(java.lang.String,char)>->_SINK_ <android.content.Intent:android.content.IntentputExtra(java.lang.String,java.lang.String)>->_SINK_ ToinvokeFlowDroidviathecommandline,usethefollowingcommand: 185\\njava-jarsoot-infoflow-cmd/target/soot-infoflow-cmd-jar-with-dependencies.jar\\ -aInsecureShop.apk\\ -pAndroid/Sdk/platforms\\ -ssource_sink.txt [main]INFOsoot.jimple.infoflow.android.SetupApplication$InPlaceInfoflow-Thesinkvirtualinvoker2.<android.content.Intent:android.content.Intent ↪ putExtra(java.lang.String,java.lang.String)>(\"password\",$r5)inmethod<com.insecureshop.AboutUsActivity:voidonSendData(android.view.View)>wascalled ↪ withvaluesfromthefollowingsources: [main]INFOsoot.jimple.infoflow.android.SetupApplication$InPlaceInfoflow--$r1=interfaceinvoke$r2.<android.content.SharedPreferences:java.lang.String ↪ getString(java.lang.String,java.lang.String)>(\"password\",\"\")inmethod<com.insecureshop.util.Prefs:java.lang.StringgetPassword()> ... [main]INFOsoot.jimple.infoflow.android.SetupApplication$InPlaceInfoflow-Thesinkvirtualinvoker2.<android.content.Intent:android.content.Intent ↪ putExtra(java.lang.String,java.lang.String)>(\"username\",$r4)inmethod<com.insecureshop.AboutUsActivity:voidonSendData(android.view.View)>wascalled ↪ withvaluesfromthefollowingsources: [main]INFOsoot.jimple.infoflow.android.SetupApplication$InPlaceInfoflow--$r1=interfaceinvoke$r2.<android.content.SharedPreferences:java.lang.String ↪ getString(java.lang.String,java.lang.String)>(\"username\",\"\")inmethod<com.insecureshop.util.Prefs:java.lang.StringgetUsername()>", "metadata": {"doc_id": "OWASP_MASTG", "chunk_id": 79}}