{"text": "tothedeviceaswell? • Rooting/Jailbreaking: whenrootorjailbreakdetectionisimplemented, does the app inform the user of the fact that certain high-risk actions will carry additional risk due to the jailbro- ken/rootedstatusofthedevice? 87\\n• Specificcredentials: whenausergetsarecoverycode,apasswordorapinfromtheapplication(orsetsone), doestheappinstructtheusertoneversharethiswithanyoneelseandthatonlytheappwillrequestit? • Applicationdistribution: incaseofahigh-riskapplicationandinordertopreventusersfromdownloadingcom- promisedversionsoftheapplication, doestheappmanufacturerproperlycommunicatetheofficialwayofdistributingtheapp(e.g.fromGooglePlayor theAppStore)? • ProminentDisclosure: inanycase, doestheappdisplayprominentdisclosureofdataaccess,collection,use,andsharing? e.g.doestheappusethe AppTrackingTransparencyFrameworktoaskforthepermissiononiOS? Somereferencesinclude: • Open-SourceLicensesandAndroid-https://www.bignerdranch.com/blog/open-source-licenses-and-android/ • SoftwareLicensesinPlainEnglish-https://tldrlegal.com/ • AppleAccessingprivatedata-https://developer.apple.com/design/human-interface-guidelines/privacy • AndroidApppermissionsbestpractices-https://developer.android.com/training/permissions/requesting.html#exp lain 88\\nAndroid Platform Overview This chapter introduces the Android platform from an architecture point of view. The following five key areas are dis- cussed: 1. Androidarchitecture 2. Androidsecurity: defense-in-depthapproach 3. Androidapplicationstructure 4. Androidapplicationpublishing 5. Androidapplicationattacksurface VisittheofficialAndroiddeveloperdocumentationwebsiteformoredetailsabouttheAndroidplatform. Android Architecture AndroidisaLinux-basedopensourceplatformdevelopedbytheOpenHandsetAlliance(aconsortiumleadbyGoogle), which serves as a mobile operating system (OS). Today the platform is the foundation for a wide variety of modern technology, such as mobile phones, tablets, wearable tech, TVs, and other smart devices. Typical Android builds ship witharangeofpre-installed(“stock”)appsandsupportinstallationofthird-partyappsthroughtheGooglePlaystoreand othermarketplaces. Android’s software stack is composed of several different layers. Each layer defines interfaces and offers specific ser- vices. 89\\nKernel: At the lowest level, Android is based on a variation of the Linux Kernel containing some significant additions, including Low Memory Killer, wake locks, the Binder IPC driver, etc. For the purpose of the MASTG, we’ll focus on the user-modepartoftheOS,whereAndroidsignificantlydiffersfromatypicalLinuxdistribution. Thetwomostimportant componentsforusarethemanagedruntimeusedbyapplications(ART/Dalvik)andBionic,Android’sversionofglibc,the GNUClibrary. HAL:Ontopofthekernel,theHardwareAbstractionLayer(HAL)definesastandardinterfaceforinteractingwithbuilt-in hardwarecomponents. SeveralHALimplementationsarepackagedintosharedlibrarymodulesthattheAndroidsystem calls when required. This is the basis for allowing applications to interact with the device’s hardware. For example, it allowsastockphoneapplicationtouseadevice’smicrophoneandspeaker. Runtime Environment: Android apps are written in Java and Kotlin and then compiled to Dalvik bytecode which can bethenexecutedusingaruntimethatinterpretsthebytecodeinstructionsandexecutesthemonthetargetdevice. For Android, thisistheAndroidRuntime(ART).ThisissimilartotheJVM(JavaVirtualMachine)forJavaapplications, orthe MonoRuntimefor.NETapplications. DalvikbytecodeisanoptimizedversionofJavabytecode. ItiscreatedbyfirstcompilingtheJavaorKotlincodetoJava bytecode,usingthejavacandkotlinccompilersrespectively,producing.classfiles. Finally,theJavabytecodeisconverted toDalvikbytecodeusingthed8tool. DalvikbytecodeispackedwithinAPKandAABfilesintheformof.dexfilesandis usedbyamanagedruntimeonAndroidtoexecuteitonthedevice. 90\\nBeforeAndroid5.0(APIlevel21),AndroidexecutedbytecodeontheDalvikVirtualMachine(DVM),whereitwastranslated intomachinecodeatexecutiontime,aprocessknownasjust-in-time(JIT)compilation. Thisenablestheruntimetobenefit fromthespeedofcompiledcodewhilemaintainingtheflexibilityofcodeinterpretation. SinceAndroid5.0(APIlevel21),AndroidexecutesbytecodeontheAndroidRuntime(ART)whichisthesuccessorofthe DVM.ARTprovidesimprovedperformanceaswellascontextinformationinappnativecrashreports,byincludingboth Javaandnativestackinformation. ItusesthesameDalvikbytecodeinputtomaintainbackwardcompatibility. However, ART executes the Dalvik bytecode differently, using a hybrid combination of ahead-of-time (AOT), just-in-time (JIT) and profile-guidedcompilation. • AOTpre-compilesDalvikbytecodeintonativecode,andthegeneratedcodewillbesavedondiskwiththe.oatexten- sion(ELFbinary). Thedex2oattoolcanbeusedtoperformthecompilationandcanbefoundat/system/bin/dex2oat onAndroiddevices. AOTcompilationisexecutedduringtheinstallationoftheapp. Thismakestheapplicationstart faster,asnocompilationisneededanymore. However,thisalsomeansthattheinstalltimeincreasesascompared toJITcompilation. Additionally,sinceapplicationsarealwaysoptimizedagainstthecurrentversionoftheOS,this meansthatsoftwareupdateswillrecompileallpreviouslycompiledapplications,resultinginasignificantincrease in the system update time. Finally, AOT compilation will compile the entire application, even if certain parts are neverusedbytheuser. • JIThappensatruntime. • Profile-guided compilationisahybridapproachthatwasintroducedinAndroid7(APIlevel24)tocombatthe downsidesofAOT.Atfirst, theapplicationwilluseJITcompilation, andAndroidkeepstrackofallthepartsofthe applicationthatarefrequentlyused. Thisinformationisstoredinanapplicationprofileandwhenthedeviceisidle, acompilation(dex2oat)daemonrunswhichAOTcompilestheidentifiedfrequentcodepathsfromtheprofile. 91\\nSource: https://lief-project.github.io/doc/latest/tutorials/10_android_formats.html Sandboxing: Androidappsdon’thavedirectaccesstohardwareresources,andeachapprunsinitsownvirtualmachine orsandbox. ThisenablestheOStohaveprecisecontroloverresourcesandmemoryaccessonthedevice. Forinstance, acrashingappdoesn’taffectotherappsrunningonthesamedevice. Androidcontrolsthemaximumnumberofsystem resources allocated to apps, preventing any one app from monopolizing too many resources. At the same time, this sandboxdesigncanbeconsideredasoneofthemanyprinciplesinAndroid’sglobaldefense-in-depthstrategy. Amalicious third-partyapplication,withlowprivileges,shouldn’tbeabletoescapeitsownruntimeandreadthememoryofavictim applicationonthesamedevice. InthefollowingsectionwetakeacloserlookatthedifferentdefenselayersintheAndroid operatingsystem. Learnmoreinthesection“SoftwareIsolation”. YoucanfindmoredetailedinformationintheGoogleSourcearticle“AndroidRuntime(ART)”,thebook“AndroidInternals” byJonathanLevinandtheblogpost“Android101”by@_qaz_qaz. Android Security: Defense-in-Depth Approach TheAndroidarchitectureimplementsdifferentsecuritylayersthat, together, enableadefense-in-depthapproach. This meansthattheconfidentiality,integrityoravailabilityofsensitiveuser-dataorapplicationsdoesn’thingeononesingle security measure. This section brings an overview of the different layers of defense that the Android system provides. Thesecuritystrategycanberoughlycategorizedintofourdistinctdomains,eachfocusingonprotectingagainstcertain attackmodels. • System-widesecurity • Softwareisolation • Networksecurity • Anti-exploitation System-wide security Device encryption AndroidsupportsdeviceencryptionfromAndroid2.3.4(APIlevel10)andithasundergonesomebigchangessincethen. GoogleimposedthatalldevicesrunningAndroid6.0(APIlevel23)orhigherhadtosupportstorageencryption,although somelow-enddeviceswereexemptbecauseitwouldsignificantlyimpacttheirperformance. • Full-DiskEncryption(FDE):Android5.0(APIlevel21)andabovesupportfull-diskencryption. Thisencryptionuses asinglekeyprotectedbytheuser’sdevicepasswordtoencryptanddecrypttheuserdatapartition. Thiskindof encryption is now considered deprecated and file-based encryption should be used whenever possible. Full-disk encryptionhasdrawbacks,suchasnotbeingabletoreceivecallsornothavingoperativealarmsafterarebootif theuserdoesnotenterthepasswordtounlock. 92\\n• File-BasedEncryption(FBE):Android7.0(APIlevel24)supportsfile-basedencryption. File-basedencryptionallows differentfilestobeencryptedwithdifferentkeyssotheycanbedecipheredindependently. Devicesthatsupport thistypeofencryptionsupportDirectBootaswell. DirectBootenablesthedevicetohaveaccesstofeaturessuch asalarmsoraccessibilityserviceseveniftheuserdidn’tunlockthedevice. Note: youmighthearofAdiantum,whichisanencryptionmethoddesignedfordevicesrunningAndroid9(APIlevel 28)andhigherwhoseCPUslackAESinstructions. Adiantum is only relevant for ROM developers or device vendors,AndroiddoesnotprovideanAPIfordeveloperstouseAdiantumfromapplications. Asrecommendedby Google,AdiantumshouldnotbeusedwhenshippingARM-baseddeviceswithARMv8CryptographyExtensionsor x86-baseddeviceswithAES-NI.AESisfasteronthoseplatforms. FurtherinformationisavailableintheAndroiddocumentation. Trusted Execution Environment (TEE) InorderfortheAndroidsystemtoperformencryptionitneedsawaytosecurelygenerate,importandstorecryptographic keys. Weareessentiallyshiftingtheproblemofkeepingsensitivedatasecuretowardskeepingacryptographickeysecure. Iftheattackercandumporguessthecryptographickey,thesensitiveencrypteddatacanberetrieved. Androidoffersatrustedexecutionenvironmentindedicatedhardwaretosolvetheproblemofsecurelygeneratingand protectingcryptographickeys. ThismeansthatadedicatedhardwarecomponentintheAndroidsystemisresponsible forhandlingcryptographickeymaterial. Threemainmodulesareresponsibleforthis: • Hardware-backed KeyStore: This module offers cryptographic services to the Android OS and third-party apps. It enables apps to perform cryptographic sensitive operations in an TEE without exposing the cryptographic key material. • StrongBox: InAndroid9(Pie),StrongBoxwasintroduced,anotherapproachtoimplementahardware-backedKey- Store. While previous to Android 9 Pie, a hardware-backed KeyStore would be any", "metadata": {"doc_id": "OWASP_MASTG", "chunk_id": 55}}