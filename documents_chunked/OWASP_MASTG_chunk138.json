{"text": "asString:kSecAttrTokenIDSecureEnclave, kSecPublicKeyAttrs asString:publicKeyParams, kSecPrivateKeyAttrs asString:privateKeyParams, ]asCFDictionary varpubKey,privKey:SecKey? letstatus =SecKeyGeneratePair(parameters,&pubKey,&privKey) ifstatus !=errSecSuccess { //Keyscreatedsuccessfully } Keychain Data Persistence OniOS,whenanapplicationisuninstalled,theKeychaindatausedbytheapplicationisretainedbythedevice,unlikethe datastoredbytheapplicationsandboxwhichiswiped. Intheeventthatausersellstheirdevicewithoutperforminga factoryreset,thebuyerofthedevicemaybeabletogainaccesstotheprevioususer’sapplicationaccountsanddataby reinstallingthesameapplicationsusedbytheprevioususer. Thiswouldrequirenotechnicalabilitytoperform. When assessing an iOS application, you should look for Keychain data persistence. This is normally done by using the application to generate sample data that may be stored in the Keychain, uninstalling the application, then reinstalling the application to see whether the data was retained between application installations. Use objection runtime mobile explorationtoolkittodumpthekeychaindata. Thefollowingobjectioncommanddemonstratesthisprocedure: ...itudehacks.DVIAswiftv2.developon (iPhone:13.2.3)[usb] #ioskeychaindump Note:YoumaybeaskedtoauthenticateusingthedevicespasscodeorTouchID Savetheoutputbyadding `--jsonkeychain.json`tothiscommand DumpingtheiOSkeychain... Created Accessible ACL Type Account Service Data ------------------------- ------------------------------ ----- -------- ------------------------- ↪ ------------------------------------------------------------- ------------------------------------ 2020-02-1113:26:52+0000 WhenUnlocked None Password keychainValue com.highaltitudehacks.DVIAswiftv2.develop ↪ mysecretpass123 There’s no iOS API that developers can use to force wipe data when an application is uninstalled. Instead, developers shouldtakethefollowingstepstopreventKeychaindatafrompersistingbetweenapplicationinstallations: • Whenanapplicationisfirstlaunchedafterinstallation,wipeallKeychaindataassociatedwiththeapplication. This willpreventadevice’sseconduserfromaccidentallygainingaccesstotheprevioususer’saccounts. Thefollowing Swiftexampleisabasicdemonstrationofthiswipingprocedure: letuserDefaults =UserDefaults.standard ifuserDefaults.bool(forKey:\"hasRunBefore\")==false { //RemoveKeychainitemshere //Updatetheflagindicator userDefaults.set(true,forKey:\"hasRunBefore\") } • WhendevelopinglogoutfunctionalityforaniOSapplication,makesurethattheKeychaindataiswipedaspartof accountlogout. Thiswillallowuserstocleartheiraccountsbeforeuninstallinganapplication. 403\\nLogs Therearemanylegitimatereasonsforcreatinglogfilesonamobiledevice,includingkeepingtrackofcrashesorerrors thatarestoredlocallywhilethedeviceisoffline(sothattheycanbesenttotheapp’sdeveloperonceonline),andstoring usagestatistics. However,loggingsensitivedata,suchascreditcardnumbersandsessioninformation,mayexposethe datatoattackersormaliciousapplications. Logfilescanbecreatedinseveralways. Thefollowinglistshowsthemethods availableoniOS: • NSLogMethod • printf-likefunction • NSAssert-likefunction • Macro Backups iOSincludesauto-backupfeaturesthatcreatecopiesofthedatastoredonthedevice. YoucanmakeiOSbackupsfrom your host computer by using iTunes (till macOS Catalina) or Finder (from macOS Catalina onwards), or via the iCloud backupfeature. Inbothcases,thebackupincludesnearlyalldatastoredontheiOSdeviceexcepthighlysensitivedata suchasApplePayinformationandTouchIDsettings. SinceiOSbacksupinstalledappsandtheirdata,anobviousconcerniswhethersensitiveuserdatastoredbytheappmight unintentionallyleakthroughthebackup. Anotherconcern,thoughlessobvious,iswhethersensitiveconfigurationsettings used to protect data or restrict app functionality could be tampered to change app behavior after restoring a modified backup. Bothconcernsarevalidandthesevulnerabilitieshaveproventoexistinavastnumberofappstoday. How the Keychain Is Backed Up When users back up their iOS device, the Keychain data is backed up as well, but the secrets in the Keychain remain encrypted. TheclasskeysnecessarytodecrypttheKeychaindataaren’tincludedinthebackup. RestoringtheKeychain datarequiresrestoringthebackuptoadeviceandunlockingthedevicewiththeuserspasscode. KeychainitemsforwhichthekSecAttrAccessibleWhenPasscodeSetThisDeviceOnly attributeissetcanbedecrypted only if the backup is restored to the backed up device. Someone trying to extract this Keychain data from the backup couldn’tdecryptitwithoutaccesstothecryptohardwareinsidetheoriginatingdevice. One caveat to using the Keychain, however, is that it was only designed to store small bits of user data or short notes (accordingtoApple’sdocumentationonKeychainServices). Thismeansthatappswithlargerlocalsecurestorageneeds (e.g.,messagingapps,etc.) shouldencryptthedatawithintheappcontainer,butusetheKeychaintostorekeymaterial. Incaseswheresensitiveconfigurationsettings(e.g.,datalosspreventionpolicies,passwordpolicies,compliancepolicies, etc)mustremainunencryptedwithintheappcontainer,youcanconsiderstoringahashofthepoliciesinthekeychain for integrity checking. Without an integrity check, these settings could be modified within a backup and then restored backtothedevicetomodifyappbehavior(e.g.,changeconfiguredremoteendpoints)orsecuritysettings(e.g.,jailbreak detection,certificatepinning,maximumUIloginattempts,etc.). The takeaway: If sensitive data is handled as recommended earlier in this chapter (e.g., stored in the Keychain, with Keychainbackedintegritychecks,orencryptedwithakeythat’slockedinsidetheKeychain),backupsshouldn’tbesecurity issue. Process Memory Analyzingmemorycanhelpdeveloperstoidentifytherootcausesofproblemssuchasapplicationcrashes. However,it canalsobeusedtoaccesstosensitivedata. Thissectiondescribeshowtocheckprocess’memoryfordatadisclosure. First,identifythesensitiveinformationthat’sstoredinmemory. Sensitiveassetsareverylikelytobeloadedintomemory atsomepoint. Theobjectiveistomakesurethatthisinfoisexposedasbrieflyaspossible. Toinvestigateanapplication’smemory,firstcreateamemorydump. Alternatively,youcananalyzethememoryinreal timewith,forexample,adebugger. Regardlessofthemethodyouuse,thisisaveryerror-proneprocessbecausedumps provide the data left by executed functions and you might miss executing critical steps. In addition, overlooking data duringanalysisisquiteeasytodounlessyouknowthefootprintofthedatayou’relookingfor(eitheritsexactvalueor 404\\nitsformat). Forexample,iftheappencryptsaccordingtoarandomlygeneratedsymmetrickey,you’reveryunlikelyto spotthekeyinmemoryunlessyoufinditsvaluebyothermeans. Before looking into the source code, checking the documentation and identifying application components provide an overviewofwheredatamightbeexposed. Forexample,whilesensitivedatareceivedfromabackendexistsinthefinal model object, multiple copies may also existin the HTTPclient or the XML parser. All these copies should be removed frommemoryassoonaspossible. Understanding the application’s architecture and its interaction with the OS will help you identify sensitive information that doesn’t have to be exposed in memory at all. For example, assume your app receives data from one server and transfersittoanotherwithoutneedinganyadditionalprocessing. Thatdatacanbereceivedandhandledinencrypted form,whichpreventsexposureviamemory. However,ifsensitivedatadoesneedtobeexposedviamemory,makesurethatyourappexposesasfewcopiesofthis dataaspossibleforaslittletimeaspossible. Inotherwords,youwantcentralizedhandlingofsensitivedata,basedon primitiveandmutabledatastructures. Suchdatastructuresgivedevelopersdirectaccesstomemory. Makesurethatthisaccessisusedtooverwritethesensitive data and cryptographic keys with zeroes. Apple Secure Coding Guide suggests zeroing sensitive data after usage, but providesnorecommendedwaysofdoingthis. Examplesofpreferabledatatypesincludechar []andint [],butnotNSStringorString. Wheneveryoutrytomodify animmutableobject,suchasaString,youactuallycreateacopyandchangethecopy. ConsiderusingNSMutableData forstoringsecretsonSwift/Objective-CanduseresetBytes(in:) methodforzeroing. Also,seeCleanmemoryofsecret dataforreference. AvoidSwiftdatatypesotherthancollectionsregardlessofwhethertheyareconsideredmutable. ManySwiftdatatypes holdtheirdatabyvalue,notbyreference. Althoughthisallowsmodificationofthememoryallocatedtosimpletypeslike charandint,handlingacomplextypesuchasStringbyvalueinvolvesahiddenlayerofobjects,structures,orprimitive arrayswhosememorycan’tbedirectlyaccessedormodified. Certaintypesofusagemayseemtocreateamutabledata object (and even be documented as doing so), but", "metadata": {"doc_id": "OWASP_MASTG", "chunk_id": 138}}