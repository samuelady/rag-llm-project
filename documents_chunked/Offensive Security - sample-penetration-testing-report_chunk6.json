{"text": "the MegaCorp One’s trusted environment had been obtained. It should be noted that the current access to the Windows network was limited to a non-privileged domain user account and a local administrator account. 7 http://http-tunnel.sourceforge.net/ PTR-20130513 Copyright © 2013 Offensive Security Services LLC. All rights reserved. Page 18 of 34\\nFigure 25 – Compromise of the MegaCorp One network has reached into the network management subnet. PTR-20130513 Copyright © 2013 Offensive Security Services LLC. All rights reserved. Page 19 of 34\\nCitrix Environment Compromise Using remote desktop access to the internal network, we proceeded to explore the network in search of high value targets. One such target appeared to be a Citrix server, which was set as the homepage on the compromised host. Using the same credentials that were utilized to establish the remote desktop connection, we were able to successfully login to this Citrix environment. Figure 26 – A Citrix server offering only Internet Explorer was discovered on the MegaCorp One network. This Citrix environment exposed “Internet Explorer” as the only available application. This is a commonly utilized method by many organizations to limit access to the underlying operating system of the Citrix server. It is important to note that many methods exist to bypass this configuration. In this case, we utilized the “Save” dialog window to create a batch file that would provide us with a Powershell interface. This is possible as the “Save” dialog operates in much the same manner as a standard “Windows Explorer” file management window. PTR-20130513 Copyright © 2013 Offensive Security Services LLC. All rights reserved. Page 20 of 34\\nFigure 27 – Using the Save dialog, it is possible to bypass the some restrictions imposed by the Citrix environment. Figure 28 – A batch file invoking the Powershell application is created on the Citrix server. PTR-20130513 Copyright © 2013 Offensive Security Services LLC. All rights reserved. Page 21 of 34\\nFigure 29 – Citrix restriction is bypassed resulting in the execution of the Powershell. The ability to use Powershell was then utilized to download a malicious payload, which would provide us with a meterpreter session to the underlying Citrix server. Figure 30 - Powershell functionality allows an end-user to retrieve files from arbitrary sources, including remote internet locations. The ability to utilize the “Save” dialog to run arbitrary executable programs was combined with the previously discovered local administrator password allowing us to execute programs in the context of the local administrator. This allowed us to gain full administrative control of the Citrix system. Please see Appendix A for more information. PTR-20130513 Copyright © 2013 Offensive Security Services LLC. All rights reserved. Page 22 of 34\\nFigure 31 – Password re-use allows the attackers to execute a malicious executable with administrative privileges. Figure 32 – Complete compromise of the Citrix server is achieved. PTR-20130513 Copyright © 2013 Offensive Security Services LLC. All rights reserved. Page 23 of 34\\nFigure 33 – An additional host in the network management subnet has been compromised. Escalation to Domain Administrator With the Citrix server", "metadata": {"doc_id": "Offensive Security - sample-penetration-testing-report", "chunk_id": 6}}