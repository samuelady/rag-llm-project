{"text": "Overview Static Analysis To determine whether API calls and functions provided by the third-party library are used according to best practices, reviewtheirsourcecode,requestedpermissionsandcheckforanyknownvulnerabilities. Alldatathat’ssenttothird-partyservicesshouldbeanonymizedtopreventexposureofPII(PersonalIdentifiableInforma- tion)thatwouldallowthethirdpartytoidentifytheuseraccount. Nootherdata(suchasIDsthatcanbemappedtoa useraccountorsession)shouldbesenttoathirdparty. Dynamic Analysis Check all requests to external services for embedded sensitive information. To intercept traffic between the client and server,youcanperformdynamicanalysisbylaunchingaman-in-the-middle(MITM)attackwithBurpSuiteProfessionalor OWASPZAP.Onceyouroutethetrafficthroughtheinterceptionproxy,youcantrytosniffthetrafficthatpassesbetween theappandserver. Allapprequeststhataren’tsentdirectlytotheserveronwhichthemainfunctionishostedshould becheckedforsensitiveinformation,suchasPIIinatrackeroradservice. Determining Whether Sensitive Data Is Shared with Third Parties via Notifications Platform: android MASVSV1: MSTG-STORAGE-4 MASVSV2: MASVS-STORAGE-2 203\\nOverview Static Analysis SearchforanyusageoftheNotificationManagerclasswhichmightbeanindicationofsomeformofnotificationmanage- ment. Iftheclassisbeingused,thenextstepwouldbetounderstandhowtheapplicationisgeneratingthenotifications andwhichdataendsupbeingshown. Dynamic Analysis Run the application and start tracing all calls to functions related to the notifications creation, e.g. setContentTitle or setContentText from NotificationCompat.Builder. Observe the trace in the end and evaluate if it contains any sensitiveinformationwhichanotherappmighthaveeavesdropped. Testing Backups for Sensitive Data Platform: android MASVSV1: MSTG-STORAGE-8 MASVSV2: MASVS-STORAGE-2 Overview Static Analysis Local ChecktheAndroidManifest.xmlfileforthefollowingflag: android:allowBackup=\"true\" If the flag value is true, determine whether the app saves any kind of sensitive data (check the test case “Testing for SensitiveDatainLocalStorage”). Cloud Regardlessofwhetheryouusekey/valuebackuporautobackup,youmustdeterminethefollowing: • whichfilesaresenttothecloud(e.g.,SharedPreferences) • whetherthefilescontainsensitiveinformation • whethersensitiveinformationisencryptedbeforebeingsenttothecloud. Ifyoudon’twanttosharefileswithGoogleCloud,youcanexcludethemfromAutoBackup. Sensitiveinformation storedatrestonthedeviceshouldbeencryptedbeforebeingsenttothecloud. • AutoBackup: YouconfigureAutoBackupviathebooleanattributeandroid:allowBackupwithintheapplication’s manifest file. Auto Backup is enabled by default for applications that target Android 6.0 (API level 23). You can usetheattributeandroid:fullBackupOnlytoactivateautobackupwhenimplementingabackupagent,butthis attributeisavailableforAndroidversions6.0andaboveonly. OtherAndroidversionsusekey/valuebackupinstead. android:fullBackupOnly Auto backup includes almost all the app files and stores up 25 MB of them per app in the user’s Google Drive account. Onlythemostrecentbackupisstored;thepreviousbackupisdeleted. 204\\n• Key/Value Backup: Toenablekey/valuebackup,youmustdefinethebackupagentinthemanifestfile. Lookin AndroidManifest.xmlforthefollowingattribute: android:backupAgent Toimplementkey/valuebackup,extendoneofthefollowingclasses: • BackupAgent • BackupAgentHelper Tocheckforkey/valuebackupimplementations,lookfortheseclassesinthesourcecode. Dynamic Analysis Afterexecutingallavailableappfunctions, attempttobackupviaadb. Ifthebackupissuccessful, inspectthebackup archiveforsensitivedata. Openaterminalandrunthefollowingcommand: adbbackup -apk -nosystem <package-name> ADBshouldrespondnowwith“Nowunlockyourdeviceandconfirmthebackupoperation”andyoushouldbeaskedon the Android phone for a password. This is an optional step and you don’t need to provide one. If the phone does not promptthismessage,trythefollowingcommandincludingthequotes: adbbackup \"-apk-nosystem<package-name>\" Theproblemhappenswhenyourdevicehasanadbversionpriorto1.0.31. Ifthat’sthecaseyoumustuseanadbversion of1.0.31alsoonyourhostcomputer. Versionsofadbafter1.0.32brokethebackwardscompatibility. ApprovethebackupfromyourdevicebyselectingtheBackupmydataoption. Afterthebackupprocessisfinished,the file.abwillbeinyourworkingdirectory. Runthefollowingcommandtoconvertthe.abfiletotar. ddif=mybackup.abbs=24skip=1|opensslzlib -d>mybackup.tar Incaseyougettheerroropenssl:Error: 'zlib' is an invalid command. youcantrytousePythoninstead. ddif=backup.abbs=1skip=24 |python -c\"importzlib,sys;sys.stdout.write(zlib.decompress(sys.stdin.read()))\" >backup.tar The Android Backup Extractor is another alternative backup tool. To make the tool to work, you have to download the OracleJCEUnlimitedStrengthJurisdictionPolicyFilesforJRE7orJRE8andplacethemintheJRElib/securityfolder. Run thefollowingcommandtoconvertthetarfile: java -jar abe.jarunpackbackup.ab ifitshowssomeCipherinformationandusage,whichmeansithasn’tunpackedsuccessfully. Inthiscaseyoucangivea trywithmorearguments: abe[-debug][-useenv=yourenv]unpack <backup.ab><backup.tar>[password] [password]isthepasswordwhenyourandroiddeviceaskedyouearlier. Forexamplehereis: 123 java -jar abe.jarunpackbackup.abbackup.tar123 Extractthetarfiletoyourworkingdirectory. 205\\ntarxvfmybackup.tar Testing Local Storage for Sensitive Data Platform: android MASVSV1: MSTG-STORAGE-1,MSTG-STORAGE-2 MASVSV2: MASVS-STORAGE-1 Overview Thistestcasefocusesonidentifyingpotentiallysensitivedatastoredbyanapplicationandverifyingifitissecurelystored. Thefollowingchecksshouldbeperformed: • Analyzedatastorageinthesourcecode. • Besuretotriggerallpossiblefunctionalityintheapplication(e.g.byclickingeverywherepossible)inordertoensure datageneration. • Checkallapplicationgeneratedandmodifiedfilesandensurethatthestoragemethodissufficientlysecure. – ThisincludesSharedPreferences,SQLdatabases,RealmDatabases,InternalStorage,ExternalStorage,etc. Ingeneralsensitivedatastoredlocallyonthedeviceshouldalwaysbeatleastencrypted,andanykeysusedforencryption methodsshouldbesecurelystoredwithintheAndroidKeystore. Thesefilesshouldalsobestoredwithintheapplication sandbox. Ifachievablefortheapplication,sensitivedatashouldbestoredoffdeviceor,evenbetter,notstoredatall. Static Analysis First of all, try to determine the kind of storage used by the Android app and to find out whether the app processes sensitivedatainsecurely. • Check AndroidManifest.xml for read/write external storage permissions, for example, uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\". • CheckthesourcecodeforkeywordsandAPIcallsthatareusedtostoredata: – Filepermissions,suchas: ∗ MODE_WORLD_READABLE or MODE_WORLD_WRITABLE: You should avoid using MODE_WORLD_WRITEABLE and MODE_WORLD_READABLE for files because any app will be able to read from or write to the files, even if they are stored in the app’s private data directory. If data must be shared with other applications, consideracontentprovider. Acontentprovideroffersreadandwritepermissionstootherappsandcan grantdynamicpermissiononacase-by-casebasis. – Classesandfunctions,suchas: ∗ theSharedPreferencesclass(storeskey-valuepairs) ∗ theFileOutPutStreamclass(usesinternalorexternalstorage) ∗ thegetExternal*functions(useexternalstorage) ∗ thegetWritableDatabasefunction(returnsaSQLiteDatabaseforwriting) ∗ thegetReadableDatabasefunction(returnsaSQLiteDatabaseforreading) ∗ thegetCacheDirandgetExternalCacheDirsfunction(usecachedfiles) EncryptionshouldbeimplementedusingprovenSDKfunctions. Thefollowingdescribesbadpracticestolookforinthe sourcecode: • Locallystoredsensitiveinformation“encrypted”viasimplebitoperationslikeXORorbitflipping. Theseoperations shouldbeavoidedbecausetheencrypteddatacanberecoveredeasily. • KeysusedorcreatedwithoutAndroidonboardfeatures,suchastheAndroidKeyStore • Keysdisclosedbyhard-coding 206\\nA typical misuse are hard-coded cryptographic keys. Hard-coded and world-readable cryptographic keys significantly increasethepossibilitythatencrypteddatawillberecovered. Onceanattackerobtainsthedata,decryptingitistrivial. Symmetric cryptography keys must be stored on the device, so identifying them is just a matter of", "metadata": {"doc_id": "OWASP_MASTG", "chunk_id": 85}}