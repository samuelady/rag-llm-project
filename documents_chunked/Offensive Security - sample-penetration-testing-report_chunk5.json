{"text": "Preferences file on the system that allowed us to decrypt the local administrative password56. Please see Appendix A for more information. Figure 17 – Using the newly gained access it is possible to retrieve the Groups.xml file from a domain controller. 5http://msdn.microsoft.com/en-us/library/cc422924.aspx 6http://blogs.technet.com/b/grouppolicy/archive/2009/04/22/passwords-in-group-policy-preferences- updated.aspx PTR-20130513 Copyright © 2013 Offensive Security Services LLC. All rights reserved. Page 15 of 34\\nFigure 18 – Encrypted local administrator password is found in the Groups.xml file. Figure 19 – Using the encryption key published by Microsoft, the encrypted password is easily decrypted. Using the recovered plaintext password, we were able to gain local administrative access to the compromised client. Deep Packet Inspection Bypass While trying to establish additional layers of access into the compromised system, we encountered aggressive egress filtering. This was first encountered while trying to establish an encrypted outbound tunnel for the Microsoft Remote Desktop Protocol. Figure 20 – Initial attempts to establish an outbound tunnel for RDP were blocked by the egress filtering systems. Additionally, we discovered network protocol enforcement as we attempted to connect to the attacker SSH server on port 80. To bypass this, we created a tunnel within the existing meterpreter session to allow us to access Windows file sharing from the attacker system. This was utilized to run a windows command shell on the compromised host as the local administrative user. Within this shell, we executed an additional meterpreter payload. PTR-20130513 Copyright © 2013 Offensive Security Services LLC. All rights reserved. Page 16 of 34\\nFigure 21 – Port forwarding through the initial meterpreter session is established in order to achieve direct access to the compromised management host. Figure 22 – Newly established connection is used to gain an administrative shell on the compromised management host. Figure 23 - Local Administrator access is used to establish a meterpreter shell on host 10.7.0.22. PTR-20130513 Copyright © 2013 Offensive Security Services LLC. All rights reserved. Page 17 of 34\\nWith the new meterpreter shell in place, we then utilized HTTP-Tunnel, an open source utility7, that encapsulates arbitrary traffic within the HTTP payload. We used the newly established “http tunnel” to encapsulate a remote desktop connection between the attacker and compromised client. This allowed us to obtain full graphical access to the compromised client system. The remote desktop session was established using the password for user “mike”, which was discovered to be re-used from the compromised SQLite Manager application. Please see Appendix A for more information. Figure 24 - Remote Desktop access is established by encapsulating the previously filtered protocol through a http tunnel. At this point, the external perimeter of the MegaCorp One network was fully compromised as shown in Figure 25. The virtual equivalent of console access to a computer within the MegaCorp One’s trusted environment had been obtained. It should be noted that the current access to the Windows network was limited to a non-privileged domain user account and a local administrator account. 7 http://http-tunnel.sourceforge.net/ PTR-20130513 Copyright © 2013 Offensive Security Services LLC. All rights reserved. Page 18 of 34\\nFigure", "metadata": {"doc_id": "Offensive Security - sample-penetration-testing-report", "chunk_id": 5}}