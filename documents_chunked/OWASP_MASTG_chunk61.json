{"text": "via USB, via Google’s official app store (GooglePlayStore)orfromalternativestores. Whereas other vendors may review and approve apps before they are actually published, Google will simply scan for known malware signatures; this minimizes the time between the beginning of the publishing process and public app availability. Publishing an app is quite straightforward; the main operation is making the signed APK file downloadable. On Google Play, publishingstartswithaccountcreationandisfollowedbyappdeliverythroughadedicatedinterface. Detailsare availableattheofficialAndroiddocumentation. 107\\nAndroid Security Testing Inthischapter,we’lldiveintosettingupasecuritytestingenvironmentandintroduceyoutosomepracticalprocesses andtechniquesfortestingthesecurityofAndroidapps. ThesearethebuildingblocksfortheMASTGtestcases. Android Testing Setup YoucansetupafullyfunctioningtestenvironmentonalmostanymachinerunningWindows,Linux,ormacOS. Host Device At the very least, you’ll need Android Studio (which comes with the Android SDK) platform tools, an emulator, and an apptomanagethevariousSDKversionsandframeworkcomponents. AndroidStudioalsocomeswithanAndroidVirtual Device(AVD)Managerapplicationforcreatingemulatorimages. MakesurethatthenewestSDKtoolsandplatformtools packagesareinstalledonyoursystem. Inaddition,youmaywanttocompleteyourhostsetupbyinstallingtheAndroidNDKifyou’replanningtoworkwithapps containingnativelibraries. Sometimesitcanbeusefultodisplayorcontroldevicesfromthecomputer. Toachievethis,youcanuseScrcpy. Testing Device For dynamic analysis, you’ll need an Android device to run the target app on. In principle, you can test without a real Androiddeviceanduseonlytheemulator. However, appsexecutequiteslowlyonaemulator, andsimulatorsmaynot giverealisticresults. Testingonarealdevice makesfora smootherprocessandamorerealisticenvironment. On the otherhand,emulatorsallowyoutoeasilychangeSDKversionsorcreatemultipledevices. Afulloverviewoftheprosand consofeachapproachislistedinthetablebelow. Property Physical Emulator/Simulator Abilitytorestore Softbricksarealwayspossible,but Emulatorscancrashorbecome newfirmwarecantypicallystillbe corrupt,butanewonecanbecreated flashed. Hardbricksareveryrare. orasnapshotcanberestored. Reset Canberestoredtofactorysettingsor Emulatorscanbedeletedand reflashed. recreated. Snapshots Notpossible. Supported,greatformalware analysis. Speed Muchfasterthanemulators. Typicallyslow,butimprovementsare beingmade. Cost Typicallystartat$200forausable Bothfreeandcommercialsolutions device. Youmayrequiredifferent exist. devices,suchasonewithorwithouta biometricsensor. Easeofrooting Highlydependentonthedevice. Typicallyrootedbydefault. Easeofemulatordetection It’snotanemulator,soemulator Manyartefactswillexist,makingit checksarenotapplicable. easytodetectthattheappisrunning inanemulator. Easeofrootdetection Easiertohideroot,asmanyroot Emulatorswillalmostalwaystrigger detectionalgorithmscheckfor rootdetectionalgorithmsduetothe emulatorproperties. WithMagisk factthattheyarebuiltfortestingwith Systemlessrootit’snearlyimpossible manyartefactsthatcanbefound. todetect. 108\\nProperty Physical Emulator/Simulator Hardwareinteraction EasyinteractionthroughBluetooth, Usuallyfairlylimited,withemulated NFC,4G,Wi-Fi,biometrics,camera, hardwareinput(e.g.randomGPS GPS,gyroscope,... coordinates) APIlevelsupport Dependsonthedeviceandthe Alwayssupportsthelatestversions, community. Activecommunitieswill includingbetareleases. Emulators keepdistributingupdatedversions containingspecificAPIlevelscan (e.g.LineageOS),whilelesspopular easilybedownloadedandlaunched. devicesmayonlyreceiveafew updates. Switchingbetweenversions requiresflashingthedevice,atedious process. Nativelibrarysupport Nativelibrariesareusuallybuiltfor Someemulatorsrunonx86CPUs,so ARMdevices,sotheywillworkona theymaynotbeabletorunpackaged physicaldevice. nativelibraries. Malwaredanger Malwaresamplescaninfectadevice, Malwaresamplescaninfectan butifyoucanclearoutthedevice emulator,buttheemulatorcansimply storageandflashacleanfirmware, beremovedandrecreated. Itisalso therebyrestoringittofactory possibletocreatesnapshotsand settings,thisshouldnotbeaproblem. comparedifferentsnapshotstohelp Beawarethattherearemalware inmalwareanalysis. Beawarethat samplesthattrytoexploittheUSB therearemalwareproofsofconcept bridge. whichtrytoattackthehypervisor. Testing on a Real Device Almostanyphysicaldevicecanbeusedfortesting,butthereareafewconsiderationstobemade. First,thedeviceneeds toberootable. Thisistypicallyeitherdonethroughanexploit,orthroughanunlockedbootloader. Exploitsarenotalways available,andthebootloadermaybelockedpermanently,oritmayonlybeunlockedoncethecarriercontracthasbeen terminated. The best candidates are flagship Google pixel devices built for developers. These devices typically come with an un- lockable bootloader, opensource firmware, kernel, radio available online and official OS source code. The developer communitiespreferGoogledevicesastheOSisclosesttotheandroidopensourceproject. Thesedevicesgenerallyhave thelongestsupportwindowswith2yearsofOSupdatesand1yearofsecurityupdatesafterthat. Alternatively,Google’sAndroidOneprojectcontainsdevicesthatwillreceivethesamesupportwindows(2yearsofOS updates, 1 year of security updates) and have near-stock experiences. While it was originally started as a project for low-enddevices,theprogramhasevolvedtoincludemid-rangeandhigh-endsmartphones,manyofwhichareactively supportedbythemoddingcommunity. DevicesthataresupportedbytheLineageOSprojectarealsoverygoodcandidatesfortestdevices. Theyhaveanactive community,easytofollowflashingandrootinginstructionsandthelatestAndroidversionsaretypicallyquicklyavailable as a Lineage installation. LineageOS also continues support for new Android versions long after the OEM has stopped distributingupdates. WhenworkingwithanAndroidphysicaldevice,you’llwanttoenableDeveloperModeandUSBdebuggingonthedevice inordertousetheADBdebugginginterface. SinceAndroid4.2(APIlevel16),theDeveloperoptionssubmenuinthe Settingsappishiddenbydefault. Toactivateit,taptheBuild numbersectionoftheAbout phoneviewseventimes. Notethatthebuildnumberfield’slocationvariesslightlybydevice. Forexample,onLGPhones,itisunderAboutphone ->Softwareinformation. Onceyouhavedonethis,DeveloperoptionswillbeshownatbottomoftheSettingsmenu. Oncedeveloperoptionsareactivated,youcanenabledebuggingwiththeUSBdebuggingswitch. Testing on an Emulator Multipleemulatorsexist,onceagainwiththeirownstrengthsandweaknesses: Freeemulators: 109\\n• AndroidVirtualDevice(AVD)-Theofficialandroidemulator,distributedwithAndroidStudio. • AndroidX86-Anx86portoftheAndroidcodebase Commercialemulators: • Genymotion-Matureemulatorwithmanyfeatures,bothaslocalandcloud-basedsolution. Freeversionavailable fornon-commercialuse. • Corellium-Offerscustomdevicevirtualizationthroughacloud-basedoron-premsolution. AlthoughthereexistseveralfreeAndroidemulators,werecommendusingAVDasitprovidesenhancedfeaturesappro- priatefortestingyourappcomparedtotheothers. Intheremainderofthisguide,wewillusetheofficialAVDtoperform tests. AVDsupportssomehardwareemulation,suchasGPSorSMSthroughitsso-calledExtendedControlsaswellasmotion sensors. YoucaneitherstartanAndroidVirtualDevice(AVD)byusingtheAVDManagerinAndroidStudioorstarttheAVDmanager fromthecommandlinewiththeandroidcommand,whichisfoundinthetoolsdirectoryoftheAndroidSDK: ./androidavd SeveraltoolsandVMsthatcanbeusedtotestanappwithinanemulatorenvironmentareavailable: • MobSF • Nathan(notupdatedsince2016) Pleasealsoverifythe“TestingTools”chapterattheendofthisbook. Getting Privileged Access Rooting (i.e., modifying the OS so that you can run commands as the root user) is recommended for testing on a real device. Thisgivesyoufullcontrolovertheoperatingsystemandallowsyoutobypassrestrictionssuchasappsandboxing. Theseprivilegesinturnallowyoutousetechniqueslikecodeinjectionandfunctionhookingmoreeasily. Notethatrootingisrisky,andthreemainconsequencesneedtobeclarifiedbeforeyouproceed. Rootingcanhavethe followingnegativeeffects: • voidingthedevicewarranty(alwayscheckthemanufacturer’spolicybeforetakinganyaction) • “bricking”thedevice,i.e.,renderingitinoperableandunusable • creatingadditionalsecurityrisks(becausebuilt-inexploitmitigationsareoftenremoved) Youshouldnotrootapersonaldevicethatyoustoreyourprivateinformationon. Werecommendgettingacheap,dedi- catedtestdeviceinstead. Manyolderdevices,suchasGoogle’sNexusseries,canrunthenewestAndroidversionsand areperfectlyfinefortesting. You need to understand that rooting your device is ultimately YOUR decision and that OWASP shall in no waybeheldresponsibleforanydamage. Ifyou’reuncertain,seekexpertadvicebeforestartingtherooting process. Which Mobiles Can Be Rooted Virtually any Android mobile can be rooted. Commercial versions of Android OS (which are Linux OS evolutions at the kernellevel)areoptimizedforthemobileworld. Somefeatureshavebeenremovedordisabledfortheseversions, for example,non-privilegedusers’abilitytobecomethe‘root’user(whohaselevatedprivileges). Rootingaphonemeans allowinguserstobecometherootuser,e.g.,addingastandardLinuxexecutablecalledsu,whichisusedtochangeto anotheruseraccount. Torootamobiledevice,firstunlockitsbootloader. Theunlockingproceduredependsonthedevicemanufacturer. How- ever,forpracticalreasons,rootingsomemobiledevicesismorepopularthanrootingothers,particularlywhenitcomesto securitytesting: devicescreatedbyGoogleandmanufacturedbycompanieslikeSamsung,LG,andMotorolaareamong themostpopular,particularlybecausetheyareusedbymanydevelopers. Thedevicewarrantyisnotnullifiedwhenthe bootloaderisunlockedandGoogleprovidesmanytoolstosupporttherootitself. 110\\nRooting with Magisk Magisk(“MagicMask”)isonewaytorootyourAndroiddevice. Itsspecialtyliesinthewaythemodificationsonthesystem areperformed. Whileotherrootingtoolsaltertheactualdataonthesystempartition,Magiskdoesnot(whichiscalled “systemless”). Thisenablesawaytohidethemodificationsfromroot-sensitiveapplications(e.g.forbankingorgames) andallowsusingtheofficialAndroidOTAupgradeswithouttheneedtounrootthedevicebeforehand. YoucangetfamiliarwithMagiskreadingtheofficialdocumentationonGitHub. Ifyoudon’thaveMagiskinstalled,youcan findinstallationinstructionsinthedocumentation.", "metadata": {"doc_id": "OWASP_MASTG", "chunk_id": 61}}