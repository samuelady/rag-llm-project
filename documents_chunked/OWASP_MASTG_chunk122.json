{"text": "SPUSBDataType |sed-n-e'/iPad/,/Serial/p;/iPhone/,/Serial/p;/iPod/,/Serial/p' |grep \"SerialNumber:\" 2019-09-0810:18:03.920 system_profiler[13251:1050356]SPUSBDevice:IOCreatePlugInInterfaceForServicefailed0xe00002be SerialNumber: 64655621de6ef5e56a874d63f1e1bdd14f7103b1 • Byusinginstruments: instruments -sdevices Testing on a real device (Jailbroken) You should have a jailbroken iPhone or iPad for running tests. These devices allow root access and tool installation, makingthesecuritytestingprocessmorestraightforward. Ifyoudon’thaveaccesstoajailbrokendevice,youcanapply theworkaroundsdescribedlaterinthischapter,butbepreparedforamoredifficultexperience. Testing on the iOS Simulator UnliketheAndroidemulator,whichfullyemulatesthehardwareofanactualAndroiddevice,theiOSSDKsimulatoroffers a higher-level simulation of an iOS device. Most importantly, emulator binaries are compiled to x86 code instead of ARM code. Apps compiled for a real device don’t run, making the simulator useless for black box analysis and reverse engineering. 335\\nTesting on an Emulator CorelliumistheonlypubliclyavailableiOSemulator. ItisanenterpriseSaaSsolutionwithaperuserlicensemodeland doesnotoffercommunitylicenses. Getting Privileged Access iOSjailbreakingisoftencomparedtoAndroidrooting,buttheprocessisactuallyquitedifferent. Toexplainthedifference, we’llfirstreviewtheconceptsof“rooting”and“flashing”onAndroid. • Rooting: Thistypicallyinvolvesinstallingthesubinaryonthesystemorreplacingthewholesystemwitharooted customROM.Exploitsaren’trequiredtoobtainrootaccessaslongasthebootloaderisaccessible. • Flashing custom ROMs: This allows you to replace the OS that’s running on the device after you unlock the bootloader. Thebootloadermayrequireanexploittounlockit. OniOSdevices,flashingacustomROMisimpossiblebecausetheiOSbootloaderonlyallowsApple-signedimagestobe bootedandflashed. ThisiswhyevenofficialiOSimagescan’tbeinstallediftheyaren’tsignedbyApple,anditmakes iOSdowngradesonlypossibleforaslongasthepreviousiOSversionisstillsigned. ThepurposeofjailbreakingistodisableiOSprotections(Apple’scodesigningmechanismsinparticular)sothatarbitrary unsignedcodecanrunonthedevice(e.g.customcodeordownloadedfromalternativeappstoressuchasCydiaorSileo). Theword“jailbreak”isacolloquialreferencetoall-in-onetoolsthatautomatethedisablingprocess. DevelopingajailbreakforagivenversionofiOSisnoteasy. Asasecuritytester,you’llmostlikelywanttousepublicly availablejailbreaktools. Still,werecommendstudyingthetechniquesthathavebeenusedtojailbreakvariousversions of iOS-you’ll encounter many interesting exploits and learn a lot about OS internals. For example, Pangu9 for iOS 9.x exploitedatleastfivevulnerabilities,includingause-after-freekernelbug(CVE-2015-6794)andanarbitraryfilesystem accessvulnerabilityinthePhotosapp(CVE-2015-7037). SomeappsattempttodetectwhethertheiOSdeviceonwhichthey’rerunningisjailbroken. Thisisbecausejailbreaking deactivatessomeofiOS’defaultsecuritymechanisms. However,thereareseveralwaystogetaroundthesedetections, andwe’llintroducetheminthechapter“iOSAnti-ReversingDefenses”. Benefits of Jailbreaking EndusersoftenjailbreaktheirdevicestotweaktheiOSsystem’sappearance,addnewfeatures,andinstallthird-party appsfromunofficialappstores. Forasecuritytester,however,jailbreakinganiOSdevicehasevenmorebenefits. They include,butaren’tlimitedto,thefollowing: • Rootaccesstothefilesystem. • Possibilityofexecutingapplicationsthathaven’tbeensignedbyApple(whichincludesmanysecuritytools). • Unrestricteddebugginganddynamicanalysis. • AccesstotheObjective-CorSwiftruntime. Jailbreak Types Therearetethered,semi-tethered,semi-untethered,anduntetheredjailbreaks. • Tethered jailbreaks don’t persist through reboots, so re-applying jailbreaks requires the device to be connected (tethered)toacomputerduringeveryreboot. Thedevicemaynotrebootatallifthecomputerisnotconnected. • Semi-tetheredjailbreakscan’tbere-appliedunlessthedeviceisconnectedtoacomputerduringreboot. Thedevice canalsobootintonon-jailbrokenmodeonitsown. • Semi-untetheredjailbreaksallowthedevicetobootonitsown,butthekernelpatches(oruser-landmodifications) fordisablingcodesigningaren’tappliedautomatically. Theusermustre-jailbreakthedevicebystartinganappor visitingawebsite(notrequiringaconnectiontoacomputer,hencethetermuntethered). • Untetheredjailbreaksarethemostpopularchoiceforendusersbecausetheyneedtobeappliedonlyonce,after whichthedevicewillbepermanentlyjailbroken. 336\\nCaveats and Considerations DevelopingajailbreakforiOSisbecomingmoreandmorecomplicatedasApplecontinuestohardentheirOS.Whenever Applebecomesawareofavulnerability,itispatchedandasystemupdateispushedouttoallusers. Asitisnotpossible to downgrade to a specific version of iOS, and since Apple only allows you to update to the latest iOS version, it is a challengetohaveadevicewhichisrunningaversionofiOSforwhichajailbreakisavailable. Somevulnerabilitiescannot bepatchedbysoftware,suchasthecheckm8exploitaffectingtheBootROMofallCPUsuntilA12. If you have a jailbroken device that you use for security testing, keep it as is unless you’re 100% sure that you can re- jailbreak it after upgrading to the latest iOS version. Consider getting one (or multiple) spare device(s) (which will be updatedwitheverymajoriOSrelease)andwaitingforajailbreaktobereleasedpublicly. Appleisusuallyquicktorelease apatchonceajailbreakhasbeenreleasedpublicly,soyouonlyhaveacoupleofdaystodowngrade(ifitisstillsigned byApple)totheaffectediOSversionandapplythejailbreak. iOSupgradesarebasedonachallenge-responseprocess(generatingtheso-calledSHSHblobsasaresult). Thedevice will allow the OS installation only if the response to the challenge is signed by Apple. This is what researchers call a “signingwindow”,anditisthereasonyoucan’tsimplystoretheOTAfirmwarepackageyoudownloadedandloaditonto thedevicewheneveryouwantto. DuringminoriOSupgrades,twoversionsmaybothbesignedbyApple(thelatestone, andthepreviousiOSversion). ThisistheonlysituationinwhichyoucandowngradetheiOSdevice. Youcancheckthe currentsigningwindowanddownloadOTAfirmwarefromtheIPSWDownloadswebsite. ForsomedevicesandiOSversions,itispossibletodowngradetoolderversionsincasetheSHSHblobsforthatdevice werecollectedwhenthesigningwindowwasactive. MoreinformationonthiscanbefoundonthecfwiOSGuide-Saving Blobs Which Jailbreaking Tool to Use DifferentiOSversionsrequiredifferentjailbreakingtechniques. Determinewhetherapublicjailbreakisavailableforyour version of iOS. Beware of fake tools and spyware, which are often hiding behind domain names that are similar to the nameofthejailbreakinggroup/author. TheiOSjailbreaksceneevolvessorapidlythatprovidingup-to-dateinstructionsisdifficult. However,wecanpointyou tosomesourcesthatarecurrentlyreliable. • AppleDB • TheiPhoneWiki • RedmondPie • RedditJailbreak Notethatanymodificationyoumaketoyourdeviceisatyourownrisk. Whilejailbreakingistypicallysafe,things cangowrongandyoumayendupbrickingyourdevice. Nootherpartyexceptyourselfcanbeheldaccountablefor anydamage. Dynamic Analysis on Non-Jailbroken Devices Platform: ios Ifyoudon’thaveaccesstoajailbrokendevice,youcanpatchandrepackagethetargetapptoloadadynamiclibraryat startup (e.g. the Frida gadget to enable dynamic testing with Frida and related tools such as objection). This way, you can instrument the app and do everything you need to do for dynamic analysis (of course, you can’t break out of the sandboxthisway). However,thistechniqueonlyworksiftheappbinaryisn’tFairPlay-encrypted(i.e.,obtainedfromthe AppStore). Automated Repackaging Objectionautomatestheprocessofapprepackaging. Youcanfindexhaustivedocumentationontheofficialwikipages. Usingobjection’srepackagingfeatureissufficientformostofusecases. However,insomecomplexscenariosyoumight need more fine-grained control or a more customizable repackaging process. In that case, you can read a detailed explanationoftherepackagingandresigningprocessin“ManualRepackaging”. 337\\nManual Repackaging ThankstoApple’sconfusingprovisioningandcode-signingsystem,re-signinganappismorechallengingthanyouwould expect. iOSwon’trunanappunlessyougettheprovisioningprofileandcodesignatureheaderexactlyright. Thisrequires learningmanyconcepts-certificatetypes,BundleIDs,applicationIDs,teamidentifiers,andhowApple’sbuildtoolsconnect them. GettingtheOStorunabinarythathasn’tbeenbuiltviathedefaultmethod(Xcode)canbeadauntingprocess. We’lluseoptool,Apple’sbuildtools,andsomeshellcommands. OurmethodisinspiredbyVincentTan’sSwizzlerproject. TheNCCgrouphasdescribedanalternativerepackagingmethod. Toreproducethestepslistedbelow,downloadUnCrackableiOSAppLevel1fromtheOWASPMobileTestingGuiderepos- itory. Our goal is to make the UnCrackable app load FridaGadget.dylib during startup so we can instrument the app withFrida. PleasenotethatthefollowingstepsapplytomacOSonly,asXcodeisonlyavailableformacOS. Getting a Developer Provisioning Profile and Certificate TheprovisioningprofileisaplistfilesignedbyApple,whichaddsyourcode-signingcertificatetoitslistofacceptedcertifi- catesononeormoredevices. Inotherwords,thisrepresentsAppleexplicitlyallowingyourapptorunforcertainreasons, such as debugging on selected devices (development profile).", "metadata": {"doc_id": "OWASP_MASTG", "chunk_id": 122}}