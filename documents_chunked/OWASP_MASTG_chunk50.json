{"text": "• Digitalsignaturealgorithms: RSA(3072bitsandhigher),ECDSAwithNISTP-384 • Keyestablishmentalgorithms: RSA(3072bitsandhigher),DH(3072bitsorhigher),ECDHwithNISTP-384 Additionally,youshouldalwaysrelyonsecurehardware(ifavailable)forstoringencryptionkeys,performingcryptographic operations,etc. Formoreinformationonalgorithmchoiceandbestpractices,seethefollowingresources: • “CommercialNationalSecurityAlgorithmSuiteandQuantumComputingFAQ” • NISTrecommendations(2019) • BSIrecommendations(2019) Common Configuration Issues Insufficient Key Length Eventhemostsecureencryptionalgorithmbecomesvulnerabletobrute-forceattackswhenthatalgorithmusesaninsuf- ficientkeysize. Ensurethatthekeylengthfulfillsacceptedindustrystandards. 72\\nSymmetric Encryption with Hard-Coded Cryptographic Keys Thesecurityofsymmetricencryptionandkeyedhashes(MACs)dependsonthesecrecyofthekey. Ifthekeyisdisclosed, the security gained by encryption is lost. To prevent this, never store secret keys in the same place as the encrypted datatheyhelpedcreate. Acommonmistakeisencryptinglocallystoreddatawithastatic,hardcodedencryptionkeyand compilingthatkeyintotheapp. Thismakesthekeyaccessibletoanyonewhocanuseadisassembler. Hardcodedencryptionkeymeansthatakeyis: • partofapplicationresources • valuewhichcanbederivedfromknownvalues • hardcodedincode First, ensure that no keys or passwords are stored within the source code. This means you should check native code, JavaScript/Dartcode,Java/KotlincodeonAndroidandObjective-C/SwiftiniOS.Notethathard-codedkeysareproblematic evenifthesourcecodeisobfuscatedsinceobfuscationiseasilybypassedbydynamicinstrumentation. Iftheappisusingtwo-wayTLS(bothserverandclientcertificatesarevalidated),makesurethat: • Thepasswordtotheclientcertificateisn’tstoredlocallyorislockedinthedeviceKeychain. • Theclientcertificateisn’tsharedamongallinstallations. Iftheappreliesonanadditionalencryptedcontainerstoredinappdata,checkhowtheencryptionkeyisused. Ifakey- wrappingschemeisused,ensurethatthemastersecretisinitializedforeachuserorthecontainerisre-encryptedwith newkey. Ifyoucanusethemastersecretorpreviouspasswordtodecryptthecontainer,checkhowpasswordchanges arehandled. Secretkeysmustbestoredinsecuredevicestoragewheneversymmetriccryptographyisusedinmobileapps. Formore informationontheplatform-specificAPIs,seethe“DataStorageonAndroid”and“DataStorageoniOS”chapters. Weak Key Generation Functions Cryptographicalgorithms(suchassymmetricencryptionorsomeMACs)expectasecretinputofagivensize. Forexample, AESusesakeyofexactly16bytes. Anativeimplementationmightusetheuser-suppliedpassworddirectlyasaninput key. Usingauser-suppliedpasswordasaninputkeyhasthefollowingproblems: • Ifthepasswordissmallerthanthekey,thefullkeyspaceisn’tused. Theremainingspaceispadded(spacesare sometimesusedforpadding). • Auser-suppliedpasswordwillrealisticallyconsistmostlyofdisplayableandpronounceablecharacters. Therefore, onlysomeofthepossible256ASCIIcharactersareusedandentropyisdecreasedbyapproximatelyafactoroffour. Ensurethatpasswordsaren’tdirectlypassedintoanencryptionfunction. Instead,theuser-suppliedpasswordshouldbe passedintoaKDFtocreateacryptographickey. Chooseanappropriateiterationcountwhenusingpasswordderivation functions. Forexample,NISTrecommendsaniterationcountofatleast10,000forPBKDF2andforcriticalkeyswhereuser- perceivedperformanceisnotcriticalatleast10,000,000. Forcriticalkeys,itisrecommendedtoconsiderimplementation ofalgorithmsrecognizedbyPasswordHashingCompetition(PHC)likeArgon2. Weak Random Number Generators It is fundamentally impossible to produce truly random numbers on any deterministic device. Pseudo-random number generators (RNG) compensate for this by producing a stream of pseudo-random numbers - a stream of numbers that appear as if they were randomly generated. The quality of the generated numbers varies with the type of algorithm used. CryptographicallysecureRNGsgeneraterandomnumbersthatpassstatisticalrandomnesstests,andareresilient againstpredictionattacks(e.g.itisstatisticallyinfeasibletopredictthenextnumberproduced). MobileSDKsofferstandardimplementationsofRNGalgorithmsthatproducenumberswithsufficientartificialrandomness. We’llintroducetheavailableAPIsintheAndroidandiOSspecificsections. 73\\nCustom Implementations of Cryptography Inventing proprietary cryptographic functions is time consuming, difficult, and likely to fail. Instead, we can use well- knownalgorithmsthatarewidelyregardedassecure. MobileoperatingsystemsofferstandardcryptographicAPIsthat implementthosealgorithms. Carefullyinspectallthecryptographicmethodsusedwithinthesourcecode,especiallythosethataredirectlyappliedto sensitivedata. AllcryptographicoperationsshouldusestandardcryptographicAPIsforAndroidandiOS(we’llwriteabout thoseinmoredetailintheplatform-specificchapters). Anycryptographicoperationsthatdon’tinvokestandardroutines from known providers should be closely inspected. Pay close attention to standard algorithms that have been modi- fied. Rememberthatencodingisn’tthesameasencryption! Alwaysinvestigatefurtherwhenyoufindbitmanipulation operatorslikeXOR(exclusiveOR). Atallimplementationsofcryptography,youneedtoensurethatthefollowingalwaystakesplace: • Worker keys (like intermediary/derived keys in AES/DES/Rijndael) are properly removed from memory after con- sumptionorincaseoferror. • Theinnerstateofaciphershouldberemovedfrommemoryassoonaspossible. Inadequate AES Configuration Advanced Encryption Standard (AES) is the widely accepted standard for symmetric encryption in mobile apps. It’s an iterative block cipher that is based on a series of linked mathematical operations. AES performs a variable number of roundsontheinput,eachofwhichinvolvesubstitutionandpermutationofthebytesintheinputblock. Eachrounduses a128-bitroundkeywhichisderivedfromtheoriginalAESkey. Asofthiswriting,noefficientcryptanalyticattacksagainstAEShavebeendiscovered. However,implementationdetails andconfigurableparameterssuchastheblockciphermodeleavesomemarginforerror. Weak Block Cipher Mode Block-basedencryptionisperformedupondiscreteinputblocks(forexample,AEShas128-bitblocks). Iftheplaintextis largerthantheblocksize,theplaintextisinternallysplitupintoblocksofthegiveninputsizeandencryptionisperformed oneachblock. Ablockciphermodeofoperation(orblockmode)determinesiftheresultofencryptingthepreviousblock impactssubsequentblocks. ECB(ElectronicCodebook)dividestheinputintofixed-sizeblocksthatareencryptedseparatelyusingthesamekey. If multipledividedblockscontainthesameplaintext, theywillbeencryptedintoidenticalciphertextblockswhichmakes patternsindataeasiertoidentify. Insomesituations,anattackermightalsobeabletoreplaytheencrypteddata. VerifythatCipherBlockChaining(CBC)modeisusedinsteadofECB.InCBCmode,plaintextblocksareXORedwiththe previousciphertextblock. Thisensuresthateachencryptedblockisuniqueandrandomizedevenifblockscontainthe sameinformation. PleasenotethatitisbesttocombineCBCwithanHMACand/orensurethatnoerrorsaregivensuch as“Paddingerror”,“MACerror”,“decryptionfailed”inordertobemoreresistanttoapaddingoracleattack. 74\\nWhenstoringencrypteddata,werecommendusingablockmodethatalsoprotectstheintegrityofthestoreddata,such as Galois/Counter Mode (GCM). The latter has the additional benefit that the algorithm is mandatory for each TLSv1.2 implementation,andthusisavailableonallmodernplatforms. Formoreinformationoneffectiveblockmodes,seetheNISTguidelinesonblockmodeselection. Predictable Initialization Vector CBC,OFB,CFB,PCBC,GCMmoderequireaninitializationvector(IV)asaninitialinputtothecipher. TheIVdoesn’thave tobekeptsecret,butitshouldn’tbepredictable: itshouldberandomandunique/non-repeatableforeachencryptedmes- sage. MakesurethatIVsaregeneratedusingacryptographicallysecurerandomnumbergenerator. Formoreinformation onIVs,seeCryptoFail’sinitializationvectorsarticle. Pay attention to cryptographic libraries used in the code: many open source libraries provide examples in their docu- mentationsthatmightfollowbadpractices(e.g.usingahardcodedIV).Apopularmistakeiscopy-pastingexamplecode withoutchangingtheIVvalue. Initialization Vectors in stateful operation modes Please note that the usage of IVs is different when using CTR and GCM mode in which the initialization vector is often acounter(inCTRcombinedwithanonce). SohereusingapredictableIVwithitsownstatefulmodelisexactlywhatis needed. InCTRyouhaveanewnoncepluscounterasaninputtoeverynewblockoperation. Forexample: fora5120 bitlongplaintext: youhave20blocks,soyouneed20inputvectorsconsistingofanonceandcounter. WhereasinGCM youhaveasingleIVpercryptographicoperation,whichshouldnotberepeatedwiththesamekey. Seesection8ofthe documentationfromNISTonGCMformoredetailsandrecommendationsoftheIV. Padding Oracle Attacks due to Weaker Padding or Block Operation Implementations In the old days, PKCS1.5 padding (in code: PKCS1Padding) was used as a padding mechanism when doing asymmet- ric encryption. This mechanism is vulnerable to the padding oracle attack. Therefore, it is best to use OAEP (Optimal Asymmetric Encryption Padding) captured in PKCS#1 v2.0 (in code: OAEPPadding, OAEPwithSHA-256andMGF1Padding, OAEPwithSHA-224andMGF1Padding, OAEPwithSHA-384andMGF1Padding, OAEPwithSHA-512andMGF1Padding). Note that, even when using OAEP, you can still run into an issue known best as the Manger’s attack as described in", "metadata": {"doc_id": "OWASP_MASTG", "chunk_id": 50}}