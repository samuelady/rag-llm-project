{"text": "wasuploadedtothewebservertomakesurethatthewebsiteallowstheapptoopenURLsonitsbehalf. Onlythe legitimateownersoftheURLcanuploadthisfile,sotheassociationoftheirwebsitewiththeappissecure. • Flexible: Universal links work even when the app is not installed. Tapping a link to the website would open the contentinSafari,asusersexpect. • Simple: OneURLworksforboththewebsiteandtheapp. • Private: Otherappscancommunicatewiththeappwithoutneedingtoknowwhetheritisinstalled. YoucanlearnmoreaboutUniversalLinksinthepost“LearningaboutUniversalLinksandFuzzingURLSchemesoniOS withFrida”byCarlosHolguera. UIActivity Sharing StartingoniOS6itispossibleforthird-partyappstosharedata(items)viaspecificmechanismslikeAirDrop,forexample. Fromauserperspective,thisfeatureisthewell-knownsystem-wide“ShareActivitySheet”thatappearsafterclickingon the“Share”button. 447\\nTheavailablebuilt-insharingmechanisms(aka. ActivityTypes)include: • airDrop • assignToContact • copyToPasteboard • mail • message • postToFacebook • postToTwitter A full list can be found in UIActivity.ActivityType. If not considered appropriate for the app, the developers have the possibilitytoexcludesomeofthesesharingmechanisms. App extensions TogetherwithiOS8,AppleintroducedAppExtensions. AccordingtoAppleAppExtensionProgrammingGuide,appexten- sionsletappsoffercustomfunctionalityandcontenttouserswhilethey’reinteractingwithotherappsorthesystem. In ordertodothis,theyimplementspecific,wellscopedtaskslike,forexample,definewhathappensaftertheuserclickson the“Share”buttonandselectssomeapporaction,providethecontentforaTodaywidgetorenableacustomkeyboard. Dependingonthetask,theappextensionwillhaveaparticulartype(andonlyone),theso-calledextensionpoints. Some notableonesare: • CustomKeyboard: replacestheiOSsystemkeyboardwithacustomkeyboardforuseinallapps. • Share: posttoasharingwebsiteorsharecontentwithothers. • Today: alsocalledwidgets,theyoffercontentorperformquicktasksintheTodayviewofNotificationCenter. How do app extensions interact with other apps Therearethreeimportantelementshere: • Appextension: istheonebundledinsideacontainingapp. Hostappsinteractwithit. • Hostapp: isthe(third-party)appthattriggerstheappextensionofanotherapp. • Containingapp: istheappthatcontainstheappextensionbundledintoit. 448\\nForexample,theuserselectstextinthehostapp,clicksonthe“Share”buttonandselectsone“app”oractionfromthe list. Thistriggerstheappextensionofthecontainingapp. Theappextensiondisplaysitsviewwithinthecontextofthe hostappandusestheitemsprovidedbythehostapp,theselectedtextinthiscase,toperformaspecifictask(postit onasocialnetwork,forexample). SeethispicturefromtheAppleAppExtensionProgrammingGuidewhichprettygood summarizesthis: Security Considerations Fromthesecuritypointofviewitisimportanttonotethat: • Anappextensiondoesnevercommunicatedirectlywithitscontainingapp(typically,itisn’tevenrunningwhilethe containedappextensionisrunning). • Anappextensionandthehostappcommunicateviainter-processcommunication. • Anappextension’scontainingappandthehostappdon’tcommunicateatall. • A Today widget (and no other app extension type) can ask the system to open its containing app by calling the openURL:completionHandler: methodoftheNSExtensionContextclass. • Anyappextensionanditscontainingappcanaccessshareddatainaprivatelydefinedsharedcontainer. Inaddition: • AppextensionscannotaccesssomeAPIs,forexample,HealthKit. • TheycannotreceivedatausingAirDropbutdocansenddata. • Nolong-runningbackgroundtasksareallowedbutuploadsordownloadscanbeinitiated. • AppextensionscannotaccessthecameraormicrophoneonaniOSdevice(exceptforiMessageappextensions). UIPasteboard Whentypingdataintoinputfields,theclipboardcanbeusedtocopyindata. Theclipboardisaccessiblesystem-wideand isthereforesharedbyapps. Thissharingcanbemisusedbymaliciousappstogetsensitivedatathathasbeenstoredin theclipboard. Whenusinganappyoushouldbeawarethatotherappsmightbereadingtheclipboardcontinuously,astheFacebook app did. Before iOS 9, a malicious app might monitor the pasteboard in the background while periodically retrieving [UIPasteboard generalPasteboard].string. AsofiOS9, pasteboardcontentisaccessibletoappsintheforeground only,whichreducestheattacksurfaceofpasswordsniffingfromtheclipboarddramatically. Still,copy-pastingpasswords isasecurityriskyoushouldbeawareof,butalsocannotbesolvedbyanapp. • Preventingpastingintoinputfieldsofanapp,doesnotpreventthatauserwillcopysensitiveinformationanyway. Sincetheinformationhasalreadybeencopiedbeforetheusernoticesthatit’snotpossibletopasteitin,amalicious apphasalreadysniffedtheclipboard. • Ifpastingisdisabledonpasswordfieldsusersmightevenchooseweakerpasswordsthattheycanrememberand they cannot use password managers anymore, which would contradict the original intention of making the app moresecure. The UIPasteboard enables sharing data within an app, and from an app to other apps. There are two kinds of paste- boards: 449\\n• systemwide general pasteboard: for sharing data with any app. Persistent by default across device restarts andappuninstalls(sinceiOS10). • custom/namedpasteboards: forsharingdatawithanotherapp(havingthesameteamIDastheapptoshare from) or with the app itself (they are only available in the process that creates them). Non-persistent by default (sinceiOS10),thatis,theyexistonlyuntiltheowning(creating)appquits. SecurityConsiderations: • Userscannotgrantordenypermissionforappstoreadthepasteboard. • SinceiOS9,appscannotaccessthepasteboardwhileinbackground,thismitigatesbackgroundpasteboardmoni- toring. However,ifthemaliciousappisbroughttoforegroundagainandthedataremainsinthepasteboard,itwill beabletoretrieveitprogrammaticallywithouttheknowledgenortheconsentoftheuser. • Applewarnsaboutpersistentnamedpasteboardsanddiscouragestheiruse. Instead,sharedcontainersshouldbe used. • Starting in iOS 10 there is a new Handoff feature called Universal Clipboard that is enabled by default. It allows the general pasteboard contents to automatically transfer between devices. This feature can be disabled if the developerchoosestodosoanditisalsopossibletosetanexpirationtimeanddateforcopieddata. Testing WebView Protocol Handlers Platform: ios MASVSV1: MSTG-PLATFORM-6 MASVSV2: MASVS-PLATFORM-2 Overview Static Analysis • TestinghowWebViewsareloaded • TestingWebViewfileaccess • Checkingtelephonenumberdetection Testing How WebViews are Loaded IfaWebViewisloadingcontentfromtheappdatadirectory,usersshouldnotbeabletochangethefilenameorpathfrom whichthefileisloaded,andtheyshouldn’tbeabletoedittheloadedfile. This presents an issue especially in UIWebViews loading untrusted content via the deprecated methods loadHTML- String:baseURL:orloadData:MIMEType:textEncodingName: baseURL: andsettingthebaseURLparametertonilor toafile: orapplewebdata: URLschemes. Inthiscase,inordertopreventunauthorizedaccesstolocalfiles,thebest optionistosetitinsteadtoabout:blank. However,therecommendationistoavoidtheuseofUIWebViewsandswitch toWKWebViewsinstead. Here’sanexampleofavulnerableUIWebViewfrom“Where’sMyBrowser?”: letscenario2HtmlPath=Bundle.main.url(forResource:\"web/UIWebView/scenario2.html\",withExtension:nil) do{ letscenario2Html=tryString(contentsOf:scenario2HtmlPath!,encoding:.utf8) uiWebView.loadHTMLString(scenario2Html,baseURL:nil) }catch{} ThepageloadsresourcesfromtheinternetusingHTTP,enablingapotentialMITMtoexfiltratesecretscontainedinlocal files,e.g.insharedpreferences. WhenworkingwithWKWebViews,ApplerecommendsusingloadHTMLString:baseURL:orloadData:MIMEType:textEncodingName:baseURL: to load local HTML files and loadRequest: for web content. Typically, the local files are loaded in combina- tion with methods including, among others: pathForResource:ofType:, URLForResource:withExtension: or init(contentsOf:encoding:). 450\\nSearchthesourcecodeforthementionedmethodsandinspecttheirparameters. ExampleinObjective-C: -(void)viewDidLoad { [super viewDidLoad]; WKWebViewConfiguration *configuration =[[WKWebViewConfigurationalloc]init]; self.webView =[[WKWebViewalloc]initWithFrame:CGRectMake(10,20, CGRectGetWidth([UIScreenmainScreen].bounds)-20, CGRectGetHeight([UIScreenmainScreen].bounds)-84)configuration:configuration]; self.webView.navigationDelegate =self; [self.viewaddSubview:self.webView]; NSString *filePath =[[NSBundlemainBundle]pathForResource:@\"example_file\" ofType:@\"html\"]; NSString *html =[NSStringstringWithContentsOfFile:filePath encoding:NSUTF8StringEncodingerror:nil]; [self.webViewloadHTMLString:htmlbaseURL:[NSBundlemainBundle].resourceURL]; } ExampleinSwiftfrom“Where’sMyBrowser?”: letscenario2HtmlPath=Bundle.main.url(forResource:\"web/WKWebView/scenario2.html\",withExtension:nil) do{ letscenario2Html=tryString(contentsOf:scenario2HtmlPath!,encoding:.utf8) wkWebView.loadHTMLString(scenario2Html,baseURL:nil) }catch{} Ifonlyhavingthecompiledbinary,youcanalsosearchforthesemethods,e.g.: $rabin2 -zz./WheresMyBrowser |grep -i\"loadHTMLString\" 2310x0002df6c24 (4.__TEXT.__objc_methname)asciiloadHTMLString:baseURL: Inacaselikethis,itisrecommendedtoperformdynamicanalysistoensurethatthisisinfactbeingusedandfromwhich kindofWebView. ThebaseURLparameterheredoesn’tpresentanissueasitwillbesetto“null”butcouldbeanissueif notsetproperlywhenusingaUIWebView. See“CheckingHowWebViewsareLoaded”foranexampleaboutthis. In addition, you should also verify if the app is using the method loadFileURL: allowingReadAccessToURL:. Its first parameterisURLandcontainstheURLtobeloadedintheWebView, itssecondparameterallowingReadAccessToURL maycontainasinglefileoradirectory. Ifcontainingasinglefile,thatfilewillbeavailabletotheWebView. However,if itcontainsadirectory,allfilesonthatdirectorywillbemadeavailabletotheWebView. Therefore,itisworthinspecting thisandincaseitisadirectory,verifyingthatnosensitivedatacanbefoundinsideit. ExampleinSwiftfrom“Where’sMyBrowser?”: varscenario1Url=FileManager.default.urls(for:.libraryDirectory,in:.userDomainMask)[0] scenario1Url=scenario1Url.appendingPathComponent(\"WKWebView/scenario1.html\") wkWebView.loadFileURL(scenario1Url,allowingReadAccessTo:scenario1Url) Inthiscase,theparameterallowingReadAccessToURLcontainsasinglefile“WKWebView/scenario1.html”,meaningthat theWebViewhasexclusivelyaccesstothatfile. Inthecompiledbinary: $rabin2 -zz./WheresMyBrowser |grep", "metadata": {"doc_id": "OWASP_MASTG", "chunk_id": 151}}